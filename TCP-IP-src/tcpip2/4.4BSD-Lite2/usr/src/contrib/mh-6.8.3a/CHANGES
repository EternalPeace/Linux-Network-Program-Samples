








                                   Changes to
                      The RAND MH Message Handling System:
                               UCI version MH 6.8


                                 John L. Romine

                            Computing Support Group
                 Department of Information and Computer Science
                        University of California, Irvine
                             Irvine, CA  92717-3425
                               Bug-MH@ICS.UCI.EDU


                                    _A_B_S_T_R_A_C_T


                    This document describes the changes to the
               UCI version of the RAND MH system from MH 6.6 to
               this release of MH 6.8.  This document is meant to
               supplement, not supersede, the standard MH User's
               manual and MH Administrator's manual.

                    Comments concerning this documentation should
               be addressed to the mailbox Bug-MH@ICS.UCI.EDU, or
               ucbvax!ucivax!bug-mh.



          _A_C_K_N_O_W_L_E_D_G_E_M_E_N_T_S

          The _M_H system described herein is based on the original RAND
          _M_H system.  It has been extensively developed (perhaps too
          much so) by Marshall T. Rose and John L. Romine at the
          University of California, Irvine.  Einar A. Stefferud, Jerry
          N. Sweet, and Terry P. Domae provided numerous suggestions
          to improve the UCI version of _M_H.

               Of course, a large number of people have helped _M_H
          along.  The list of "_M_H immortals" is too long to list here.
          For this release, numerous _M_H-_W_o_r_k_e_r_s sent in fixes and
          other changes.  A handful of courageous _M_H-_W_o_r_k_e_r_s volun-
          teered to beta-test these changes; their help is particu-
          larly appreciated.










                              December 1, 1993





          Changes to MH 6.8                                          2



          _D_I_S_C_L_A_I_M_E_R

          The Regents of the University of California wish to make  it
          known that:

               Although each program has been tested by its  con-
               tributor, no warranty, express or implied, is made
               by the contributor or the University  of  Califor-
               nia,  as  to  the  accuracy and functioning of the
               program and related program  material,  nor  shall
               the  fact of distribution constitute any such war-
               ranty, and no responsibility  is  assumed  by  the
               contributor  or  the  University  of California in
               connection herewith.

          _C_O_N_V_E_N_T_I_O_N_S

          In this document, certain formatting conventions are adhered
          to:

               The names of UNIX commands, such as _c_o_m_p are  presented
               in _i_t_a_l_i_c_s.

               Arguments to programs, such as `msgs' and `-nobell' are
               delimited by single-quotes.

               Text that should be typed exactly as-is, such  as  com-
               mand  lines  (e.g.,  "folder  -pack"), are delimited by
               double-quotes.

               UNIX pathnames and envariables, such  as  /usr/uci  and
               $SIGNATURE, are presented in bold font.
























                              December 1, 1993





          Changes for MH 6.8.3                                       3


          _C_H_A_N_G_E_S _F_O_R _M_H _6._8._3

          The MH 6.8.3 maintenance release contains few user-visible
          changes.  Most of the changes are internal to the multi-
          media display program _m_h_n to support RFC 1521 (the new MIME
          standard).  This is the current version of MH as of December
          1, 1993.

          _R_u_n_t_i_m_e _T_a_i_l_o_r_i_n_g

          When posting mail using the SMTP, _p_o_s_t did not normally send
          the HELO command. This was because _S_e_n_d_M_a_i_l would fail if
          the host name given in the HELO command was the local host.
          Later versions of _S_e_n_d_M_a_i_l will now complain if you omit the
          HELO command.

               As of MH 6.8.3a, by default _p_o_s_t will give the SMTP
          HELO command with the local hostname.  If you specify a
          hostname with the clientname: option in the _m_t_s_t_a_i_l_o_r file,
          _p_o_s_t will give the HELO command with that name instead.  If
          the argument to the clientname: option is empty, no HELO
          command is given.  See _m_h-_t_a_i_l_o_r(5) for more details.

          _U_s_e_r _I_n_t_e_r_f_a_c_e _P_r_o_g_r_a_m_s

          folder  The _f_o_l_d_e_r command now has `-create' and `-nocreate'
                  options.  See _f_o_l_d_e_r(1) for details.

          inc     A bug where `-host' would not override the pophost
                  as set in the _m_t_s_t_a_i_l_o_r file has been fixed.  This
                  bug was also fixed in _m_s_g_c_h_k.

          mhn     The _m_h_n command has several changes: updates for
                  conformance with RFC 1521, addition of two caches:
                  public and private, addition of two caching poli-
                  cies: one for reading and one for writing, support
                  for storing multipart entities, and a few bug fixes.
                  See _m_h_n(1) for complete details.

          _C_H_A_N_G_E_S _F_O_R _M_H _6._8._2

          The MH.6.8.2 patch release contains only internal changes to
          support the BSD 4.4 and 386BSD versions of UNIX.  This ver-
          sion of _M_H was released August 25, 1993, but was not widely
          distributed.

          _C_H_A_N_G_E_S _F_O_R _M_H _6._8._1

          The MH.6.8.1 patch release is a maintenance release.  This
          is the current released version of _M_H as of August 20, 1993.

               This release includes a small number of bug fixes, a
          few minor enhancements, some changes for the new MIME stan-
          dard, and support for ESMTP (RFC 1425).  Support for BSD 4.4



                              December 1, 1993





          Changes for MH 6.8.3                                       4


          and 386BSD is planned for the next release.

               Many other fixes which have already been received are
          still being merged.  If you've sent an update for MH 6.8 to
          Bug-MH@ics.uci.edu and it isn't in this release, it'll prob-
          ably appear in the next release.

          _F_i_x_e_s _a_n_d _E_n_h_a_n_c_e_m_e_n_t_s

          Many minor documentation corrections were made.  There are
          also a few program changes:

          mhn   The `-cache policy', `-[no]check', and `-[no]pause'
                switches have been added.   Some other minor changes
                have been made to comply with the new MIME standard.
                See _m_h_n(1) for complete details.

          post  When posting mail with SendMail, _p_o_s_t will not use the
                ONEX command when it is posting a message with BCCs.

          scan  _s_c_a_n will now work with big width values.

          _F_o_r_m_a_t _S_t_r_i_n_g_s

          One new function has been added:

          %(profile arg)  This function looks up a component in the
                          .mh_profile or context files and returns the
                          value of that component.

          _C_o_n_f_i_g_u_r_a_t_i_o_n

          Two new configuration options are present:

          GCOS_HACK    The so-called "gcos" field of the password file
                       is used as a last resort to find the user's
                       full name (see _m_h-_p_r_o_f_i_l_e(5) for details).
                       Enable this option if your _p_a_s_s_w_d(5) man page
                       notes that the `&' character in the "gcos"
                       field stands for the login name.

          NORUSERPASS  Tells _M_H that your system doesn't have the
                       _r_u_s_e_r_p_a_s_s(3) routine; _M_H will include its own
                       copy of this routine in its library.













                              December 1, 1993





          Changes for MH 6.8                                         5


          _C_H_A_N_G_E_S _F_O_R _M_H _6._8

          This is the current released version of _M_H as of December
          14, 1992.  This release includes a number of bug fixes and
          internal changes to make the code more portable.  Two new
          authentication methods are provided for the POP, and support
          for SVR4 shared libraries is complete.

               The major user-visible change in this release is the
          incorporation of support for multi-media mail as specified
          by the Multi-purpose Internet Mail Extensions (MIME)
          RFC 1341.  This allows you to include things like audio,
          graphics, and the like, in your mail messages.  A new com-
          mand, _m_h_n, has been provided to support MIME and a detailed
          man page is provided in _m_h_n(1).

          _D_o_c_u_m_e_n_t_a_t_i_o_n

          The documentation has some general improvements, and the
          READ-ME document has been re-organized to help _M_H adminis-
          trators find the appropriate configuration options for their
          system.  The Makefiles in the papers/ hierarchy have been
          changed to invoke _T_e_X as "tex" (instead of "tex82").

          The following new man pages are also available:

          _m_h_n(1)      _m_h_n helps the user process multi-media mail.

          _m_h_p_a_r_a_m(1)  _m_h_p_a_r_a_m lets the user extract information from
                      the _M_H profile.

          _p_o_p_a_u_t_h(8)  the APOP database administration program (see
                      below).

          _p_o_p_i(1)     the POP initiator (see below).

          _s_l_o_c_a_l(1)   fully documents _s_l_o_c_a_l.  The _m_h_o_o_k(1) man page
                      now documents only the _M_H receive-mail hooks.

          _I_n_t_e_r_n_a_l _C_h_a_n_g_e_s

          The _M_H source code is in the process of being cleaned up to
          make pedantic ANSI C compilers happy.  Occurrences of "NULL"
          have been replaced by "0" where appropriate.  Extra tokens
          after "#else" and "#endif" have been put inside comments
          (this is still in progress).  The code should now compile
          cleanly on many more systems, specifically, more variants of
          SVR4.

               The version of tws/dtimep.c which was included in MH
          6.7.2 was incompatible with the _l_e_x library on some systems,
          and has been removed.

               A bug in the handling of blind lists inside alias files



                               December 14, 1992





          Changes for MH 6.8                                         6


          has been fixed.

          _P_o_s_t _O_f_f_i_c_e _P_r_o_t_o_c_o_l

          There were three new options added to the POP.

          APOP  This option indicates that the POP daemon will support
                the   non-standard   APOP  command  which  provides  a
                challenge-based authentication system  using  the  MD5
                message digest algorithm.

                This option also causes the _p_o_p_a_u_t_h program to be  in-
                stalled,  which allows the administrator to manipulate
                the APOP authorization database.

          KPOP  Support for KERBEROS with POP.  This code builds _p_o_p_d,
                _i_n_c and _m_s_g_c_h_k to support only the "kpop" protocol.
                This code is still expiremental, but is available for
                those sites wishing to test it.

          MPOP  This option indicates that the POP daemon will support
                the non-standard XTND SCAN command which provides per-
                formance enhancements when using the POP over low-
                speed connections.

                This option also causes an interactive POP client pro-
                gram, _p_o_p_i, to be compiled and installed.  A man page
                for the _p_o_p_i program is also provided.  This option
                requires the configuration to have "bboards: pop".

          The APOP and MPOP non-standard POP facilities are documented
          in _T_h_e _I_n_t_e_r_n_e_t _M_e_s_s_a_g_e (ISBN 0-13-092941-7), a book by
          Marshall T. Rose.  For more details, see support/pop/pop-
          more.txt and the _A_d_m_i_n_i_s_t_r_a_t_o_r'_s _G_u_i_d_e.  The APOP option
          peacefully co-exists with the standard POP, KPOP completely
          replaces the standard POP, and MPOP requires "bboards: pop".

          _F_i_l_e _L_o_c_k_i_n_g

          The file locking code has been cleaned up to support three
          kinds of kernel-level file locking.  As appropriate for your
          system, include the LOCKF, FCNTL or FLOCK option.  For more
          details, see _m_h-_t_a_i_l_o_r(5).














                               December 14, 1992





          Changes for MH 6.8                                         7


          Configuration Directives

          A number of new configuration directives have been added  or
          changed.  The full details are given in the READ-ME.

          cp:        The command used to  install  new  files  if  not
                     "cp".

          ln:        The command used to link files  together  in  the
                     source tree if not "ln".

          mts:       Full support for ZMAILER has been added.

          popdir:    The directory where _p_o_p_d will be installed if not
                     /usr/etc.

          regtest:   Set to "on" to prevent the hostname  and  compile
                     date from being included in _M_H binaries.

          sharedlib: You may now specify "sun4" or "sys5"  (for  SVR4)
                     shared libraries.

          signal:    Specifies the base type of the function  returned
                     by  _s_i_g_n_a_l().   This  was previously defined with
                     "options TYPESIG".

          Several `-D' options to _c_c have been added or changed:

          APOP       Authenticated POP (see above).

          AUX        Support for A/UX systems.

          DBMPWD     The DBM option has been renamed DBMPWD.

          HESIOD     Support for the HESIOD name server.

          KPOP       KERBEROS POP (see above).

          LOCALE     Support for local characters sets; uses the _s_e_t_-
                     _l_o_c_a_l() function.

          MAILGROUP  Makes _i_n_c set-group-id.  You may need this option
                     if your /usr/spool/mail is not world-writeable.

          MIME       Multi-media mail.

          MPOP       Mobile POP (see above).

          MSGID      Enables _s_l_o_c_a_l to detect and surpress duplicate
                     messages.

          OSF1       Support for DEC OSF1 systems.  May be incomplete.

          RENAME     Include this option if your system has a _r_e_n_a_m_e()



                               December 14, 1992





          Changes for MH 6.8                                         8


                     system call.

          SVR4       Support for System 5 Release 4 or newer systems.

          TYPESIG    This option has been dropped.  See `signal'
                     above.

          UNISTD     Include this option if your system has the
                     include file <unistd.h>.

          VSPRINTF   Include this option if your system has the
                     _v_s_p_r_i_n_t_f() library routine; otherwise, __d_o_p_r_n_t()
                     will be used.

          YEARMOD    Forces the _m_h-_f_o_r_m_a_t `year' function to return
                     2-digit values.  Use this option during a brief
                     transition period if you have local _m_h-_f_o_r_m_a_t
                     files which need to be converted to support 4-
                     digit years.

          _F_U_N_C_T_I_O_N_A_L _C_H_A_N_G_E_S

          In addition to the configuration changes mentioned above, a
          number of functional changes have been made to the system.
          Many programs have new features added and a few new programs
          have are provided. Each command's manual page gives complete
          information about the its operation.  Here is a short sum-
          mary of the changes.

          _M_H _S_e_q_u_e_n_c_e_s

          A larger number of user-defined sequences are available.
          Previously, this number had been 10.  On 32-bit systems, 26
          user-defined sequences are available.

          _P_r_o_f_i_l_e _C_o_m_p_o_n_e_n_t_s

          _M_H programs will now complain if the .mh_profile does not
          end in a newline.  Also, one enhancement and one new profile
          component are provided:

          Aliasfile:  Multiple filenames may now be given.

          Inbox:      New; the default folder (for _i_n_c, etc.) if not
                      "inbox".












                               December 14, 1992





          Changes for MH 6.8                                         9



          _F_o_r_m_a_t _S_t_r_i_n_g_s

          A few minor bugs were fixed in format string handling, and a
          few  new features were added.  See _m_h-_f_o_r_m_a_t(5) for complete
          details.

          Addresses      An  attempt  is  made   to   decipher   X.400
                         RFC 987-style addresses.

          Comments       Comments may be added to _m_h-_f_o_r_m_a_t  files;  a
                         comment  begins with the 2-character sequence
                         "%;", and ends with an un-escaped newline.

          %(modulo n)    The `modulo' function escape has been added.

          %(year{date})  The date parser has been enhanced  to  under-
                         stand  more  illegal date formats; `year' now
                         returns a 4-digit number.

          _U_s_e_r _I_n_t_e_r_f_a_c_e _P_r_o_g_r_a_m_s

          A number of _M_H commands have minor changes:

          ali       The output with `-user -list' was changed to match
                    the output with `-nouser -list'.

          burst     Will no longer drop the last message of a digest.

          inc       Accepts the `-apop' switch for authenticated POP
                    (see above); will attempt to detect write errors
                    (e.g., no space left on device) when incorporating
                    mail; no longer replaces newline characters with
                    NULLs.

          folder    The `-noprint' option was broken and has been
                    dropped.

          forw      Supports `-mime' to use MIME-style multi-part mes-
                    sages.

          mhl       Will no longer put an extra space at the end of
                    the `%{text}' in a formatfield.

          mhn       New; manipulates multi-media (MIME) messages; a
                    detailed man page is provided.

          mhparam   New; reads the _M_H profile (and context) and writes
                    the values of the specified components on the
                    standard output; useful in programmatic con-
                    structs.

          msgchk    Supports `-apop' (see above).




                               December 14, 1992





          Changes for MH 6.8                                        10


          packmbox  New; packs an _M_H folder into a UUCP-style mailbox.

          popi      New; a client-side POP initiator; available only
                    if you built _M_H with the MPOP option (see above).

          refile    A bug where the `rmmproc' did not remove all
                    specified message files has been fixed.

          scan      The `-file' option is fully supported and will no
                    longer complain about empty folders.

          send      Supports `-mime' and `-split' to split large mes-
                    sages into multiple partial messages using MIME.

          _S_u_p_p_o_r_t _P_r_o_g_r_a_m_s

          fmtdump   Can now read a format file, or a format string
                    given on the command line.

          popauth   New; manages the APOP authorization database (see
                    above).

          sendmail  The _s_e_n_d_m_a_i_l replacement will be installed only if
                    your `mts' setting uses the `/smtp' option.

          slocal    A new man page for _s_l_o_c_a_l is available; the new
                    `mbox' action is available to write a file in
                    _p_a_c_k_f format; a bug where extra `>' characters
                    were written to MMDF-style maildrops has been
                    fixed; if compiled with the MSGID option, can
                    detect and suppress reception of duplicate mes-
                    sages.

          viamail   New; bundles a directory (like _s_h_a_r) and sends it
                    through multi-media mail.






















                               December 14, 1992





          Changes for MH 6.7.2                                      11


          _C_H_A_N_G_E_S _F_O_R _M_H _6._7._2

          The MH.6.7.2 patch release is a maintenance release.  This
          is the current released version of _M_H as of February 1,
          1992.

               This release now supports the NCR Tower running SYS5R4.
          The WP changes installed in MH.6.7.0 have been removed.

          _S_h_a_r_e_d _L_i_b_r_a_r_i_e_s

          Support for SYS 5 shared libraries is in progress.

               Support for Sun OS 4.0 shared libraries had been
          improved.  The _M_H library has been modified to move initial-
          ized data into a data definition file.  The shared library
          will now consist of a libmh.so and libmh.sa file.  The
          shared library version number will no longer track the _M_H
          patch release number, and its numbering begins with version
          `1.1' with this release.

          _R_e_p_l_a_c_e_m_e_n_t _S_e_n_d_M_a_i_l

          Since many standard system programs expect to post mail by
          invoking /usr/lib/sendmail, a minimal replacement _S_e_n_d_M_a_i_l
          is provided in this release.  This replacement is meant to
          be installed on (e.g., diskless) client workstations which
          post mail using SMTP, and do not run a message transport
          system.  It will call _p_o_s_t to post mail; be sure you have
          configured _M_H with the `/smtp' mts option.  This sendmail
          replacement is installed in your _M_H etc directory, and you
          should link /usr/lib/sendmail to it.

          _F_o_r_m_a_t _S_t_r_i_n_g_s

          A manual page for the _f_m_t_d_u_m_p format string disassembler  is
          supplied, and some new format functions were added:

          folder   In _s_c_a_n, this component escape contains the name of
                   the current folder.  It is not defined for other _M_H
                   commands.

          getenv   This function escape returns the value  of  an  en-
                   vironment variable.

               There will be some additional changes in these routines
          in the next patch release.










                                  Feb 1, 1992





          Changes for MH 6.7.2                                      12



          _O_t_h_e_r _B_u_g _F_i_x_e_s _a_n_d _E_n_h_a_n_c_e_m_e_n_t_s

          In addition to some other minor enhancements, some bugs were
          fixed which in general were not user-visible:

          Blind lists   Users may now specify RFC822 address groups in
                        their  alias  files.   These groups are imple-
                        mented by _M_H as blind lists.

          date parsing  A number of sites have brain-damaged  versions
                        of lex.  _M_H will now come with the date parser
                        already run through lex.

          mark          A bug dealing with _m_a_r_k and the sequence named
                        `cur' is fixed.  This was previously a problem
                        for mh-e users.

          MH.doc        The _M_H nroff version of the manual  no  longer
                        contains teletype escape sequences.

          scan          Can now handle headers as long as 512 bytes.

          Signals       _M_H programs will no longer catch the  HUP  and
                        TERM  signals while waiting for a sub-process.
                        This was causing hung processes when your ter-
                        minal line was was dropped unexpectedly.

          Signature     If your signature is not defined, _M_H will  use
                        the   value   of   the  gecos  field  of  your
                        /etc/passwd entry as your signature.

          version.sh    A bug in the awk script  in  config/version.sh
                        was fixed.























                                  Feb 1, 1992





          Changes for MH 6.7.1a                                     13


          _C_H_A_N_G_E_S _F_O_R _M_H _6._7._1_a

          The MH.6.7.1a patch was made available on January 25, 1991
          for limited distribution only.  (This release had some known
          bugs, and so was not widely distributed.) This release
          incorporates several new features of particular note to
          users of sequences and format strings, as well as some gen-
          eral documentation improvements.  There are a few minor
          enhancements and internal bug fixes also.  Complete documen-
          tation of these changes is given in the individual manual
          pages, and the READ-ME file.

          _M_e_s_s_a_g_e _S_e_q_u_e_n_c_e_s

          A new manual page, _m_h-_s_e_q_u_e_n_c_e (5), has been added.  This
          manual page attempts to completely document the syntax and
          semantics of _M_H message sequence specifications.

               A powerful new feature is the ability to specify mes-
          sage ranges with user-defined sequences.  The  specification
          "name:n" may be used, and it designates up to the first `n'
          messages (or  last  `n' messages  for  `-n') which  are
          elements  of the user-defined sequence `name'.

               The message specifications "name:next" and "name:prev"
          may also be used, and they designate the next or previous
          message (relative to the current message) which is an ele-
          ment of the user-defined sequence `name'.  The specifica-
          tions "name:first" and "name:last" are equivalent to
          "name:1" and "name:-1", respectively.  The specification
          "name:cur" is not allowed (use just "cur" instead).

               These specifications allow the user to step through a
          sequence with a command like "show name:next".

          _F_o_r_m_a_t _S_t_r_i_n_g_s

          _M_H format strings now support an if-then-elseif-else clause
          (the `elseif' is new).  This will make format strings with
          multi-case conditions somewhat less complex.

               A new format function `addr' had been added.  This
          function takes an address header name as its argument, and
          returns a rendering of the address contained in that header
          as "user@host" or "host!user".

               Format widths now may be specified as a negative
          number.  This causes the output to be right-justified within
          the format width.








                                January 25, 1991





          Changes for MH 6.7.1a                                     14



          _O_t_h_e_r _C_h_a_n_g_e_s

          Along with a few minor enhancements, some  bugs  were  fixed
          which in general were not user-visible:

          fmtdump  This  new  program  produces   an   pseudo-language
                   representation of an _M_H format file, vaguely remin-
                   iscent of assembly  language.   While  this  output
                   format  is  not explicitly documented, it can still
                   be useful when debugging _M_H format files.

          refile   Now takes a `-[no]rmmproc' switch.  This  makes  it
                   easier to avoid loops when your "rmmproc" calls _r_e-
                   _f_i_l_e.

          slocal   A  problem  with  the  UUCP-style  mailboxes,   the
                   `RPATHS'  configuration  option,  and  the "Return-
                   Path:" header was fixed.

          sortm    Will ensure that no messages are lost if it is  in-
                   terrupted.

          whatnow  Will now tell you where it is  leaving  the  draft,
                   when  interrupted  in the initial edit.  Previously
                   the draft was simply unlinked.

          _C_o_m_p_i_l_a_t_i_o_n _O_p_t_i_o_n_s

          LOCKF    This option causes _M_H to  use  the  lockf()  system
                   call   for   locking  (if  available),  instead  of
                   flock().

























                                January 25, 1991





          Changes for MH 6.7.1                                      15


          _C_H_A_N_G_E_S _F_O_R _M_H _6._7._1

          The MH.6.7.1 patch release is a maintenance release, and as
          such, provides few changes from the previous release.  This
          is the current released version of _M_H as of December 14,
          1990.

          _U_s_e_r-_V_i_s_i_b_l_e _C_h_a_n_g_e_s

          The major change in this release is to the POP daemon
          (popd).  In _M_H 6.7, it was changed to be able to read both
          UUCP and MMDF-style mailboxes.  This did not work as
          reported.  The code has now been changed to parse MMDF-style
          mailboxes if you are configuring MH to run with MMDF as your
          message transport system.  Otherwise, UUCP-style mailboxes
          are expected.

               Since there are number of client programs available for
          only the POP2 protocol instead of POP3, popd has been
          updated to support both protocols.  This is a major win.  If
          you are compiling with POP turned on, add the `POP2' option
          to your _M_H config file, and the POP daemon will respond to
          POP2 or POP3 commands.  If you're using POP, there's no rea-
          son not to include this option; it does not affect the
          existing support for POP3.

          _I_n_t_e_r_n_a_l _C_h_a_n_g_e_s

          Some bugs were fixed which in general were not user-visible:

          context     Errors when writing out sequences  are  detected
                      correctly.

          inc         No longer inserts extra blank  lines  into  mes-
                      sages.

          mh-format   A nil pointer bug  in  the  address  parser  was
                      fixed.

          repl, etc.  The malloc/free problem has been fixed.

          rmf         A spelling error in the `-nointeractive'  switch
                      has been corrected.

          rcvtty      Will not print the message size if not available
                      (i.e., zero).

          send/post   Illegal signatures  (those  containing  unquoted
                      "."s) will be quoted.








                               December 14, 1990





          Changes for MH 6.7.0                                      16


          _G_E_N_E_R_A_L _C_H_A_N_G_E_S _F_O_R _M_H _6._7._0

          The author is pleased to announce that there are very few
          user-visible changes to _M_H 6.7 from the previous _M_H 6.6 dis-
          tribution.  The majority of development was in the form of
          bug fixes and slight enhancements.  In addition, this
          release is slightly faster than the previous release.  With
          a few minor exceptions, it is backward-compatible with the
          previous release.  _M_H 6.7.0 is the current released version
          of _M_H as of April 12, 1990.

               The changes were made mainly to generalize the source
          code to be compatible with a larger range of systems and
          compilers.  There were many small changes to add declara-
          tions for ANSI C compliance.  The System 5 support has been
          brought up to SYS5 R3, and there is support for Sun OS 4.0.

          _U_s_e_r-_V_i_s_i_b_l_e _C_h_a_n_g_e_s

          Here a quick summary of the changes that were made which are
          not backward-compatible with the previous release of _M_H:

          repl   The `-format' and `-noformat' switches have not been
                 functional since _M_H 5, and have been removed.  Any
                 users who have these switches in their .mh_profile,
                 will have to remove them.

          sortm  Previously, in most cases _s_o_r_t_m would fill-in any
                 gaps in the numbering of a folder, by renumbering the
                 messages starting with `1'.  This will no longer
                 occur; for this behavior, use "folder -pack".


          _U_s_i_n_g _A_l_i_a_s_e_s

          A new profile entry `Aliasfile:' has been added.  The _a_l_i,
          _s_e_n_d, and _w_h_o_m programs will look for this profile entry and
          treat it as they would an argument to `-alias'.  This should
          make it easier for novice _M_H users to begin using aliases.


          _R_e_a_d_i_n_g _N_e_t_w_o_r_k _N_e_w_s & _B_B_o_a_r_d_s

          The UCI BBoards facility can read local BBoards, and if com-
          piled with the `bboards: pop' and `pop: on' options, can
          also read remote BBoards using the Post Office Protocol (POP
          ver. 3).  With this release, _M_H can instead be compiled to
          read the Network News (i.e., USENET) using the Network News
          Transfer Protocol (NNTP).

               This capability is enabled by compiling _M_H with the
          `bboards: nntp' and `pop: on' options.  Unfortunately, read-
          ing remote BBoards via the POP and reading the Network News
          via the NNTP are mutually exclusive options.



                                 April 12, 1990





          Changes for MH 6.7.0                                      17


               To support the NNTP, a new module, uip/pshsbr.c, is
          compiled and loaded into _b_b_c and _m_s_h instead of
          uip/popsbr.c.  The default BBoard is changed from "system"
          to "general" for the NNTP.

               When reading BBoards, _b_b_c will first look for local
          BBoards, and then contact the NNTP server to read the Net-
          work News.  The location of the NNTP server should be speci-
          fied with the `nntphost:' entry in the mtstailor file (see
          the _M_H Administrator's Guide for details), or may be speci-
          fied on the command line with the `-host' switch.


          _F_o_r_m_a_t _S_t_r_i_n_g_s

          The manual page _m_h-_f_o_r_m_a_t (5) has been rewritten to give a
          better explanation of how to write format strings, and how
          they are interpreted by _M_H.  A line-by-line description of
          the default _r_e_p_l form file (replcomps) is now included in
          that manual page.

          Some new format functions were added, and others  were  aug-
          mented:

          trim        Strips any leading and trailing white-space from
                      the current string value.

          date2local  Will coerce the date to the local timezone.

          date2gmt    Will coerce the date to GMT.

          divide      Divides the current numeric value by  its  argu-
                      ment.   This  could  be useful for building _s_c_a_n
                      format strings which print large  message  sizes
                      in "Kb" or "Mb".

          friendly    If the address  field  cannot  be  parsed,  this
                      function  will  return  the  text of the address
                      header, instead of a null string.

          szone       A flag indicating whether the timezone  was  ex-
                      plicit in the date string.

          _P_R_O_G_R_A_M _C_H_A_N_G_E_S

          In addition to the general changes mentioned above, many
          programs have specific new features added, either by new
          switches or by expanded functionality.  Each command's
          manual page gives complete information about its new
          options.  Here is a short summary.

          _U_s_e_r _I_n_t_e_r_f_a_c_e _P_r_o_g_r_a_m_s

          anno      Accepts a `-nodate' switch which inhibits the date



                                 April 12, 1990





          Changes for MH 6.7.0                                      18


                    annotation, leaving only the body annotation.

          folder    When invoked with the `-pack' switch and the new
                    `-verbose' switch, _f_o_l_d_e_r will give information
                    about the actions taken to renumber the folder.

                    On most systems, _f_o_l_d_e_r can now create any
                    non-existing parent folders of a new sub-folder.

          forw      When making digests, _f_o_r_w will put the issue and
                    volume numbers in addition to the digest list
                    name, in the digest trailer.

          inc       Detects NFS write failures, and will not zero your
                    maildrop in that event.

          msh       Supports a variant of the new _s_o_r_t_m.

          prompter  Considers a period on a line by itself to signify
                    end-of-file when the `-doteof' switch is speci-
                    fied.

          repl      The `-[no]format' switches have not been used
                    since _M_H 5 and have been deleted. _r_e_p_l will now
                    find filter files in the _M_H library area.

          scan      With the `-file msgbox' switch, _s_c_a_n can list a
                    _p_a_c_k_f'd-format file directly (without using _m_s_h).

                    Lists messages in reverse order with the
                    `-reverse' switch.  This should be considered a
                    bug.

          sortm     Now has the options: `-textfield field', `-notext-
                    field', `-limit days', and `-nolimit'.

                    With these options, _s_o_r_t_m can be instructed to
                    sort a folder based on the contents of an arbi-
                    trary header such as "subject".

                    _s_o_r_t_m minimizes renaming messages, and will no
                    longer arbitrarily pack folders; for this
                    behavior, use "folder -pack".

          whatnow   Deletes the draft by renaming it with leading
                    comma, instead of unlinking it.

          _M_H _S_u_p_p_o_r_t _P_r_o_g_r_a_m_s

          The following support programs also have changes or enhance-
          ments:

          mhl     Will now accept a format string  on  any  component,
                  not just on addresses and dates.



                                 April 12, 1990





          Changes for MH 6.7.0                                      19


          popd    Will use _s_h_a_d_o_w passwords if compiled with the SHA-
                  DOW option.  It can now also read UUCP-style mail-
                  drops directly.

          rcvtty  If given no arguments, _r_c_v_t_t_y will produce a scan
                  listing as specified by a format string or file; a
                  default format string is used if one is not speci-
                  fied.

                  Before the listing is written to the users terminal,
                  the terminal's bell is rung and a newline is output.
                  The `-nobell' and the `-nonewline' options inhibit
                  these functions.

                  _r_c_v_t_t_y will obey terminal write notification set by
                  _m_e_s_g.  With the `-biff' switch, _r_c_v_t_t_y will also
                  obey the mail notification status set by _b_i_f_f.

                  On BSD43 systems, as with _w_r_i_t_e, _r_c_v_t_t_y will be
                  installed set-group-id to the group "tty".

          slocal  Understands UUCP-style "From " lines and will write
                  output files using this format if appropriate.
                  Before invoking a delivery program, _s_l_o_c_a_l will
                  strip such lines unless compiled with the RPATHS
                  option, in which case it will will convert such
                  lines into "Return-Path:" headers.

                  _s_l_o_c_a_l has a new result code "N", for use in .mail-
                  delivery files.  With this result code, _s_l_o_c_a_l will
                  perform the action only if the message has not been
                  delivered and the previous action succeeded.  This
                  allows for performing an action only if multiple
                  conditions are true.

          _D_O_C_U_M_E_N_T_A_T_I_O_N

          Several of the older _M_H papers have been difficult to format
          because they depended on an older version of PhDTeX which
          was not supplied.  These papers have been updated, and some
          TeX library files are supplied in papers/doclib/, so that
          these papers may be generated on any system with TeX.

               Many of the manual pages have been revised to include
          documentation of new command options, and some have been
          expanded to give more detail.  All are now slightly refor-
          matted at installation time to make them more compatible
          with programs like _m_a_k_e_w_h_a_t_i_s.


          _M_H _A_D_M_I_N_I_S_T_R_A_T_I_O_N

          This section describes changes in configuring, compiling and
          installing _M_H 6.7 and should not be of interest to casual _M_H



                                 April 12, 1990





          Changes for MH 6.7.0                                      20


          users.  The READ-ME file has been considerably revised and
          expanded to give more detail about the configuration and
          compilation options which have been included in this
          release.  Some compilation options have been removed, and
          many new options have been added.

               All _M_H Makefiles have been updated to work around some
          incompatibilities introduced in newer versions of _m_a_k_e.  _M_H
          programs will no longer be installed with the sticky-bit
          turned on.

               Reading this section not a substitute for carefully
          reading the READ-ME file before attempting to compile _M_H


          _B_u_g _F_i_x_e_s

          Some bugs were fixed which in general were not user-visible:

          address parser  Fixed to allow use of the "AT"  domain,  and
                          some minor bugs were fixed pertaining to ad-
                          dress groups.

          date parser     Improved to accept  more  forms  of  illegal
                          dates.  Military timezones were removed.

          dynamic memory  Many problems with corruption of the dynamic
                          memory pool have been fixed.

          locking         Will open files for write, if  necessary  to
                          enable locking.

          nil pointers    All reported nil pointer problems have  been
                          fixed.

          replcomps       The "In-Reply-To:" header had  quotes  added
                          around the date field to comply with RFC822.

          _W_h_i_t_e _P_a_g_e_s

          If _M_H is compiled with the WP option, _s_e_n_d recognizes an
          address between "<<" and ">>" characters such as:

                  To: << rose -org psi >>

          to be a name meaningful to a whitepages service.  In order
          to expand the name, _s_e_n_d must be invoked interactively
          (i.e., not from _p_u_s_h).  For each name, _s_e_n_d will invoke a
          command called _f_r_e_d in a special mode asking to expand the
          name.

               To get a copy of the white pages service, contact
          wpp-manager@psi.com.




                                 April 12, 1990





          Changes for MH 6.7.0                                      21


          _C_o_n_f_i_g_u_r_a_t_i_o_n _O_p_t_i_o_n_s

          Some configuration options have been added or changed:

          cc          To specify an alternate C compiler.

          ccoptions   Defaults to `-O'.

          bboards     May now be defined as "on", "off", "pop", or
                      "nntp".

          bbdelivery  Determines whether the bboard delivery agent and
                      library files should be installed.

          lex         To specify an alternate version of _l_e_x.

          mailgroup   If defined, _i_n_c will be made set-group-id to
                      this group.

          sharedlib   For SUN40 systems; if "on", makes libmh.a into a
                      shared library.

          slibdir     The directory where the above shared library
                      should be installed.

          sprintf     Set this to "int" if that's what your
                      _s_p_r_i_n_t_f (3) library routine returns.

          _C_o_m_p_i_l_a_t_i_o_n _O_p_t_i_o_n_s

          For different configurations, several `-D' options to _c_c
          have been added or changed:

          BERK        This disables the address and date parsing rou-
                      tines.  If you want to do much with
                      _m_h-_f_o_r_m_a_t (5), don't enable this.

          BSD43       Will make _r_c_v_t_t_y set-group-id to the group
                      "tty".

          DBM         For sites with a dbm-style password file (such
                      as with Yellow Pages), _M_H will not read the
                      entire passwd file into a cache.  At one site
                      that runs YP on a large passwd file, using this
                      showed a 6:1 performance improvement.

          NETWORK     This option has been deleted.  See SOCKETS.

          NOIOCTLH    Tells _M_H not to include the file sys/ioctl.h.
                      Use this if this file is not present on your
                      system.

          NTOHLSWAP   On systems with TCP/IP networking, _m_s_h will try
                      to use the ntohl() macro from the file



                                 April 12, 1990





          Changes for MH 6.7.0                                      22


                      netinet/in.h to byte-swap the binary map files
                      it writes.

          SENDMAILBUG Some versions of _s_e_n_d_m_a_i_l return a 451 (failure)
                      reply code when they don't mean to indicate
                      failure.  This option considers that code to be
                      equivalent to 250 (OK).

          SHADOW      Causes _p_o_p_d to read the file /etc/shadow for
                      encrypted passwords instead of /etc/passwd.  Use
                      this if you have a shadow password file (such as
                      on newer versions of SYSTEM 5).

          SOCKETS     Enable this if you are on a non-BSD system with
                      a socket interface for TCP/IP networking compa-
                      tible with 4.2BSD UNIX.

          SUN40       Use on Suns running Sun OS 4.0 and later.

          SYS5        This option has been updated to refer to SYS5 R3
                      and later systems.

          SYS5DIR     Use this if your system uses "struct dirent"
                      instead of "struct direct".  This should be true
                      for systems based on SYS5 R3 and later.

          TYPESIG     Defines the base type for the _s_i_g_n_a_l system
                      call.  This defaults to "int", but should be
                      defined as "void" if appropriate for your sys-
                      tem.

          WP          Enables support for the White Pages service.

          _I_n_s_t_a_l_l_a_t_i_o_n

          _M_H will now explicitly set the protection mode on every file
          it installs.

               Previously any existing file installed by _M_H would be
          backed up into the source tree, and then overwritten.  Now,
          a few system-dependent files will not be overwritten, and
          your changes will have to be merged in by hand.  See the
          READ-ME file for more details.














                                 April 12, 1990


