%!PS-Adobe-1.0
%%Creator: vangogh.CS.Berkeley.EDU:mckusick (Kirk &,1614 Oxford St. Berkeley CA 94709-1608,510-642-7780,510-843-9542)
%%Title: stdin (ditroff)
%%CreationDate: Thu Jun 22 18:18:49 1995
%%EndComments
%	@(#)psdit.pro	1.6 11/6/90
% lib/psdit.pro -- prolog for psdit (ditroff) files
% Copyright (c) 1984, 1985 Adobe Systems Incorporated. All Rights Reserved.
% last edit: shore Sat Nov 23 20:28:03 1985
% RCSID: $Header: psdit.pro,v 2.1 85/11/24 12:19:43 shore Rel $

% Changed by Edward Wang (edward@ucbarpa.berkeley.edu) to handle graphics,
% 17 Feb, 87.

/$DITroff 140 dict def $DITroff begin
/fontnum 1 def /fontsize 10 def /fontheight 10 def /fontslant 0 def
/xi{0 72 11 mul translate 72 resolution div dup neg scale 0 0 moveto
 /fontnum 1 def /fontsize 10 def /fontheight 10 def /fontslant 0 def F}def
/PB{save /psv exch def currentpoint translate 
 resolution 72 div dup neg scale 0 0 moveto}def
/PE{psv restore}def
/arctoobig 90 def /arctoosmall .05 def
/m1 matrix def /m2 matrix def /m3 matrix def /oldmat matrix def
/tan{dup sin exch cos div}def
/point{resolution 72 div mul}def
/dround	{transform round exch round exch itransform}def
/xT{/devname exch def}def
/xr{/mh exch def /my exch def /resolution exch def}def
/xp{}def
/xs{docsave restore end}def
/xt{}def
/xf{/fontname exch def /slotno exch def fontnames slotno get fontname eq not
 {fonts slotno fontname findfont put fontnames slotno fontname put}if}def
/xH{/fontheight exch def F}def
/xS{/fontslant exch def F}def
/s{/fontsize exch def /fontheight fontsize def F}def
/f{/fontnum exch def F}def
/F{fontheight 0 le{/fontheight fontsize def}if
 fonts fontnum get fontsize point 0 0 fontheight point neg 0 0 m1 astore
 fontslant 0 ne{1 0 fontslant tan 1 0 0 m2 astore m3 concatmatrix}if
 makefont setfont .04 fontsize point mul 0 dround pop setlinewidth}def
/X{exch currentpoint exch pop moveto show}def
/N{3 1 roll moveto show}def
/Y{exch currentpoint pop exch moveto show}def
/S{show}def
/ditpush{}def/ditpop{}def
/AX{3 -1 roll currentpoint exch pop moveto 0 exch ashow}def
/AN{4 2 roll moveto 0 exch ashow}def
/AY{3 -1 roll currentpoint pop exch moveto 0 exch ashow}def
/AS{0 exch ashow}def
/MX{currentpoint exch pop moveto}def
/MY{currentpoint pop exch moveto}def
/MXY{moveto}def
/cb{pop}def	% action on unknown char -- nothing for now
/n{}def/w{}def
/p{pop showpage xi}def
/Dt{/Dlinewidth exch def}def 1 Dt
/Ds{/Ddash exch def}def -1 Ds
/i{/Dstipple exch def}def 1 i
/Dsetlinewidth{2 Dlinewidth mul setlinewidth}def
/Dsetdash{Ddash 4 eq{[8 12]}{Ddash 16 eq{[32 36]}
 {Ddash 20 eq{[32 12 8 12]}{[]}ifelse}ifelse}ifelse 0 setdash}def
/Dstroke{gsave Dsetlinewidth Dsetdash 1 setlinecap stroke grestore
 currentpoint newpath moveto}def
/Dl{rlineto Dstroke}def
/arcellipse{/diamv exch def /diamh exch def oldmat currentmatrix pop
 currentpoint translate 1 diamv diamh div scale /rad diamh 2 div def
 currentpoint exch rad add exch rad -180 180 arc oldmat setmatrix}def
/Dc{dup arcellipse Dstroke}def
/De{arcellipse Dstroke}def
/Da{/endv exch def /endh exch def /centerv exch def /centerh exch def
 /cradius centerv centerv mul centerh centerh mul add sqrt def
 /eradius endv endv mul endh endh mul add sqrt def
 /endang endv endh atan def
 /startang centerv neg centerh neg atan def
 /sweep startang endang sub dup 0 lt{360 add}if def
 sweep arctoobig gt
 {/midang startang sweep 2 div sub def /midrad cradius eradius add 2 div def
  /midh midang cos midrad mul def /midv midang sin midrad mul def
  midh neg midv neg endh endv centerh centerv midh midv Da
  Da}
 {sweep arctoosmall ge
  {/controldelt 1 sweep 2 div cos sub 3 sweep 2 div sin mul div 4 mul def
   centerv neg controldelt mul centerh controldelt mul
   endv neg controldelt mul centerh add endh add
   endh controldelt mul centerv add endv add
   centerh endh add centerv endv add rcurveto Dstroke}
  {centerh endh add centerv endv add rlineto Dstroke}
  ifelse}
 ifelse}def
/Dpatterns[
[%cf[widthbits]
[8<0000000000000010>]
[8<0411040040114000>]
[8<0204081020408001>]
[8<0000103810000000>]
[8<6699996666999966>]
[8<0000800100001008>]
[8<81c36666c3810000>]
[8<0f0e0c0800000000>]
[8<0000000000000010>]
[8<0411040040114000>]
[8<0204081020408001>]
[8<0000001038100000>]
[8<6699996666999966>]
[8<0000800100001008>]
[8<81c36666c3810000>]
[8<0f0e0c0800000000>]
[8<0042660000246600>]
[8<0000990000990000>]
[8<0804020180402010>]
[8<2418814242811824>]
[8<6699996666999966>]
[8<8000000008000000>]
[8<00001c3e363e1c00>]
[8<0000000000000000>]
[32<00000040000000c00000004000000040000000e0000000000000000000000000>]
[32<00000000000060000000900000002000000040000000f0000000000000000000>]
[32<000000000000000000e0000000100000006000000010000000e0000000000000>]
[32<00000000000000002000000060000000a0000000f00000002000000000000000>]
[32<0000000e0000000000000000000000000000000f000000080000000e00000001>]
[32<0000090000000600000000000000000000000000000007000000080000000e00>]
[32<00010000000200000004000000040000000000000000000000000000000f0000>]
[32<0900000006000000090000000600000000000000000000000000000006000000>]]
[%ug
[8<0000020000000000>]
[8<0000020000002000>]
[8<0004020000002000>]
[8<0004020000402000>]
[8<0004060000402000>]
[8<0004060000406000>]
[8<0006060000406000>]
[8<0006060000606000>]
[8<00060e0000606000>]
[8<00060e000060e000>]
[8<00070e000060e000>]
[8<00070e000070e000>]
[8<00070e020070e000>]
[8<00070e020070e020>]
[8<04070e020070e020>]
[8<04070e024070e020>]
[8<04070e064070e020>]
[8<04070e064070e060>]
[8<06070e064070e060>]
[8<06070e066070e060>]
[8<06070f066070e060>]
[8<06070f066070f060>]
[8<060f0f066070f060>]
[8<060f0f0660f0f060>]
[8<060f0f0760f0f060>]
[8<060f0f0760f0f070>]
[8<0e0f0f0760f0f070>]
[8<0e0f0f07e0f0f070>]
[8<0e0f0f0fe0f0f070>]
[8<0e0f0f0fe0f0f0f0>]
[8<0f0f0f0fe0f0f0f0>]
[8<0f0f0f0ff0f0f0f0>]
[8<1f0f0f0ff0f0f0f0>]
[8<1f0f0f0ff1f0f0f0>]
[8<1f0f0f8ff1f0f0f0>]
[8<1f0f0f8ff1f0f0f8>]
[8<9f0f0f8ff1f0f0f8>]
[8<9f0f0f8ff9f0f0f8>]
[8<9f0f0f9ff9f0f0f8>]
[8<9f0f0f9ff9f0f0f9>]
[8<9f8f0f9ff9f0f0f9>]
[8<9f8f0f9ff9f8f0f9>]
[8<9f8f1f9ff9f8f0f9>]
[8<9f8f1f9ff9f8f1f9>]
[8<bf8f1f9ff9f8f1f9>]
[8<bf8f1f9ffbf8f1f9>]
[8<bf8f1fdffbf8f1f9>]
[8<bf8f1fdffbf8f1fd>]
[8<ff8f1fdffbf8f1fd>]
[8<ff8f1fdffff8f1fd>]
[8<ff8f1ffffff8f1fd>]
[8<ff8f1ffffff8f1ff>]
[8<ff9f1ffffff8f1ff>]
[8<ff9f1ffffff9f1ff>]
[8<ff9f9ffffff9f1ff>]
[8<ff9f9ffffff9f9ff>]
[8<ffbf9ffffff9f9ff>]
[8<ffbf9ffffffbf9ff>]
[8<ffbfdffffffbf9ff>]
[8<ffbfdffffffbfdff>]
[8<ffffdffffffbfdff>]
[8<ffffdffffffffdff>]
[8<fffffffffffffdff>]
[8<ffffffffffffffff>]]
[%mg
[8<8000000000000000>]
[8<0822080080228000>]
[8<0204081020408001>]
[8<40e0400000000000>]
[8<66999966>]
[8<8001000010080000>]
[8<81c36666c3810000>]
[8<f0e0c08000000000>]
[16<07c00f801f003e007c00f800f001e003c007800f001f003e007c00f801f003e0>]
[16<1f000f8007c003e001f000f8007c003e001f800fc007e003f001f8007c003e00>]
[8<c3c300000000c3c3>]
[16<0040008001000200040008001000200040008000000100020004000800100020>]
[16<0040002000100008000400020001800040002000100008000400020001000080>]
[16<1fc03fe07df0f8f8f07de03fc01f800fc01fe03ff07df8f87df03fe01fc00f80>]
[8<80>]
[8<8040201000000000>]
[8<84cc000048cc0000>]
[8<9900009900000000>]
[8<08040201804020100800020180002010>]
[8<2418814242811824>]
[8<66999966>]
[8<8000000008000000>]
[8<70f8d8f870000000>]
[8<0814224180402010>]
[8<aa00440a11a04400>]
[8<018245aa45820100>]
[8<221c224180808041>]
[8<88000000>]
[8<0855800080550800>]
[8<2844004482440044>]
[8<0810204080412214>]
[8<00>]]]def
/Dfill{
 save 6 1 roll
 transform /maxy exch def /maxx exch def
 transform /miny exch def /minx exch def
 minx maxx gt{/minx maxx /maxx minx def def}if
 miny maxy gt{/miny maxy /maxy miny def def}if
 Dpatterns Dstipple 1 sub get exch 1 sub get
 aload pop /stip exch def /stipw exch def /stiph 128 def
 /imatrix[stipw 0 0 stiph 0 0]def
 /tmatrix[stipw 0 0 stiph 0 0]def
 /minx minx cvi stiph idiv stiph mul def
 /miny miny cvi stipw idiv stipw mul def
 eoclip 0 setgray
 miny stiph maxy{
  tmatrix exch 5 exch put
  minx stipw maxx{
   tmatrix exch 4 exch put tmatrix setmatrix
   stipw stiph true imatrix {stip} imagemask
  }for
 }for
 restore
}def
/Dp{Dfill Dstroke}def
/DP{Dfill currentpoint newpath moveto}def
end

/ditstart{$DITroff begin
 /nfonts 60 def			% NFONTS makedev/ditroff dependent!
 /fonts[nfonts{0}repeat]def
 /fontnames[nfonts{()}repeat]def
/docsave save def
}def

% character outcalls
/oc{
 /pswid exch def /cc exch def /name exch def
 /ditwid pswid fontsize mul resolution mul 72000 div def
 /ditsiz fontsize resolution mul 72 div def
 ocprocs name known{ocprocs name get exec}{name cb}ifelse
}def
/fractm [.65 0 0 .6 0 0] def
/fraction{
 /fden exch def /fnum exch def gsave /cf currentfont def
 cf fractm makefont setfont 0 .3 dm 2 copy neg rmoveto
 fnum show rmoveto currentfont cf setfont(\244)show setfont fden show 
 grestore ditwid 0 rmoveto
}def
/oce{grestore ditwid 0 rmoveto}def
/dm{ditsiz mul}def
/ocprocs 50 dict def ocprocs begin
(14){(1)(4)fraction}def
(12){(1)(2)fraction}def
(34){(3)(4)fraction}def
(13){(1)(3)fraction}def
(23){(2)(3)fraction}def
(18){(1)(8)fraction}def
(38){(3)(8)fraction}def
(58){(5)(8)fraction}def
(78){(7)(8)fraction}def
(sr){gsave 0 .06 dm rmoveto(\326)show oce}def
(is){gsave 0 .15 dm rmoveto(\362)show oce}def
(->){gsave 0 .02 dm rmoveto(\256)show oce}def
(<-){gsave 0 .02 dm rmoveto(\254)show oce}def
(==){gsave 0 .05 dm rmoveto(\272)show oce}def
(uc){gsave currentpoint 400 .009 dm mul add translate
     8 -8 scale ucseal oce}def
end

% an attempt at a PostScript FONT to implement ditroff special chars
% this will enable us to 
%	cache the little buggers
%	generate faster, more compact PS out of psdit
%	confuse everyone (including myself)!
50 dict dup begin
/FontType 3 def
/FontName /DIThacks def
/FontMatrix [.001 0 0 .001 0 0] def
/FontBBox [-260 -260 900 900] def% a lie but ...
/Encoding 256 array def
0 1 255{Encoding exch /.notdef put}for
Encoding
 dup 8#040/space put %space
 dup 8#110/rc put %right ceil
 dup 8#111/lt put %left  top curl
 dup 8#112/bv put %bold vert
 dup 8#113/lk put %left  mid curl
 dup 8#114/lb put %left  bot curl
 dup 8#115/rt put %right top curl
 dup 8#116/rk put %right mid curl
 dup 8#117/rb put %right bot curl
 dup 8#120/rf put %right floor
 dup 8#121/lf put %left  floor
 dup 8#122/lc put %left  ceil
 dup 8#140/sq put %square
 dup 8#141/bx put %box
 dup 8#142/ci put %circle
 dup 8#143/br put %box rule
 dup 8#144/rn put %root extender
 dup 8#145/vr put %vertical rule
 dup 8#146/ob put %outline bullet
 dup 8#147/bu put %bullet
 dup 8#150/ru put %rule
 dup 8#151/ul put %underline
 pop
/DITfd 100 dict def
/BuildChar{0 begin
 /cc exch def /fd exch def
 /charname fd /Encoding get cc get def
 /charwid fd /Metrics get charname get def
 /charproc fd /CharProcs get charname get def
 charwid 0 fd /FontBBox get aload pop setcachedevice
 2 setlinejoin 40 setlinewidth
 newpath 0 0 moveto gsave charproc grestore
 end}def
/BuildChar load 0 DITfd put
/CharProcs 50 dict def
CharProcs begin
/space{}def
/.notdef{}def
/ru{500 0 rls}def
/rn{0 840 moveto 500 0 rls}def
/vr{0 800 moveto 0 -770 rls}def
/bv{0 800 moveto 0 -1000 rls}def
/br{0 840 moveto 0 -1000 rls}def
/ul{0 -140 moveto 500 0 rls}def
/ob{200 250 rmoveto currentpoint newpath 200 0 360 arc closepath stroke}def
/bu{200 250 rmoveto currentpoint newpath 200 0 360 arc closepath fill}def
/sq{80 0 rmoveto currentpoint dround newpath moveto
    640 0 rlineto 0 640 rlineto -640 0 rlineto closepath stroke}def
/bx{80 0 rmoveto currentpoint dround newpath moveto
    640 0 rlineto 0 640 rlineto -640 0 rlineto closepath fill}def
/ci{500 360 rmoveto currentpoint newpath 333 0 360 arc
    50 setlinewidth stroke}def

/lt{0 -200 moveto 0 550 rlineto currx 800 2cx s4 add exch s4 a4p stroke}def
/lb{0 800 moveto 0 -550 rlineto currx -200 2cx s4 add exch s4 a4p stroke}def
/rt{0 -200 moveto 0 550 rlineto currx 800 2cx s4 sub exch s4 a4p stroke}def
/rb{0 800 moveto 0 -500 rlineto currx -200 2cx s4 sub exch s4 a4p stroke}def
/lk{0 800 moveto 0 300 -300 300 s4 arcto pop pop 1000 sub
    0 300 4 2 roll s4 a4p 0 -200 lineto stroke}def
/rk{0 800 moveto 0 300 s2 300 s4 arcto pop pop 1000 sub
    0 300 4 2 roll s4 a4p 0 -200 lineto stroke}def
/lf{0 800 moveto 0 -1000 rlineto s4 0 rls}def
/rf{0 800 moveto 0 -1000 rlineto s4 neg 0 rls}def
/lc{0 -200 moveto 0 1000 rlineto s4 0 rls}def
/rc{0 -200 moveto 0 1000 rlineto s4 neg 0 rls}def
end

/Metrics 50 dict def Metrics begin
/.notdef 0 def
/space 500 def
/ru 500 def
/br 0 def
/lt 416 def
/lb 416 def
/rt 416 def
/rb 416 def
/lk 416 def
/rk 416 def
/rc 416 def
/lc 416 def
/rf 416 def
/lf 416 def
/bv 416 def
/ob 350 def
/bu 350 def
/ci 750 def
/bx 750 def
/sq 750 def
/rn 500 def
/ul 500 def
/vr 0 def
end

DITfd begin
/s2 500 def /s4 250 def /s3 333 def
/a4p{arcto pop pop pop pop}def
/2cx{2 copy exch}def
/rls{rlineto stroke}def
/currx{currentpoint pop}def
/dround{transform round exch round exch itransform} def
end
end
/DIThacks exch definefont pop
ditstart
(psc)xT
576 1 1 xr
1(Times-Roman)xf 1 f
2(Times-Italic)xf 2 f
3(Times-Bold)xf 3 f
4(Times-BoldItalic)xf 4 f
5(Helvetica)xf 5 f
6(Helvetica-Bold)xf 6 f
7(Courier)xf 7 f
8(Courier-Bold)xf 8 f
9(Symbol)xf 9 f
10(DIThacks)xf 10 f
10 s
1 f
xi
%%EndProlog

%%Page: 1 1
10 s 10 xH 0 xS 1 f 1 i
8 s
3 f
12 s
1595 984(Networking)N
2104(Implementation)X
2784(Notes)X
1987 1104(4.4BSD)N
2317(Edition)X
2 f
10 s
1121 1296(Samuel)N
1377(J.)X
1453(Lef\257er,)X
1702(William)X
1975(N.)X
2068(Joy,)X
2220(Robert)X
2458(S.)X
2538(Fabry,)X
2774(and)X
2914(Michael)X
3197(J.)X
3273(Karels)X
1 f
1731 1440(Computer)N
2071(Systems)X
2357(Research)X
2672(Group)X
1861 1536(Computer)N
2201(Science)X
2471(Division)X
1328 1632(Department)N
1727(of)X
1814(Electrical)X
2142(Engineering)X
2554(and)X
2690(Computer)X
3030(Science)X
1754 1728(University)N
2112(of)X
2199(California,)X
2564(Berkeley)X
1963 1824(Berkeley,)N
2293(CA)X
2444(94720)X
2 f
2115 2112(ABSTRACT)N
1 f
1064 2304(This)N
1234(report)X
1454(describes)X
1781(the)X
1908(internal)X
2182(structure)X
2492(of)X
2588(the)X
2715(networking)X
3109(facilities)X
3414(developed)X
864 2400(for)N
985(the)X
1110(4.4BSD)X
1392(version)X
1655(of)X
1749(the)X
1874(UNIX*)X
2142(operating)X
2472(system)X
2721(for)X
2842(the)X
2967(VAX\262.)X
3248(These)X
3468(facilities)X
864 2496(are)N
988(based)X
1196(on)X
1301(several)X
1554(central)X
1798(abstractions)X
2206(which)X
2426(structure)X
2731(the)X
2853(external)X
3136(\(user\))X
3348(view)X
3528(of)X
3619(net-)X
864 2592(work)N
1049(communication)X
1567(as)X
1654(well)X
1812(as)X
1899(the)X
2017(internal)X
2282(\(system\))X
2578(implementation.)X
1064 2716(The)N
1236(report)X
1475(documents)X
1869(the)X
2014(internal)X
2306(structure)X
2635(of)X
2750(the)X
2896(networking)X
3309(system.)X
3619(The)X
864 2812(``Berkeley)N
1231(Software)X
1544(Architecture)X
1969(Manual,)X
2257(4.4BSD)X
2534(Edition'')X
2845(\(PSD:5\))X
3129(provides)X
3427(a)X
3485(descrip-)X
864 2908(tion)N
1008(of)X
1095(the)X
1213(user)X
1367(interface)X
1669(to)X
1751(the)X
1869(networking)X
2254(facilities.)X
864 3128(Revised)N
1142(June)X
1309(10,)X
1429(1993)X
8 s
10 f
576 5504(hhhhhhhhhhhhhhhhhh)N
1 f
576 5584(*)N
624(UNIX)X
799(is)X
858(a)X
902(trademark)X
1176(of)X
1245(Bell)X
1368(Laboratories.)X
576 5664(\262)N
624(DEC,)X
784(VAX,)X
954(DECnet,)X
1192(and)X
1300(UNIBUS)X
1554(are)X
1647(trademarks)X
1946(of)X
2015(Digital)X
2209(Equipment)X
2506(Corporation.)X

2 p
%%Page: 2 2
8 s 8 xH 0 xS 1 f 1 i
10 s
576 384(SMM:18-2)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
3 f
1874 672(TABLE)N
2164(OF)X
2295(CONTENTS)X
576 892(1.)N
676(Introduction)X
576 1064(2.)N
676(Overview)X
576 1236(3.)N
676(Goals)X
576 1408(4.)N
676(Internal)X
976(address)X
1258(representation)X
576 1580(5.)N
676(Memory)X
991(management)X
576 1752(6.)N
676(Internal)X
976(layering)X
1 f
576 1848(6.1.)N
776(Socket)X
1014(layer)X
576 1944(6.1.1.)N
836(Socket)X
1074(state)X
576 2040(6.1.2.)N
836(Socket)X
1074(data)X
1228(queues)X
576 2136(6.1.3.)N
836(Socket)X
1074(connection)X
1446(queuing)X
576 2232(6.2.)N
776(Protocol)X
1067(layer\(s\))X
576 2328(6.3.)N
776 0.2344(Network-interface)AX
1386(layer)X
576 2424(6.3.1.)N
836(UNIBUS)X
1154(interfaces)X
3 f
576 2596(7.)N
676(Socket/protocol)X
1230(interface)X
576 2768(8.)N
676(Protocol/protocol)X
1293(interface)X
1 f
576 2864(8.1.)N
796(pr_output)X
576 2960(8.2.)N
796(pr_input)X
576 3056(8.3.)N
796(pr_ctlinput)X
576 3152(8.4.)N
796(pr_ctloutput)X
3 f
576 3324(9.)N
676 0.1600(Protocol/network-interface)AX
1624(interface)X
1 f
576 3420(9.1.)N
796(Packet)X
1030(transmission)X
576 3516(9.2.)N
796(Packet)X
1030(reception)X
3 f
576 3688(10.)N
696(Gateways)X
1050(and)X
1198(routing)X
1471(issues)X
1 f
576 3784(10.1.)N
836(Routing)X
1113(tables)X
576 3880(10.2.)N
836(Routing)X
1113(table)X
1289(interface)X
576 3976(10.3.)N
836(User)X
1008(level)X
1184(routing)X
1435(policies)X
3 f
576 4148(11.)N
696(Raw)X
872(sockets)X
1 f
576 4244(11.1.)N
836(Control)X
1100(blocks)X
576 4340(11.2.)N
836(Input)X
1025(processing)X
576 4436(11.3.)N
836(Output)X
1078(processing)X
3 f
576 4608(12.)N
696(Buffering)X
1045(and)X
1193(congestion)X
1573(control)X
1 f
576 4704(12.1.)N
836(Memory)X
1132(management)X
576 4800(12.2.)N
836(Protocol)X
1127(buffering)X
1446(policies)X
576 4896(12.3.)N
836(Queue)X
1066(limiting)X
576 4992(12.4.)N
836(Packet)X
1070(forwarding)X
3 f
576 5164(13.)N
696(Out)X
849(of)X
936(band)X
1128(data)X
576 5336(14.)N
696(Trailer)X
961(protocols)X
576 5508(Acknowledgements)N
576 5680(References)N

3 p
%%Page: 3 3
10 s 10 xH 0 xS 3 f 1 i
1 f
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3677(SMM:18-3)X
3 f
576 672(1.)N
12 s
684(Introduction)X
1 f
10 s
776 796(This)N
947(report)X
1168(describes)X
1496(the)X
1624(internal)X
1899(structure)X
2210(of)X
2307(facilities)X
2613(added)X
2835(to)X
2927(the)X
3055(4.2BSD)X
3340(version)X
3606(of)X
3703(the)X
3831(UNIX)X
576 892(operating)N
902(system)X
1146(for)X
1262(the)X
1382(VAX,)X
1598(as)X
1687(modi\256ed)X
1993(in)X
2077(the)X
2197(4.4BSD)X
2474(release.)X
2760(The)X
2907(system)X
3151(facilities)X
3449(provide)X
3716(a)X
3774(uniform)X
576 988(user)N
734(interface)X
1041(to)X
1128(networking)X
1518(within)X
1747(UNIX.)X
2013(In)X
2105(addition,)X
2412(the)X
2535(implementation)X
3062(introduces)X
3421(a)X
3482(structure)X
3788(for)X
3907(net-)X
576 1084(work)N
771(communications)X
1330(which)X
1556(may)X
1724(be)X
1830(used)X
2007(by)X
2117(system)X
2369(implementors)X
2839(in)X
2931(adding)X
3179(new)X
3342(networking)X
3736(facilities.)X
576 1180(The)N
724(internal)X
992(structure)X
1296(is)X
1372(not)X
1497(visible)X
1733(to)X
1818(the)X
1939(user,)X
2116(rather)X
2327(it)X
2394(is)X
2471(intended)X
2771(to)X
2857(aid)X
2979(implementors)X
3443(of)X
3534(communication)X
576 1276(protocols)N
906(and)X
1054(network)X
1349(services)X
1640(by)X
1752(providing)X
2095(a)X
2162(framework)X
2546(which)X
2773(promotes)X
3102(code)X
3285(sharing)X
3552(and)X
3699(minimizes)X
576 1372(implementation)N
1098(effort.)X
776 1496(The)N
932(reader)X
1165(is)X
1249(expected)X
1566(to)X
1659(be)X
1766(familiar)X
2051(with)X
2224(the)X
2354(C)X
2439(programming)X
2907(language)X
3229(and)X
3377(system)X
3631(interface,)X
3965(as)X
576 1592(described)N
908(in)X
994(the)X
2 f
1116(Berkeley)X
1422(Software)X
1730(Architecture)X
2155(Manual,)X
2448(4.4BSD)X
2719(Edition)X
1 f
2978([Joy86].)X
3287(Basic)X
3488(understanding)X
3965(of)X
576 1688(network)N
859(communication)X
1377(concepts)X
1678(is)X
1751(assumed;)X
2069(where)X
2286(required)X
2574(any)X
2710(additional)X
3050(ideas)X
3235(are)X
3354(introduced.)X
776 1812(The)N
921(remainder)X
1267(of)X
1354(this)X
1490(document)X
1827(provides)X
2124(a)X
2181(description)X
2558(of)X
2646(the)X
2765(system)X
3008(internals,)X
3325(avoiding,)X
3646(when)X
3841(possi-)X
576 1908(ble,)N
714(those)X
903(portions)X
1185(which)X
1401(are)X
1520(utilized)X
1780(only)X
1942(by)X
2042(the)X
2160(interprocess)X
2568(communication)X
3086(facilities.)X
3 f
576 2100(2.)N
12 s
684(Overview)X
1 f
10 s
776 2224(If)N
853(we)X
970(consider)X
1265(the)X
1386(International)X
1819(Standards)X
2158(Organization's)X
2658(\(ISO\))X
2864(Open)X
3062(System)X
3321(Interconnection)X
3849(\(OSI\))X
576 2320(model)N
815(of)X
921(network)X
1223(communication)X
1760([ISO81])X
2062([Zimmermann80],)X
2691(the)X
2828(networking)X
3232(facilities)X
3547(described)X
3893(here)X
576 2416(correspond)N
958(to)X
1045(a)X
1106(portion)X
1362(of)X
1454(the)X
1577(session)X
1833(layer)X
2019(\(layer)X
2232(3\))X
2324(and)X
2465(all)X
2570(of)X
2663(the)X
2787(transport)X
3098(and)X
3240(network)X
3529(layers)X
3747(\(layers)X
3992(2)X
576 2512(and)N
712(1,)X
792(respectively\).)X
776 2636(The)N
921(network)X
1204(layer)X
1385(provides)X
1681(possibly)X
1967(imperfect)X
2295(data)X
2449(transport)X
2755(services)X
3035(with)X
3198(minimal)X
3485(addressing)X
3849(struc-)X
576 2732(ture.)N
763(Addressing)X
1150(at)X
1230(this)X
1366(level)X
1543(is)X
1617(normally)X
1927(host)X
2081(to)X
2164(host,)X
2338(with)X
2501(implicit)X
2770(or)X
2858(explicit)X
3119(routing)X
3371(optionally)X
3716(supported)X
576 2828(by)N
676(the)X
794(communicating)X
1312(agents.)X
776 2952(At)N
890(the)X
1022(transport)X
1341(layer)X
1536(the)X
1668(notions)X
1937(of)X
2038(reliable)X
2313(transfer,)X
2613(data)X
2781(sequencing,)X
3196(\257ow)X
3372(control,)X
3653(and)X
3804(service)X
576 3048(addressing)N
952(are)X
1084(normally)X
1406(included.)X
1755(Reliability)X
2125(is)X
2211(usually)X
2475(managed)X
2798(by)X
2911(explicit)X
3183(acknowledgement)X
3799(of)X
3898(data)X
576 3144(delivered.)N
935(Failure)X
1183(to)X
1266(acknowledge)X
1711(a)X
1768(transfer)X
2035(results)X
2265(in)X
2348(retransmission)X
2836(of)X
2924(the)X
3043(data.)X
3238(Sequencing)X
3633(may)X
3792(be)X
3889(han-)X
576 3240(dled)N
738(by)X
842(tagging)X
1106(each)X
1278(message)X
1574(handed)X
1830(to)X
1916(the)X
2038(network)X
2325(layer)X
2510(by)X
2614(a)X
2 f
2674(sequence)X
2992(number)X
1 f
3260(and)X
3399(maintaining)X
3804(state)X
3974(at)X
576 3336(the)N
697(endpoints)X
1031(of)X
1121(communication)X
1642(to)X
1727(utilize)X
1950(received)X
2246(sequence)X
2564(numbers)X
2864(in)X
2950(reordering)X
3309(data)X
3467(which)X
3687(arrives)X
3930(out)X
576 3432(of)N
663(order.)X
776 3556(The)N
922(session)X
1174(layer)X
1356(facilities)X
1653(may)X
1812(provide)X
2078(forms)X
2286(of)X
2374(addressing)X
2738(which)X
2955(are)X
3075(mapped)X
3351(into)X
3497(formats)X
3764(required)X
576 3652(by)N
683(the)X
808(transport)X
1120(layer,)X
1328(service)X
1583(authentication)X
2064(and)X
2207(client)X
2412(authentication,)X
2913(etc.)X
3073(Various)X
3353(systems)X
3632(also)X
3787(provide)X
576 3748(services)N
855(such)X
1022(as)X
1109(data)X
1263(encryption)X
1626(and)X
1762(address)X
2023(and)X
2159(protocol)X
2446(translation.)X
776 3872(The)N
924(following)X
1258(sections)X
1539(begin)X
1740(by)X
1843(describing)X
2200(some)X
2392(of)X
2482(the)X
2603(common)X
2906(data)X
3064(structures)X
3400(and)X
3540(utility)X
3754(routines,)X
576 3968(then)N
738(examine)X
1033(the)X
1154(internal)X
1422(layering.)X
1748(The)X
1896(contents)X
2186(of)X
2276(each)X
2447(layer)X
2631(and)X
2770(its)X
2868(interface)X
3173(are)X
3295(considered.)X
3706(Certain)X
3965(of)X
576 4064(the)N
701(interfaces)X
1041(are)X
1167(protocol)X
1461(implementation)X
1990(speci\256c.)X
2302(For)X
2440(these)X
2632(cases)X
2830(examples)X
3161(have)X
3341(been)X
3521(drawn)X
3750(from)X
3934(the)X
576 4160(Internet)N
853([Cerf78])X
1157(protocol)X
1450(family.)X
1725(Later)X
1921(sections)X
2205(cover)X
2410(routing)X
2667(issues,)X
2904(the)X
3028(design)X
3263(of)X
3356(the)X
3480(raw)X
3627(socket)X
3858(inter-)X
576 4256(face)N
731(and)X
867(other)X
1052(miscellaneous)X
1526(topics.)X
3 f
576 4448(3.)N
12 s
684(Goals)X
1 f
10 s
776 4572(The)N
934(networking)X
1333(system)X
1589(was)X
1748(designed)X
2067(with)X
2243(the)X
2375(goal)X
2547(of)X
2648(supporting)X
3024(multiple)X
2 f
3324(protocol)X
3629(families)X
1 f
3916(and)X
576 4668(addressing)N
948(styles.)X
1199(This)X
1370(required)X
1667(information)X
2074(to)X
2165(be)X
2270(``hidden'')X
2625(in)X
2716(common)X
3024(data)X
3186(structures)X
3526(which)X
3750(could)X
3956(be)X
576 4764(manipulated)N
995(by)X
1098(all)X
1202(the)X
1324(pieces)X
1549(of)X
1640(the)X
1762(system,)X
2028(but)X
2154(which)X
2374(required)X
2666(interpretation)X
3122(only)X
3288(by)X
3392(the)X
3514(protocols)X
3836(which)X
576 4860(``controlled'')N
1031(it.)X
1137(The)X
1284(system)X
1528(described)X
1858(here)X
2019(attempts)X
2312(to)X
2396(minimize)X
2720(the)X
2840(use)X
2969(of)X
3058(shared)X
3290(data)X
3446(structures)X
3780(to)X
3863(those)X
576 4956(kept)N
742(by)X
850(a)X
914(suite)X
1094(of)X
1190(protocols)X
1517(\(a)X
2 f
1609(protocol)X
1909(family)X
1 f
(\),)S
2185(and)X
2330(those)X
2528(used)X
2704(for)X
2827(rendezvous)X
3222(between)X
3519(``synchronous'')X
576 5052(and)N
722(``asynchronous'')X
1301(portions)X
1593(of)X
1690(the)X
1818(system)X
2070(\(e.g.)X
2243(queues)X
2496(of)X
2593(data)X
2757(packets)X
3028(are)X
3157(\256lled)X
3351(at)X
3439(interrupt)X
3745(time)X
3916(and)X
576 5148(emptied)N
854(based)X
1057(on)X
1157(user)X
1311(requests\).)X
776 5272(A)N
860(major)X
1073(goal)X
1237(of)X
1330(the)X
1454(system)X
1702(was)X
1853(to)X
1941(provide)X
2212(a)X
2274(framework)X
2653(within)X
2883(which)X
3105(new)X
3265(protocols)X
3589(and)X
3732(hardware)X
576 5368(could)N
776(be)X
874(easily)X
1083(be)X
1181(supported.)X
1559(To)X
1670(this)X
1807(end,)X
1965(a)X
2023(great)X
2206(deal)X
2362(of)X
2451(effort)X
2652(has)X
2781(been)X
2955(extended)X
3266(to)X
3349(create)X
3563(utility)X
3774(routines)X
576 5464(which)N
800(hide)X
966(many)X
1172(of)X
1267(the)X
1393(more)X
1586(complex)X
1890(and/or)X
2123(hardware)X
2451(dependent)X
2809(chores)X
3047(of)X
3142(networking.)X
3575(Later)X
3774(sections)X
576 5560(describe)N
864(the)X
982(utility)X
1192(routines)X
1470(and)X
1606(the)X
1724(underlying)X
2091(data)X
2245(structures)X
2577(they)X
2735(manipulate.)X

4 p
%%Page: 4 4
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-4)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
3 f
576 672(4.)N
12 s
684(Internal)X
1044(address)X
1382(representation)X
1 f
10 s
776 796(Common)N
1095(to)X
1179(all)X
1281(portions)X
1565(of)X
1654(the)X
1774(system)X
2018(are)X
2139(two)X
2281(data)X
2437(structures.)X
2811(These)X
3025(structures)X
3360(are)X
3482(used)X
3652(to)X
3737(represent)X
576 892(addresses)N
904(and)X
1040(various)X
1296(data)X
1450(objects.)X
1737(Addresses,)X
2107(internally)X
2434(are)X
2553(described)X
2881(by)X
2981(the)X
2 f
3099(sockaddr)X
1 f
3413(structure,)X
864 1036(struct)N
1062(sockaddr)X
1372({)X
1152 1132(short)N
1584(sa_family;)X
2304(/*)X
2386(data)X
2540(format)X
2774(identi\256er)X
3083(*/)X
1152 1228(char)N
1584(sa_data[14];)X
2304(/*)X
2386(address)X
2647(*/)X
864 1324(};)N
576 1468(All)N
708(addresses)X
1046(belong)X
1294(to)X
1386(one)X
1532(or)X
1629(more)X
2 f
1824(address)X
2103(families)X
1 f
2386(which)X
2612(de\256ne)X
2838(their)X
3015(format)X
3259(and)X
3405(interpretation.)X
3907(The)X
2 f
576 1564(sa_family)N
1 f
908(\256eld)X
1071(indicates)X
1377(the)X
1496(address)X
1758(family)X
1988(to)X
2071(which)X
2288(the)X
2407(address)X
2669(belongs,)X
2958(and)X
3094(the)X
2 f
3212(sa_data)X
1 f
3485(\256eld)X
3647(contains)X
3934(the)X
576 1660(actual)N
789(data)X
944(value.)X
1179(The)X
1325(size)X
1471(of)X
1559(the)X
1678(data)X
1833(\256eld,)X
2016(14)X
2117(bytes,)X
2327(was)X
2473(selected)X
2753(based)X
2957(on)X
3058(a)X
3115(study)X
3309(of)X
3398(current)X
3648(address)X
3911(for-)X
576 1756(mats.*)N
837(Speci\256c)X
1125(address)X
1396(formats)X
1671(use)X
1808(private)X
2061(structure)X
2372(de\256nitions)X
2739(that)X
2889(de\256ne)X
3114(the)X
3241(format)X
3484(of)X
3580(the)X
3707(data)X
3870(\256eld.)X
576 1852(The)N
721(system)X
964(interface)X
1267(supports)X
1559(larger)X
1768(address)X
2030(structures,)X
2383(although)X
2684(address-family-independent)X
3601(support)X
3862(facil-)X
576 1948(ities,)N
755(for)X
875(example)X
1173(routing)X
1430(and)X
1572(raw)X
1719(socket)X
1950(interfaces,)X
2309(provide)X
2580(only)X
2748(14)X
2854(bytes)X
3048(for)X
3167(address)X
3433(storage.)X
3730(Protocols)X
576 2044(that)N
716(do)X
816(not)X
938(use)X
1065(those)X
1254(facilities)X
1550(\(e.g,)X
1713(the)X
1831(current)X
2079(Unix)X
2259(domain\))X
2546(may)X
2704(use)X
2831(larger)X
3039(data)X
3193(areas.)X
3 f
576 2236(5.)N
12 s
684(Memory)X
1061(management)X
1 f
10 s
776 2360(A)N
858(single)X
1073(mechanism)X
1462(is)X
1539(used)X
1710(for)X
1828(data)X
1986(storage:)X
2264(memory)X
2555(buffers,)X
2828(or)X
2 f
2920(mbuf)X
1 f
('s.)S
3203(An)X
3326(mbuf)X
3520(is)X
3598(a)X
3659(structure)X
3965(of)X
576 2456(the)N
694(form:)X
864 2600(struct)N
1062(mbuf)X
1251({)X
1152 2696(struct)N
1584(mbuf)X
1773(*m_next;)X
2304(/*)X
2386(next)X
2544(buffer)X
2761(in)X
2843(chain)X
3037(*/)X
1152 2792(u_long)N
1584(m_off;)X
2304(/*)X
2386(offset)X
2589(of)X
2676(data)X
2830(*/)X
1152 2888(short)N
1584(m_len;)X
2304(/*)X
2386(amount)X
2646(of)X
2733(data)X
2887(in)X
2969(this)X
3104(mbuf)X
3293(*/)X
1152 2984(short)N
1584(m_type;)X
2304(/*)X
2386(mbuf)X
2575(type)X
2733(\(accounting\))X
3159(*/)X
1152 3080(u_char)N
1584(m_dat[MLEN];)X
2304(/*)X
2386(data)X
2540(storage)X
2792(*/)X
1152 3176(struct)N
1584(mbuf)X
1773(*m_act;)X
2304(/*)X
2386(link)X
2530(in)X
2612(higher-level)X
3020(mbuf)X
3209(list)X
3326(*/)X
864 3272(};)N
576 3416(The)N
2 f
724(m_next)X
1 f
979(\256eld)X
1144(is)X
1220(used)X
1390(to)X
1475(chain)X
1672(mbufs)X
1895(together)X
2181(on)X
2284(linked)X
2507(lists,)X
2678(while)X
2879(the)X
2 f
3001(m_act)X
1 f
3221(\256eld)X
3387(allows)X
3620(lists)X
3772(of)X
3863(mbuf)X
576 3512(chains)N
802(to)X
885(be)X
982(accumulated.)X
1449(By)X
1563(convention,)X
1960(the)X
2079(mbufs)X
2300(common)X
2601(to)X
2684(a)X
2740(single)X
2951(object)X
3167(\(for)X
3308(example,)X
3620(a)X
3676(packet\))X
3933(are)X
576 3608(chained)N
856(together)X
1149(with)X
1321(the)X
2 f
1450(m_next)X
1 f
1713(\256eld,)X
1906(while)X
2115(groups)X
2364(of)X
2462(objects)X
2720(are)X
2850(linked)X
3081(via)X
3210(the)X
2 f
3339(m_act)X
1 f
3566(\256eld)X
3739(\(possibly)X
576 3704(when)N
770(in)X
852(a)X
908(queue\).)X
776 3828(Each)N
973(mbuf)X
1178(has)X
1321(a)X
1393(small)X
1602(data)X
1772(area)X
1943(for)X
2073(storing)X
2331(information,)X
2 f
2765(m_dat)X
1 f
(.)S
3041(The)X
2 f
3202(m_len)X
1 f
3434(\256eld)X
3612(indicates)X
3934(the)X
576 3924(amount)N
843(of)X
937(data,)X
1118(while)X
1323(the)X
2 f
1448(m_off)X
1 f
1657(\256eld)X
1826(is)X
1905(an)X
2007(offset)X
2216(to)X
2304(the)X
2428(beginning)X
2774(of)X
2867(the)X
2991(data)X
3151(from)X
3333(the)X
3457(base)X
3626(of)X
3719(the)X
3843(mbuf.)X
576 4020(Thus,)N
780(for)X
898(example,)X
1214(the)X
1336(macro)X
2 f
1562(mtod)X
1 f
(,)S
1767(which)X
1988(converts)X
2285(a)X
2346(pointer)X
2598(to)X
2685(an)X
2786(mbuf)X
2980(to)X
3067(a)X
3128(pointer)X
3380(to)X
3467(the)X
3590(data)X
3749(stored)X
3970(in)X
576 4116(the)N
694(mbuf,)X
903(has)X
1030(the)X
1148(form)X
864 4260(#de\256ne)N
1209(mtod\()X
2 f
1400(x)X
1 f
1436(,)X
2 f
(t)S
1 f
1478(\))X
2073(\(\()X
2 f
2127(t)X
1 f
2149(\)\(\(int\)\()X
2 f
2368(x)X
1 f
2404(\))X
2451(+)X
2516(\()X
2 f
2543(x)X
1 f
2579(\)->m_off\)\))X
576 4404(\(note)N
761(the)X
2 f
879(t)X
1 f
921(parameter,)X
1283(a)X
1339(C)X
1412(type)X
1570(cast,)X
1735(which)X
1951(is)X
2024(used)X
2191(to)X
2273(cast)X
2418(the)X
2536(resultant)X
2832(pointer)X
3079(for)X
3193(proper)X
3423(assignment\).)X
776 4528(In)N
864(addition)X
1147(to)X
1230(storing)X
1473(data)X
1628(directly)X
1894(in)X
1977(the)X
2097(mbuf's)X
2346(data)X
2502(area,)X
2679(data)X
2835(of)X
2924(page)X
3098(size)X
3245(may)X
3405(be)X
3503(also)X
3654(be)X
3752(stored)X
3970(in)X
576 4624(a)N
636(separate)X
924(area)X
1083(of)X
1174(memory.)X
1505(The)X
1654(mbuf)X
1847(utility)X
2061(routines)X
2343(maintain)X
2647(a)X
2707(pool)X
2873(of)X
2964(pages)X
3171(for)X
3289(this)X
3428(purpose)X
3706(and)X
3845(mani-)X
576 4720(pulate)N
797(a)X
858(private)X
1106(page)X
1283(map)X
1446(for)X
1566(such)X
1739(pages.)X
1988(An)X
2112(mbuf)X
2307(with)X
2475(an)X
2577(external)X
2862(data)X
3022(area)X
3183(may)X
3347(be)X
3449(recognized)X
3828(by)X
3934(the)X
576 4816(larger)N
795(offset)X
1009(to)X
1102(the)X
1231(data)X
1395(area;)X
1582(this)X
1727(is)X
1810(formalized)X
2188(by)X
2298(the)X
2426(macro)X
2657(M_HASCL\()X
2 f
(m)S
1 f
3115(\),)X
3192(which)X
3418(is)X
3501(true)X
3656(if)X
3735(the)X
3863(mbuf)X
576 4912(whose)N
803(address)X
1066(is)X
2 f
1141(m)X
1 f
1221(has)X
1350(an)X
1449(external)X
1731(page)X
1906(cluster.)X
2183(An)X
2304(array)X
2493(of)X
2583 0.4531(reference)AX
2907(counts)X
3139(on)X
3242(pages)X
3448(is)X
3524(also)X
3676(maintained)X
576 5008(so)N
670(that)X
813(copies)X
1041(of)X
1131(pages)X
1337(may)X
1498(be)X
1597(made)X
1794(without)X
2061(core)X
2223(to)X
2308(core)X
2470(copying)X
2771(\(copies)X
3026(are)X
3148(created)X
3404(simply)X
3644(by)X
3747(duplicat-)X
576 5104(ing)N
698(the)X
816 0.4531(reference)AX
1137(to)X
1219(the)X
1337(data)X
1492(and)X
1629(incrementing)X
2073(the)X
2192(associated)X
2543 0.4531(reference)AX
2865(counts)X
3095(for)X
3210(the)X
3329(pages\).)X
3600(Separate)X
3898(data)X
576 5200(pages)N
786(are)X
912(currently)X
1229(used)X
1403(only)X
1572(when)X
1773(copying)X
2058(data)X
2219(from)X
2402(a)X
2465(user)X
2626(process)X
2894(into)X
3045(the)X
3170(kernel,)X
3418(and)X
3561(when)X
3761(bringing)X
576 5296(data)N
737(in)X
826(at)X
911(the)X
1036(hardware)X
1363(level.)X
1587(Routines)X
1899(which)X
2123(manipulate)X
2507(mbufs)X
2735(are)X
2862(not)X
2992(normally)X
3309(aware)X
3530(whether)X
3817(data)X
3979(is)X
576 5392(stored)N
792(directly)X
1057(in)X
1139(the)X
1257(mbuf)X
1446(data)X
1600(array,)X
1806(or)X
1893(if)X
1962(it)X
2026(is)X
2099(kept)X
2257(in)X
2339(separate)X
2623(pages.)X
8 s
10 f
576 5584(hhhhhhhhhhhhhhhhhh)N
1 f
576 5664(*)N
624(Later)X
774(versions)X
1003(of)X
1072(the)X
1166(system)X
1360(may)X
1486(support)X
1694(variable)X
1915(length)X
2091(addresses.)X

5 p
%%Page: 5 5
8 s 8 xH 0 xS 1 f 1 i
10 s
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3677(SMM:18-5)X
776 672(The)N
921(following)X
1252(may)X
1410(be)X
1506(used)X
1673(to)X
1755(allocate)X
2025(and)X
2161(free)X
2307(mbufs:)X
576 796(m)N
658(=)X
723(m_get\(wait,)X
1128(type\);)X
576 892(MGET\(m,)N
932(wait,)X
1110(type\);)X
776 1016(The)N
930(subroutine)X
2 f
1297(m_get)X
1 f
1522(and)X
1667(the)X
1794(macro)X
2 f
2024(MGET)X
1 f
2271(each)X
2448(allocate)X
2727(an)X
2832(mbuf,)X
3050(placing)X
3315(its)X
3419(address)X
3689(in)X
2 f
3780(m)X
1 f
3838(.)X
3907(The)X
776 1112(argument)N
2 f
1105(wait)X
1 f
1268(is)X
1347(either)X
1555(M_WAIT)X
1901(or)X
1993(M_DONTWAIT)X
2562(according)X
2904(to)X
2991(whether)X
3275(allocation)X
3616(should)X
3854(block)X
776 1208(or)N
865(fail)X
994(if)X
1065(no)X
1167(mbuf)X
1358(is)X
1433(available.)X
1785(The)X
2 f
1932(type)X
1 f
2088(is)X
2163(one)X
2301(of)X
2391(the)X
2512(prede\256ned)X
2874(mbuf)X
3066(types)X
3258(for)X
3375(use)X
3505(in)X
3590(accounting)X
3965(of)X
776 1304(mbuf)N
965(allocation.)X
576 1428(MCLGET\(m\);)N
776 1524(This)N
939(macro)X
1161(attempts)X
1453(to)X
1536(allocate)X
1807(an)X
1904(mbuf)X
2094(page)X
2267(cluster)X
2502(to)X
2585(associate)X
2896(with)X
3059(the)X
3178(mbuf)X
2 f
3368(m)X
1 f
3426(.)X
3487(If)X
3562(successful,)X
3934(the)X
776 1620(length)N
996(of)X
1083(the)X
1201(mbuf)X
1390(is)X
1463(set)X
1572(to)X
1654(CLSIZE,)X
1965(the)X
2083(size)X
2228(of)X
2315(the)X
2433(page)X
2605(cluster.)X
576 1744(n)N
636(=)X
701(m_free\(m\);)X
576 1840(MFREE\(m,n\);)N
776 1964(The)N
926(routine)X
2 f
1178(m_free)X
1 f
1427(and)X
1569(the)X
1693(macro)X
2 f
1920(MFREE)X
1 f
2209(each)X
2383(free)X
2535(a)X
2597(single)X
2814(mbuf,)X
2 f
3029(m)X
1 f
3087(,)X
3133(and)X
3275(any)X
3417(associated)X
3773(external)X
776 2060(storage)N
1028(area,)X
1203(placing)X
1459(a)X
1515(pointer)X
1762(to)X
1844(its)X
1939(successor)X
2267(in)X
2349(the)X
2467(chain)X
2661(it)X
2725(heads,)X
2948(if)X
3017(any,)X
3173(in)X
2 f
3255(n)X
1 f
(.)S
576 2184(m_freem\(m\);)N
776 2280(This)N
938(routine)X
1185(frees)X
1362(an)X
1458(mbuf)X
1647(chain)X
1841(headed)X
2089(by)X
2 f
2189(m)X
1 f
2247(.)X
776 2404(The)N
921(following)X
1252(utility)X
1462(routines)X
1740(are)X
1859(available)X
2169(for)X
2283(manipulating)X
2725(mbuf)X
2914(chains:)X
576 2528(m)N
658(=)X
723(m_copy\(m0,)X
1150(off,)X
1284(len\);)X
776 2624(The)N
2 f
921(m_copy)X
1 f
1191(routine)X
1438(create)X
1651(a)X
1707(copy)X
1883(of)X
1970(all,)X
2090(or)X
2177(part,)X
2342(of)X
2429(a)X
2485(list)X
2603(of)X
2691(the)X
2810(mbufs)X
3031(in)X
2 f
3114(m0)X
1 f
3212(.)X
2 f
3273(Len)X
1 f
3414(bytes)X
3604(of)X
3692(data,)X
3867(start-)X
776 2720(ing)N
2 f
904(off)X
1 f
1014(bytes)X
1209(from)X
1391(the)X
1515(front)X
1696(of)X
1788(the)X
1911(chain,)X
2130(are)X
2254(copied.)X
2513(Where)X
2753(possible,)X
3060 0.4531(reference)AX
3386(counts)X
3620(on)X
3725(pages)X
3933(are)X
776 2816(used)N
951(instead)X
1206(of)X
1301(core)X
1468(to)X
1558(core)X
1725(copies.)X
1998(The)X
2151(original)X
2428(mbuf)X
2625(chain)X
2827(must)X
3010(have)X
3190(at)X
3277(least)X
2 f
3453(off)X
1 f
3566(+)X
2 f
3640(len)X
1 f
3767(bytes)X
3965(of)X
776 2912(data.)N
970(If)X
2 f
1044(len)X
1 f
1162(is)X
1235(speci\256ed)X
1540(as)X
1627(M_COPYALL,)X
2147(all)X
2247(the)X
2365(data)X
2519(present,)X
2791(offset)X
2994(as)X
3081(before,)X
3327(is)X
3400(copied.)X
576 3036(m_cat\(m,)N
901(n\);)X
776 3132(The)N
921(mbuf)X
1110(chain,)X
2 f
1324(n)X
1 f
(,)S
1404(is)X
1477(appended)X
1805(to)X
1887(the)X
2005(end)X
2141(of)X
2 f
2228(m)X
1 f
2286(.)X
2346(Where)X
2581(possible,)X
2883(compaction)X
3277(is)X
3350(performed.)X
576 3256(m_adj\(m,)N
905(diff\);)X
776 3352(The)N
925(mbuf)X
1118(chain,)X
2 f
1336(m)X
1 f
1418(is)X
1495(adjusted)X
1786(in)X
1872(size)X
2021(by)X
2 f
2125(diff)X
1 f
2255(bytes.)X
2489(If)X
2 f
2568(diff)X
1 f
2699(is)X
2777(non-negative,)X
2 f
3241(diff)X
1 f
3372(bytes)X
3566(are)X
3690(shaved)X
3938(off)X
776 3448(the)N
902(front)X
1086(of)X
1181(the)X
1307(mbuf)X
1504(chain.)X
1746(If)X
2 f
1828(diff)X
1 f
1962(is)X
2043(negative,)X
2363(the)X
2488(alteration)X
2818(is)X
2898(performed)X
3260(from)X
3443(back)X
3622(to)X
3711(front.)X
3934(No)X
776 3544(space)N
981(is)X
1060(reclaimed)X
1403(in)X
1491(this)X
1632(operation;)X
1983(alterations)X
2343(are)X
2468(accomplished)X
2935(by)X
3041(changing)X
3361(the)X
2 f
3485(m_len)X
1 f
3707(and)X
2 f
3850(m_off)X
1 f
776 3640(\256elds)N
969(of)X
1056(mbufs.)X
576 3764(m)N
658(=)X
723(m_pullup\(m0,)X
1198(size\);)X
776 3860(After)N
966(a)X
1022(successful)X
1373(call)X
1510(to)X
2 f
1593(m_pullup)X
1 f
1895(,)X
1936(the)X
2055(mbuf)X
2245(at)X
2324(the)X
2443(head)X
2616(of)X
2704(the)X
2823(returned)X
3112(list,)X
2 f
3250(m)X
1 f
3308(,)X
3349(is)X
3423(guaranteed)X
3797(to)X
3880(have)X
776 3956(at)N
855(least)X
2 f
1023(size)X
1 f
1164(bytes)X
1354(of)X
1442(data)X
1596(in)X
1678(contiguous)X
2049(memory)X
2336(within)X
2560(the)X
2678(data)X
2832(area)X
2987(of)X
3074(the)X
3192(mbuf)X
3381(\(allowing)X
3708(access)X
3934(via)X
776 4052(a)N
836(pointer,)X
1107(obtained)X
1407(using)X
1604(the)X
2 f
1726(mtod)X
1 f
1910(macro,)X
2155(and)X
2295(allowing)X
2599(the)X
2721(mbuf)X
2914(to)X
3000(be)X
3100(located)X
3356(from)X
3536(a)X
3596(pointer)X
3847(to)X
3934(the)X
776 4148(data)N
942(area)X
1109(using)X
2 f
1314(dtom)X
1 f
(,)S
1526(de\256ned)X
1794(below\).)X
2089(If)X
2175(the)X
2305(original)X
2586(data)X
2752(was)X
2909(less)X
3061(than)X
2 f
3231(size)X
1 f
3383(bytes)X
3584(long,)X
2 f
3778(len)X
1 f
3907(was)X
776 4244(greater)N
1021(than)X
1180(the)X
1299(size)X
1445(of)X
1533(an)X
1630(mbuf)X
1821(data)X
1977(area)X
2134(\(112)X
2303(bytes\),)X
2541(or)X
2630(required)X
2920(resources)X
3246(were)X
3425(unavailable,)X
2 f
3837(m)X
1 f
3917(is)X
3992(0)X
776 4340(and)N
912(the)X
1030(original)X
1299(mbuf)X
1488(chain)X
1682(is)X
1755(deallocated.)X
776 4464(This)N
942(routine)X
1193(is)X
1270(particularly)X
1665(useful)X
1886(when)X
2085(verifying)X
2404(packet)X
2639(header)X
2879(lengths)X
3135(on)X
3240(reception.)X
3604(For)X
3740(example,)X
776 4560(if)N
853(a)X
917(packet)X
1155(is)X
1236(received)X
1537(and)X
1681(only)X
1851(8)X
1919(of)X
2014(the)X
2140(necessary)X
2481(16)X
2589(bytes)X
2786(required)X
3082(for)X
3204(a)X
3267(valid)X
3454(packet)X
3691(header)X
3933(are)X
776 4656(present)N
1028(at)X
1106(the)X
1224(head)X
1396(of)X
1483(the)X
1601(list)X
1718(of)X
1805(mbufs)X
2025(representing)X
2442(the)X
2560(packet,)X
2810(the)X
2928(remaining)X
3273(8)X
3333(bytes)X
3522(may)X
3681(be)X
3778(``pulled)X
776 4752(up'')N
930(with)X
1092(a)X
1148(single)X
2 f
1359(m_pullup)X
1 f
1681(call.)X
1857(If)X
1931(the)X
2049(call)X
2185(fails)X
2343(the)X
2461(invalid)X
2703(packet)X
2933(will)X
3077(have)X
3249(been)X
3421(discarded.)X
776 4876(By)N
889(insuring)X
1171(that)X
1311(mbufs)X
1531(always)X
1775(reside)X
1988(on)X
2089(128)X
2230(byte)X
2389(boundaries,)X
2782(it)X
2847(is)X
2921(always)X
3165(possible)X
3448(to)X
3531(locate)X
3744(the)X
3863(mbuf)X
576 4972(associated)N
928(with)X
1092(a)X
1150(data)X
1306(area)X
1463(by)X
1565(masking)X
1858(off)X
1973(the)X
2092(low)X
2233(bits)X
2369(of)X
2457(the)X
2576(virtual)X
2806(address.)X
3108(This)X
3271(allows)X
3501(modules)X
3793(to)X
3876(store)X
576 5068(data)N
742(structures)X
1086(in)X
1181(mbufs)X
1414(and)X
1563(pass)X
1734(them)X
1927(around)X
2183(without)X
2460(concern)X
2748(for)X
2875(locating)X
3166(the)X
3297(original)X
3579(mbuf)X
3781(when)X
3988(it)X
576 5164(comes)N
803(time)X
967(to)X
1051(free)X
1199(the)X
1319(structure.)X
1662(Note)X
1839(that)X
1980(this)X
2116(works)X
2333(only)X
2496(with)X
2659(objects)X
2907(stored)X
3124(in)X
3207(the)X
3326(internal)X
3592(data)X
3747(buffer)X
3965(of)X
576 5260(the)N
694(mbuf.)X
923(The)X
2 f
1068(dtom)X
1 f
1248(macro)X
1469(is)X
1542(used)X
1709(to)X
1791(convert)X
2052(a)X
2108(pointer)X
2355(into)X
2499(an)X
2595(mbuf's)X
2842(data)X
2996(area)X
3151(to)X
3233(a)X
3289(pointer)X
3536(to)X
3618(the)X
3736(mbuf,)X
864 5404(#de\256ne)N
1264(dtom\(x\))X
1664(\(\(struct)X
1916(mbuf)X
2105(*\)\(\(int\)x)X
2397(&)X
2479(\304\(MSIZE-1\)\)\))X
776 5576(Mbufs)N
1014(are)X
1142(used)X
1318(for)X
1441(dynamically)X
1866(allocated)X
2185(data)X
2348(structures)X
2689(such)X
2865(as)X
2961(sockets)X
3226(as)X
3323(well)X
3491(as)X
3588(memory)X
3885(allo-)X
576 5672(cated)N
771(for)X
890(packets)X
1156(and)X
1297(headers.)X
1608(Statistics)X
1921(are)X
2045(maintained)X
2426(on)X
2531(mbuf)X
2725(usage)X
2933(and)X
3074(can)X
3210(be)X
3310(viewed)X
3566(by)X
3670(users)X
3859(using)X
576 5768(the)N
2 f
694(netstat)X
1 f
920(\(1\))X
1034(program.)X

6 p
%%Page: 6 6
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-6)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
3 f
576 672(6.)N
12 s
684(Internal)X
1044(layering)X
1 f
10 s
776 796(The)N
923(internal)X
1190(structure)X
1493(of)X
1583(the)X
1704(network)X
1990(system)X
2235(is)X
2311(divided)X
2574(into)X
2721(three)X
2905(layers.)X
3160(These)X
3375(layers)X
3590(correspond)X
3970(to)X
576 892(the)N
698(services)X
981(provided)X
1290(by)X
1394(the)X
1515(socket)X
1743(abstraction,)X
2138(those)X
2330(provided)X
2638(by)X
2741(the)X
2862(communication)X
3383(protocols,)X
3724(and)X
3863(those)X
576 988(provided)N
883(by)X
985(the)X
1105(hardware)X
1427(interfaces.)X
1803(The)X
1951(communication)X
2472(protocols)X
2793(are)X
2915(normally)X
3227(layered)X
3487(into)X
3634(two)X
3777(or)X
3867(more)X
576 1084(individual)N
922(cooperating)X
1323(layers,)X
1557(though)X
1800(they)X
1959(are)X
2079(collectively)X
2474(viewed)X
2727(in)X
2810(the)X
2929(system)X
3172(as)X
3260(one)X
3397(layer)X
3579(providing)X
3911(ser-)X
576 1180(vices)N
761(supportive)X
1119(of)X
1206(the)X
1324(appropriate)X
1710(socket)X
1935(abstraction.)X
776 1304(The)N
921(following)X
1252(sections)X
1530(describe)X
1818(the)X
1937(properties)X
2279(of)X
2367(each)X
2536(layer)X
2718(in)X
2801(the)X
2920(system)X
3163(and)X
3300(the)X
3419(interfaces)X
3753(to)X
3836(which)X
576 1400(each)N
744(must)X
919(conform.)X
3 f
576 1592(6.1.)N
736(Socket)X
983(layer)X
1 f
776 1716(The)N
932(socket)X
1169(layer)X
1362(deals)X
1559(with)X
1733(the)X
1863(interprocess)X
2283(communication)X
2813(facilities)X
3121(provided)X
3438(by)X
3550(the)X
3680(system.)X
3974(A)X
576 1812(socket)N
804(is)X
880(a)X
939(bidirectional)X
1367(endpoint)X
1670(of)X
1760(communication)X
2281(which)X
2500(is)X
2576(``typed'')X
2885(by)X
2987(the)X
3107(semantics)X
3445(of)X
3534(communication)X
576 1908(it)N
644(supports.)X
979(The)X
1128(system)X
1374(calls)X
1545(described)X
1878(in)X
1965(the)X
2 f
2088(Berkeley)X
2395(Software)X
2704(Architecture)X
3130(Manual)X
1 f
3404([Joy86])X
3674(are)X
3798(used)X
3970(to)X
576 2004(manipulate)N
952(sockets.)X
776 2128(A)N
854(socket)X
1079(consists)X
1352(of)X
1439(the)X
1557(following)X
1888(data)X
2042(structure:)X
864 2272(struct)N
1062(socket)X
1287({)X
1152 2368(short)N
1584(so_type;)X
2304(/*)X
2386(generic)X
2643(type)X
2801(*/)X
1152 2464(short)N
1584(so_options;)X
2304(/*)X
2386(from)X
2562(socket)X
2787(call)X
2923(*/)X
1152 2560(short)N
1584(so_linger;)X
2304(/*)X
2386(time)X
2548(to)X
2630(linger)X
2837(while)X
3035(closing)X
3286(*/)X
1152 2656(short)N
1584(so_state;)X
2304(/*)X
2386(internal)X
2651(state)X
2818(\257ags)X
2989(*/)X
1152 2752(caddr_t)N
1584(so_pcb;)X
2304(/*)X
2386(protocol)X
2673(control)X
2920(block)X
3118(*/)X
1152 2848(struct)N
1584(protosw)X
1862(*so_proto;)X
2304(/*)X
2386(protocol)X
2673(handle)X
2907(*/)X
1152 2944(struct)N
1584(socket)X
1809(*so_head;)X
2304(/*)X
2386(back)X
2558(pointer)X
2805(to)X
2887(accept)X
3113(socket)X
3338(*/)X
1152 3040(struct)N
1584(socket)X
1809(*so_q0;)X
2304(/*)X
2386(queue)X
2598(of)X
2685(partial)X
2910(connections)X
3313(*/)X
1152 3136(short)N
1584(so_q0len;)X
2304(/*)X
2386(partials)X
2642(on)X
2742(so_q0)X
2953(*/)X
1152 3232(struct)N
1584(socket)X
1809(*so_q;)X
2304(/*)X
2386(queue)X
2598(of)X
2685(incoming)X
3007(connections)X
3410(*/)X
1152 3328(short)N
1584(so_qlen;)X
2304(/*)X
2386(number)X
2651(of)X
2738(connections)X
3141(on)X
3241(so_q)X
3412(*/)X
1152 3424(short)N
1584(so_qlimit;)X
2304(/*)X
2386(max)X
2544(number)X
2809(queued)X
3061(connections)X
3464(*/)X
1152 3520(struct)N
1584(sockbuf)X
1858(so_rcv;)X
2304(/*)X
2386(receive)X
2639(queue)X
2851(*/)X
1152 3616(struct)N
1584(sockbuf)X
1858(so_snd;)X
2304(/*)X
2386(send)X
2553(queue)X
2765(*/)X
1152 3712(short)N
1584(so_timeo;)X
2304(/*)X
2386(connection)X
2758(timeout)X
3022(*/)X
1152 3808(u_short)N
1584(so_error;)X
2304(/*)X
2386(error)X
2563(affecting)X
2869(connection)X
3241(*/)X
1152 3904(u_short)N
1584(so_oobmark;)X
2304(/*)X
2386(chars)X
2576(to)X
2658(oob)X
2798(mark)X
2983(*/)X
1152 4000(short)N
1584(so_pgrp;)X
2304(/*)X
2386(pgrp)X
2553(for)X
2667(signals)X
2909(*/)X
864 4096(};)N
776 4268(Each)N
964(socket)X
1196(contains)X
1490(two)X
1637(data)X
1798(queues,)X
2 f
2068(so_rcv)X
1 f
2310(and)X
2 f
2454(so_snd)X
1 f
2676(,)X
2724(and)X
2868(a)X
2932(pointer)X
3187(to)X
3277(routines)X
3563(which)X
3787(provide)X
576 4364(supporting)N
940(services.)X
1241(The)X
1388(type)X
1548(of)X
1637(the)X
1757(socket,)X
2 f
2004(so_type)X
1 f
2271(is)X
2346(de\256ned)X
2604(at)X
2684(socket)X
2911(creation)X
3192(time)X
3356(and)X
3494(used)X
3663(in)X
3747(selecting)X
576 4460(those)N
772(services)X
1058(which)X
1281(are)X
1407(appropriate)X
1800(to)X
1889(support)X
2156(it.)X
2268(The)X
2421(supporting)X
2791(protocol)X
3086(is)X
3167(selected)X
3454(at)X
3540(socket)X
3773(creation)X
576 4556(time)N
741(and)X
880(recorded)X
1185(in)X
1270(the)X
1391(socket)X
1619(data)X
1776(structure)X
2079(for)X
2195(later)X
2360(use.)X
2529(Protocols)X
2853(are)X
2974(de\256ned)X
3232(by)X
3334(a)X
3392(table)X
3570(of)X
3659(procedures,)X
576 4652(the)N
2 f
701(protosw)X
1 f
985(structure,)X
1313(which)X
1536(will)X
1687(be)X
1790(described)X
2125(in)X
2214(detail)X
2419(later.)X
2629(A)X
2714(pointer)X
2968(to)X
3057(a)X
3120(protocol-speci\256c)X
3687(data)X
3849(struc-)X
576 4748(ture,)N
743(the)X
863(``protocol)X
1206(control)X
1455(block,'')X
1729(is)X
1804(also)X
1955(present)X
2209(in)X
2293(the)X
2413(socket)X
2640(structure.)X
2983(Protocols)X
3307(control)X
3556(this)X
3693(data)X
3849(struc-)X
576 4844(ture,)N
753(which)X
981(normally)X
1302(includes)X
1601(a)X
1669(back)X
1853(pointer)X
2112(to)X
2206(the)X
2336(parent)X
2569(socket)X
2807(structure)X
3121(to)X
3216(allow)X
3427(easy)X
3603(lookup)X
3858(when)X
576 4940(returning)N
901(information)X
1310(to)X
1403(a)X
1470(user)X
1635(\(for)X
1787(example,)X
2109(placing)X
2375(an)X
2481(error)X
2668(number)X
2943(in)X
3035(the)X
2 f
3163(so_error)X
1 f
3473(\256eld\).)X
3712(The)X
3867(other)X
576 5036(entries)N
821(in)X
914(the)X
1043(socket)X
1279(structure)X
1591(are)X
1721(used)X
1899(in)X
1992(queuing)X
2281(connection)X
2664(requests,)X
2978(validating)X
3329(user)X
3495(requests,)X
3810(storing)X
576 5132(socket)N
812(characteristics)X
1303(\(e.g.)X
1497(options)X
1762(supplied)X
2063(at)X
2151(the)X
2279(time)X
2451(a)X
2517(socket)X
2752(is)X
2835(created\),)X
3145(and)X
3291(maintaining)X
3703(a)X
3769(socket's)X
576 5228(state.)N
776 5352(Processes)N
1121(``rendezvous)X
1574(at)X
1665(a)X
1734(socket'')X
2027(in)X
2123(many)X
2335(instances.)X
2703(For)X
2848(instance,)X
3165(when)X
3373(a)X
3443(process)X
3718(wishes)X
3970(to)X
576 5448(extract)N
817(data)X
973(from)X
1151(a)X
1209(socket's)X
1494(receive)X
1749(queue)X
1963(and)X
2101(it)X
2166(is)X
2240(empty,)X
2481(or)X
2569(lacks)X
2755(suf\256cient)X
3074(data)X
3229(to)X
3312(satisfy)X
3542(the)X
3661(request,)X
3934(the)X
576 5544(process)N
842(blocks,)X
1096(supplying)X
1436(the)X
1560(address)X
1827(of)X
1920(the)X
2044(receive)X
2303(queue)X
2521(as)X
2614(a)X
2676(``wait)X
2894(channel')X
3197(to)X
3285(be)X
3387(used)X
3560(in)X
3648(noti\256cation.)X
576 5640(When)N
793(data)X
952(arrives)X
1196(for)X
1315(the)X
1437(process)X
1702(and)X
1842(is)X
1919(placed)X
2153(in)X
2239(the)X
2361(socket's)X
2648(queue,)X
2884(the)X
3006(blocked)X
3284(process)X
3549(is)X
3626(identi\256ed)X
3952(by)X
576 5736(the)N
694(fact)X
835(it)X
899(is)X
972(waiting)X
1232(``on)X
1386(the)X
1504(queue.'')X

7 p
%%Page: 7 7
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3677(SMM:18-7)X
3 f
576 672(6.1.1.)N
796(Socket)X
1043(state)X
1 f
776 796(A)N
854(socket's)X
1137(state)X
1304(is)X
1377(de\256ned)X
1633(from)X
1809(the)X
1927(following:)X
864 940(#de\256ne)N
1120(SS_NOFDREF)X
2049(0x001)X
2349(/*)X
2431(no)X
2531(\256le)X
2653(table)X
2829(ref)X
2939(any)X
3075(more)X
3260(*/)X
864 1036(#de\256ne)N
1120(SS_ISCONNECTED)X
2049(0x002)X
2349(/*)X
2431(socket)X
2656(connected)X
3002(to)X
3084(a)X
3140(peer)X
3299(*/)X
864 1132(#de\256ne)N
1120(SS_ISCONNECTING)X
2049(0x004)X
2349(/*)X
2431(in)X
2513(process)X
2774(of)X
2861(connecting)X
3233(to)X
3315(peer)X
3474(*/)X
864 1228(#de\256ne)N
1120(SS_ISDISCONNECTING)X
2049(0x008)X
2349(/*)X
2431(in)X
2513(process)X
2774(of)X
2861(disconnecting)X
3326(*/)X
864 1324(#de\256ne)N
1120(SS_CANTSENDMORE)X
2049(0x010)X
2349(/*)X
2431(can't)X
2612(send)X
2779(more)X
2964(data)X
3118(to)X
3200(peer)X
3359(*/)X
864 1420(#de\256ne)N
1120(SS_CANTRCVMORE)X
2049(0x020)X
2349(/*)X
2431(can't)X
2612(receive)X
2865(more)X
3050(data)X
3204(from)X
3380(peer)X
3539(*/)X
864 1516(#de\256ne)N
1120(SS_RCVATMARK)X
2049(0x040)X
2349(/*)X
2431(at)X
2509(mark)X
2694(on)X
2794(input)X
2978(*/)X
864 1708(#de\256ne)N
1120(SS_PRIV)X
2049(0x080)X
2349(/*)X
2431(privileged)X
2776(*/)X
864 1804(#de\256ne)N
1120(SS_NBIO)X
2049(0x100)X
2349(/*)X
2431(non-blocking)X
2878(ops)X
3009(*/)X
864 1900(#de\256ne)N
1120(SS_ASYNC)X
2049(0x200)X
2349(/*)X
2431(async)X
2634(i/o)X
2738(notify)X
2949(*/)X
776 2072(The)N
922(state)X
1090(of)X
1178(a)X
1235(socket)X
1461(is)X
1535(manipulated)X
1952(both)X
2115(by)X
2216(the)X
2335(protocols)X
2654(and)X
2791(the)X
2910(user)X
3065(\(through)X
3362(system)X
3605(calls\).)X
3840(When)X
576 2168(a)N
639(socket)X
871(is)X
951(created,)X
1231(the)X
1356(state)X
1530(is)X
1610(de\256ned)X
1873(based)X
2083(on)X
2189(the)X
2313(type)X
2477(of)X
2570(socket.)X
2841(It)X
2916(may)X
3080(change)X
3334(as)X
3427(control)X
3680(actions)X
3933(are)X
576 2264(performed,)N
951(for)X
1065(example)X
1357(connection)X
1729(establishment.)X
2229(It)X
2298(may)X
2456(also)X
2606(change)X
2855(according)X
3193(to)X
3276(the)X
3395(type)X
3554(of)X
3642(input/output)X
576 2360(the)N
696(user)X
852(wishes)X
1092(to)X
1176(perform,)X
1477(as)X
1566(indicated)X
1882(by)X
1984(options)X
2241(set)X
2352(with)X
2 f
2516(fcntl)X
1 f
2658(.)X
2720(``Non-blocking'')X
3295(I/O)X
3444(implies)X
3700(that)X
3841(a)X
3898(pro-)X
576 2456(cess)N
733(should)X
969(never)X
1171(be)X
1270(blocked)X
1547(to)X
1632(await)X
1829(resources.)X
2196(Instead,)X
2471(any)X
2611(call)X
2751(which)X
2971(would)X
3195(block)X
3397(returns)X
3644(prematurely)X
576 2552(with)N
743(the)X
866(error)X
1048(EWOULDBLOCK,)X
1712(or)X
1804(the)X
1927(service)X
2180(request)X
2437(may)X
2600(be)X
2701(partially)X
2993(ful\256lled,)X
3291(e.g.)X
3432(a)X
3493(request)X
3749(for)X
3867(more)X
576 2648(data)N
730(than)X
888(is)X
961(present.)X
776 2772(If)N
853(a)X
912(process)X
1176(requested)X
1507(``asynchronous'')X
2079(noti\256cation)X
2466(of)X
2556(events)X
2784(related)X
3026(to)X
3111(the)X
3232(socket,)X
3481(the)X
3603(SIGIO)X
3841(signal)X
576 2868(is)N
656(posted)X
892(to)X
981(the)X
1105(process)X
1372(when)X
1572(such)X
1745(events)X
1976(occur.)X
2221(An)X
2345(event)X
2545(is)X
2624(a)X
2686(change)X
2940(in)X
3028(the)X
3152(socket's)X
3441(state;)X
3636(examples)X
3965(of)X
576 2964(such)N
744 0.3125(occurrences)AX
1150(are:)X
1292(space)X
1492(becoming)X
1829(available)X
2140(in)X
2223(the)X
2342(send)X
2510(queue,)X
2743(new)X
2898(data)X
3053(available)X
3364(in)X
3447(the)X
3566(receive)X
3820(queue,)X
576 3060(connection)N
948(establishment)X
1408(or)X
1495(disestablishment,)X
2068(etc.)X
776 3184(A)N
859(socket)X
1089(may)X
1252(be)X
1353(marked)X
1619(``privileged'')X
2077(if)X
2151(it)X
2220(was)X
2370(created)X
2628(by)X
2734(the)X
2858(super-user.)X
3259(Only)X
3445(privileged)X
3796(sockets)X
576 3280(may)N
737(bind)X
902(addresses)X
1233(in)X
1318(privileged)X
1666(portions)X
1950(of)X
2039(an)X
2137(address)X
2400(space)X
2601(or)X
2690(use)X
2819(``raw'')X
3070(sockets)X
3328(to)X
3412(access)X
3640(lower)X
3845(levels)X
576 3376(of)N
663(the)X
781(network.)X
3 f
576 3568(6.1.2.)N
796(Socket)X
1043(data)X
1214(queues)X
1 f
776 3692(A)N
859(socket's)X
1147(data)X
1306(queue)X
1523(contains)X
1815(a)X
1876(pointer)X
2128(to)X
2216(the)X
2340(data)X
2500(stored)X
2722(in)X
2810(the)X
2934(queue)X
3152(and)X
3294(other)X
3485(entries)X
3725(related)X
3970(to)X
576 3788(the)N
694(management)X
1124(of)X
1211(the)X
1329(data.)X
1523(The)X
1668(following)X
1999(structure)X
2300(de\256nes)X
2547(a)X
2603(data)X
2757(queue:)X
864 3932(struct)N
1062(sockbuf)X
1336({)X
1152 4028(u_short)N
1584(sb_cc;)X
2304(/*)X
2386(actual)X
2598(chars)X
2788(in)X
2870(buffer)X
3087(*/)X
1152 4124(u_short)N
1584(sb_hiwat;)X
2304(/*)X
2386(max)X
2544(actual)X
2756(char)X
2915(count)X
3113(*/)X
1152 4220(u_short)N
1584(sb_mbcnt;)X
2304(/*)X
2386(chars)X
2576(of)X
2663(mbufs)X
2883(used)X
3050(*/)X
1152 4316(u_short)N
1584(sb_mbmax;)X
2304(/*)X
2386(max)X
2544(chars)X
2734(of)X
2821(mbufs)X
3041(to)X
3123(use)X
3250(*/)X
1152 4412(u_short)N
1584(sb_lowat;)X
2304(/*)X
2386(low)X
2526(water)X
2725(mark)X
2910(*/)X
1152 4508(short)N
1584(sb_timeo;)X
2304(/*)X
2386(timeout)X
2650(*/)X
1152 4604(struct)N
1584(mbuf)X
1773(*sb_mb;)X
2304(/*)X
2386(the)X
2504(mbuf)X
2693(chain)X
2887(*/)X
1152 4700(struct)N
1584(proc)X
1747(*sb_sel;)X
2304(/*)X
2386(process)X
2647(selecting)X
2952(read/write)X
3298(*/)X
1152 4796(short)N
1584(sb_\257ags;)X
2304(/*)X
2386(\257ags,)X
2577(see)X
2700(below)X
2916(*/)X
864 4892(};)N
776 5064(Data)N
948(is)X
1021(stored)X
1237(in)X
1319(a)X
1375(queue)X
1587(as)X
1674(a)X
1730(chain)X
1924(of)X
2011(mbufs.)X
2271(The)X
2416(actual)X
2628(count)X
2827(of)X
2915(data)X
3070(characters)X
3418(as)X
3506(well)X
3665(as)X
3753(high)X
3916(and)X
576 5160(low)N
726(water)X
935(marks)X
1161(are)X
1290(used)X
1467(by)X
1577(the)X
1705(protocols)X
2033(in)X
2125(controlling)X
2506(the)X
2634(\257ow)X
2806(of)X
2903(data.)X
3107(The)X
3262(amount)X
3531(of)X
3627(buffer)X
3853(space)X
576 5256 0.3250(\(characters)AN
955(of)X
1047(mbufs)X
1272(and)X
1413(associated)X
1768(data)X
1927(pages\))X
2162(is)X
2240(also)X
2394(recorded)X
2701(along)X
2904(with)X
3071(the)X
3194(limit)X
3369(on)X
3474(buffer)X
3696(allocation.)X
576 5352(The)N
737(socket)X
978(routines)X
1271(cooperate)X
1619(in)X
1716(implementing)X
2195(the)X
2328(\257ow)X
2505(control)X
2767(policy)X
3002(by)X
3117(blocking)X
3432(a)X
3503(process)X
3779(when)X
3988(it)X
576 5448(requests)N
859(to)X
941(send)X
1108(data)X
1262(and)X
1398(the)X
1516(high)X
1678(water)X
1877(mark)X
2062(has)X
2189(been)X
2361(reached,)X
2652(or)X
2739(when)X
2934(it)X
2999(requests)X
3283(to)X
3366(receive)X
3620(data)X
3775(and)X
3912(less)X
576 5544(than)N
734(the)X
852(low)X
992(water)X
1191(mark)X
1376(is)X
1449(present)X
1701(\(assuming)X
2050(non-blocking)X
2497(I/O)X
2624(has)X
2751(not)X
2873(been)X
3045(speci\256ed\).*)X
8 s
10 f
576 5624(hhhhhhhhhhhhhhhhhh)N
1 f
576 5704(*)N
624(The)X
739(low-water)X
1013(mark)X
1160(is)X
1219(always)X
1412(presumed)X
1676(to)X
1742(be)X
1818(0)X
1866(in)X
1932(the)X
2026(current)X
2222(implementation.)X

8 p
%%Page: 8 8
8 s 8 xH 0 xS 1 f 1 i
10 s
576 384(SMM:18-8)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
776 672(When)N
991(a)X
1050(socket)X
1278(is)X
1354(created,)X
1630(the)X
1751(supporting)X
2116(protocol)X
2406 0.3182(``reserves'')AX
2801(space)X
3003(for)X
3120(the)X
3241(send)X
3412(and)X
3552(receive)X
3809(queues)X
576 768(of)N
672(the)X
799(socket.)X
1073(The)X
1227(limit)X
1406(on)X
1515(buffer)X
1741(allocation)X
2086(is)X
2168(set)X
2286(somewhat)X
2640(higher)X
2874(than)X
3041(the)X
3167(limit)X
3345(on)X
3453(data)X
3615(characters)X
3970(to)X
576 864(account)N
856(for)X
980(the)X
1108(granularity)X
1490(of)X
1587(buffer)X
1814(allocation.)X
2200(The)X
2355(actual)X
2577(storage)X
2839(associated)X
3199(with)X
3371(a)X
3437(socket)X
3672(queue)X
3894(may)X
576 960(\257uctuate)N
879(during)X
1115(a)X
1178(socket's)X
1468(lifetime,)X
1763(but)X
1891(it)X
1961(is)X
2040(assumed)X
2342(that)X
2488(this)X
2629(reservation)X
3012(will)X
3162(always)X
3411(allow)X
3615(a)X
3677(protocol)X
3970(to)X
576 1056(acquire)N
833(enough)X
1089(memory)X
1376(to)X
1458(satisfy)X
1687(the)X
1805(high)X
1967(water)X
2166(marks.)X
776 1180(The)N
927(timeout)X
1197(and)X
1339(select)X
1548(values)X
1779(are)X
1904(manipulated)X
2326(by)X
2433(the)X
2558(socket)X
2790(routines)X
3075(in)X
3164(implementing)X
3635(various)X
3898(por-)X
576 1276(tions)N
751(of)X
838(the)X
956(interprocess)X
1364(communications)X
1913(facilities)X
2209(and)X
2345(will)X
2489(not)X
2611(be)X
2707(described)X
3035(here.)X
776 1400(Data)N
953(queued)X
1210(at)X
1293(a)X
1354(socket)X
1584(is)X
1662(stored)X
1884(in)X
1972(one)X
2114(of)X
2207(two)X
2353(styles.)X
2601(Stream-oriented)X
3144(sockets)X
3406(queue)X
3624(data)X
3784(with)X
3952(no)X
576 1496(addresses,)N
931(headers)X
1204(or)X
1298(record)X
1531(boundaries.)X
1950(The)X
2101(data)X
2261(are)X
2386(in)X
2474(mbufs)X
2700(linked)X
2926(through)X
3201(the)X
2 f
3325(m_next)X
1 f
3583(\256eld.)X
3791(Buffers)X
576 1592(containing)N
944(access)X
1180(rights)X
1392(may)X
1560(be)X
1666(present)X
1928(within)X
2163(the)X
2292(chain)X
2497(if)X
2577(the)X
2706(underlying)X
3084(protocol)X
3382(supports)X
3684(passage)X
3965(of)X
576 1688(access)N
803(rights.)X
1046(Record-oriented)X
1589(sockets,)X
1866(including)X
2189(datagram)X
2509(sockets,)X
2786(queue)X
2999(data)X
3154(as)X
3241(a)X
3297(list)X
3414(of)X
3501(packets;)X
3784(the)X
3902(sec-)X
576 1784(tions)N
752(of)X
840(packets)X
1102(are)X
1222(distinguished)X
1669(by)X
1770(the)X
1889(types)X
2080(of)X
2169(the)X
2289(mbufs)X
2511(containing)X
2871(them.)X
3093(The)X
3240(mbufs)X
3462(which)X
3680(comprise)X
3996(a)X
576 1880(record)N
806(are)X
929(linked)X
1152(through)X
1424(the)X
2 f
1545(m_next)X
1 f
1800(\256eld;)X
1987(records)X
2247(are)X
2369(linked)X
2592(from)X
2771(the)X
2 f
2892(m_act)X
1 f
3111(\256eld)X
3276(of)X
3366(the)X
3487(\256rst)X
3634(mbuf)X
3826(of)X
3916(one)X
576 1976(packet)N
806(to)X
888(the)X
1006(\256rst)X
1150(mbuf)X
1340(of)X
1428(the)X
1547(next.)X
1746(Each)X
1928(packet)X
2159(begins)X
2389(with)X
2552(an)X
2649(mbuf)X
2839(containing)X
3198(the)X
3317(``from'')X
3602(address)X
3864(if)X
3934(the)X
576 2072(protocol)N
866(provides)X
1165(it,)X
1252(then)X
1412(any)X
1550(buffers)X
1800(containing)X
2160(access)X
2388(rights,)X
2612(and)X
2750(\256nally)X
2976(any)X
3114(buffers)X
3364(containing)X
3724(data.)X
3920(If)X
3996(a)X
576 2168(record)N
802(contains)X
1089(no)X
1189(data,)X
1363(no)X
1463(data)X
1617(buffers)X
1865(are)X
1984(required)X
2272(unless)X
2492(neither)X
2735(address)X
2996(nor)X
3123(access)X
3349(rights)X
3551(are)X
3670(present.)X
776 2292(A)N
866(socket)X
1103(queue)X
1327(has)X
1466(a)X
1534(number)X
1811(of)X
1910(\257ags)X
2093(used)X
2272(in)X
2366(synchronizing)X
2853(access)X
3092(to)X
3187(the)X
3318(data)X
3485(and)X
3634(in)X
3729(acquiring)X
576 2388(resources:)N
864 2532(#de\256ne)N
1209(SB_LOCK)X
2073(0x01)X
2361(/*)X
2443(lock)X
2601(on)X
2701(data)X
2855(queue)X
3067(\(so_rcv)X
3328(only\))X
3517(*/)X
864 2628(#de\256ne)N
1209(SB_WANT)X
2073(0x02)X
2361(/*)X
2443(someone)X
2748(is)X
2821(waiting)X
3081(to)X
3163(lock)X
3321(*/)X
864 2724(#de\256ne)N
1209(SB_WAIT)X
2073(0x04)X
2361(/*)X
2443(someone)X
2748(is)X
2821(waiting)X
3081(for)X
3195(data/space)X
3550(*/)X
864 2820(#de\256ne)N
1209(SB_SEL)X
2073(0x08)X
2361(/*)X
2443(buffer)X
2660(is)X
2733(selected)X
3012(*/)X
864 2916(#de\256ne)N
1209(SB_COLL)X
2073(0x10)X
2361(/*)X
2443(collision)X
2738(selecting)X
3043(*/)X
576 3060(The)N
721(last)X
852(two)X
992(\257ags)X
1163(are)X
1282(manipulated)X
1698(by)X
1798(the)X
1916(system)X
2158(in)X
2240(implementing)X
2704(the)X
2822(select)X
3025(mechanism.)X
3 f
576 3252(6.1.3.)N
796(Socket)X
1043(connection)X
1432(queuing)X
1 f
776 3376(In)N
864(dealing)X
1121(with)X
1284(connection)X
1657(oriented)X
1941(sockets)X
2199(\(e.g.)X
2364(SOCK_STREAM\))X
2990(the)X
3110(two)X
3252(ends)X
3421(are)X
3542(considered)X
3912(dis-)X
576 3472(tinct.)N
787(One)X
950(end)X
1095(is)X
1177(termed)X
2 f
1429(active)X
1 f
1621(,)X
1670(and)X
1815(generates)X
2148(connection)X
2529(requests.)X
2861(The)X
3014(other)X
3207(end)X
3351(is)X
3432(called)X
2 f
3652(passive)X
1 f
3916(and)X
576 3568(accepts)N
833(connection)X
1205(requests.)X
776 3692(From)N
982(the)X
1113(passive)X
1382(side,)X
1564(a)X
1633(socket)X
1871(is)X
1957(marked)X
2231(with)X
2407(SO_ACCEPTCONN)X
3116(when)X
3324(a)X
2 f
3394(listen)X
1 f
3601(call)X
3751(is)X
3838(made,)X
576 3788(creating)N
860(two)X
1005(queues)X
1253(of)X
1345(sockets:)X
2 f
1628(so_q0)X
1 f
1844(for)X
1963(connections)X
2371(in)X
2458(progress)X
2755(and)X
2 f
2896(so_q)X
1 f
3072(for)X
3190(connections)X
3597(already)X
3858(made)X
576 3884(and)N
717(awaiting)X
1018(user)X
1177 0.3250(acceptance.)AX
1596(As)X
1711(a)X
1773(protocol)X
2066(is)X
2145(preparing)X
2479(incoming)X
2807(connections,)X
3236(it)X
3306(creates)X
3556(a)X
3618(socket)X
3849(struc-)X
576 3980(ture)N
727(queued)X
985(on)X
2 f
1091(so_q0)X
1 f
1308(by)X
1414(calling)X
1658(the)X
1781(routine)X
2 f
2033(sonewconn)X
1 f
2389(\(\).)X
2508(When)X
2725(the)X
2848(connection)X
3225(is)X
3303(established,)X
3704(the)X
3827(socket)X
576 4076(structure)N
877(is)X
950(then)X
1108(transferred)X
1477(to)X
2 f
1559(so_q)X
1 f
1710(,)X
1750(making)X
2010(it)X
2074(available)X
2384(for)X
2498(an)X
2 f
2594(accept)X
1 f
2804(.)X
776 4200(If)N
857(an)X
960(SO_ACCEPTCONN)X
1663(socket)X
1896(is)X
1977(closed)X
2210(with)X
2380(sockets)X
2644(on)X
2752(either)X
2 f
2963(so_q0)X
1 f
3182(or)X
2 f
3277(so_q)X
1 f
3428(,)X
3476(these)X
3669(sockets)X
3933(are)X
576 4296(dropped,)N
879(with)X
1041(noti\256cation)X
1425(to)X
1507(the)X
1625(peers)X
1815(as)X
1902(appropriate.)X
3 f
576 4488(6.2.)N
736(Protocol)X
1046(layer\(s\))X
1 f
776 4612(Each)N
959(socket)X
1186(is)X
1261(created)X
1516(in)X
1600(a)X
1658(communications)X
2209(domain,)X
2491(which)X
2709(usually)X
2962(implies)X
3219(both)X
3384(an)X
3483(addressing)X
3849(struc-)X
576 4708(ture)N
725(\(address)X
1017(family\))X
1276(and)X
1415(a)X
1474(set)X
1586(of)X
1676(protocols)X
1997(which)X
2216(implement)X
2581(various)X
2840(socket)X
3068(types)X
3260(within)X
3487(the)X
3608(domain)X
3871(\(pro-)X
576 4804(tocol)N
756(family\).)X
1052(Each)X
1233(domain)X
1493(is)X
1566(de\256ned)X
1822(by)X
1922(the)X
2040(following)X
2371(structure:)X
864 4948(struct)N
1152(domain)X
1412({)X
1152 5044(int)N
1370(dom_family;)X
2135(/*)X
2217(PF_xxx)X
2485(*/)X
1152 5140(char)N
1370(*dom_name;)X
1152 5236(int)N
1370(\(*dom_init\)\(\);)X
2135(/*)X
2217(initialize)X
2517(domain)X
2777(data)X
2931(structures)X
3263(*/)X
1152 5332(int)N
1370 0.1563(\(*dom_externalize\)\(\);)AX
2135(/*)X
2217(externalize)X
2590(access)X
2816(rights)X
3018(*/)X
1152 5428(int)N
1370(\(*dom_dispose\)\(\);)X
2135(/*)X
2217(dispose)X
2477(of)X
2564(internalized)X
2963(rights)X
3165(*/)X
1152 5524(struct)N
1370(protosw)X
1648(*dom_protosw,)X
2168(*dom_protoswNPROTOSW;)X
1152 5620(struct)N
1370(domain)X
1630(*dom_next;)X
864 5716(};)N

9 p
%%Page: 9 9
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3677(SMM:18-9)X
776 672(At)N
876(boot)X
1038(time,)X
1220(each)X
1388(domain)X
1648(con\256gured)X
2011(into)X
2155(the)X
2274(kernel)X
2496(is)X
2570(added)X
2783(to)X
2866(a)X
2923(linked)X
3144(list)X
3262(of)X
3350(domain.)X
3651(The)X
3797(initiali-)X
576 768(zation)N
795(procedure)X
1140(of)X
1230(each)X
1401(domain)X
1664(is)X
1739(then)X
1899(called.)X
2153(After)X
2345(that)X
2487(time,)X
2671(the)X
2791(domain)X
3053(structure)X
3356(is)X
3431(used)X
3600(to)X
3684(locate)X
3898(pro-)X
576 864(tocols)N
795(within)X
1027(the)X
1153(protocol)X
1448(family.)X
1725(It)X
1802(may)X
1968(also)X
2125(contain)X
2389(procedure)X
2740 0.3889(references)AX
3101(for)X
3224(externalization)X
3730(of)X
3826(access)X
576 960(rights)N
778(at)X
856(the)X
974(receiving)X
1293(socket)X
1518(and)X
1654(the)X
1772(disposal)X
2054(of)X
2141(access)X
2367(rights)X
2569(that)X
2709(are)X
2828(not)X
2950(received.)X
776 1084(Protocols)N
1107(are)X
1236(described)X
1574(by)X
1684(a)X
1750(set)X
1869(of)X
1966(entry)X
2161(points)X
2386(and)X
2532(certain)X
2781(socket-visible)X
3256(characteristics,)X
3766(some)X
3965(of)X
576 1180(which)N
792(are)X
911(used)X
1078(in)X
1160(deciding)X
1456(which)X
1672(socket)X
1897(type\(s\))X
2140(they)X
2298(may)X
2456(support.)X
776 1304(An)N
897(entry)X
1085(in)X
1170(the)X
1291(``protocol)X
1635(switch'')X
1922(table)X
2102(exists)X
2308(for)X
2426(each)X
2598(protocol)X
2889(module)X
3153(con\256gured)X
3520(into)X
3668(the)X
3790(system.)X
576 1400(It)N
645(has)X
772(the)X
890(following)X
1221(form:)X
864 1544(struct)N
1062(protosw)X
1340({)X
1152 1640(short)N
1370(pr_type;)X
2119(/*)X
2201(socket)X
2426(type)X
2584(used)X
2751(for)X
2865(*/)X
1152 1736(struct)N
1370(domain)X
1630(*pr_domain;)X
2119(/*)X
2201(domain)X
2461(protocol)X
2748(a)X
2804(member)X
3087(of)X
3174(*/)X
1152 1832(short)N
1370(pr_protocol;)X
2119(/*)X
2201(protocol)X
2488(number)X
2753(*/)X
1152 1928(short)N
1370(pr_\257ags;)X
2119(/*)X
2201(socket)X
2426(visible)X
2659(attributes)X
2977(*/)X
864 2024(/*)N
946(protocol-protocol)X
1527(hooks)X
1738(*/)X
1152 2120(int)N
1370(\(*pr_input\)\(\);)X
2119(/*)X
2201(input)X
2385(to)X
2467(protocol)X
2754(\(from)X
2957(below\))X
3200(*/)X
1152 2216(int)N
1370(\(*pr_output\)\(\);)X
2119(/*)X
2201(output)X
2425(to)X
2507(protocol)X
2794(\(from)X
2997(above\))X
3236(*/)X
1152 2312(int)N
1370(\(*pr_ctlinput\)\(\);)X
2119(/*)X
2201(control)X
2448(input)X
2632(\(from)X
2835(below\))X
3078(*/)X
1152 2408(int)N
1370(\(*pr_ctloutput\)\(\);)X
2119(/*)X
2201(control)X
2448(output)X
2672(\(from)X
2875(above\))X
3114(*/)X
864 2504(/*)N
946(user-protocol)X
1394(hook)X
1574(*/)X
1152 2600(int)N
1370(\(*pr_usrreq\)\(\);)X
2119(/*)X
2201(user)X
2355(request)X
2607(*/)X
864 2696(/*)N
946(utility)X
1156(hooks)X
1367(*/)X
1152 2792(int)N
1370(\(*pr_init\)\(\);)X
2119(/*)X
2201(initialization)X
2625(routine)X
2872(*/)X
1152 2888(int)N
1370(\(*pr_fasttimo\)\(\);)X
2119(/*)X
2201(fast)X
2337(timeout)X
2601(\(200ms\))X
2888(*/)X
1152 2984(int)N
1370(\(*pr_slowtimo\)\(\);)X
2119(/*)X
2201(slow)X
2372(timeout)X
2636(\(500ms\))X
2923(*/)X
1152 3080(int)N
1370(\(*pr_drain\)\(\);)X
2119(/*)X
2201(\257ush)X
2376(any)X
2512(excess)X
2742(space)X
2941(possible)X
3223(*/)X
864 3176(};)N
776 3348(A)N
855(protocol)X
1144(is)X
1219(called)X
1433(through)X
1704(the)X
2 f
1824(pr_init)X
1 f
2063(entry)X
2250(before)X
2478(any)X
2616(other.)X
2843(Thereafter)X
3201(it)X
3267(is)X
3342(called)X
3556(every)X
3757(200)X
3899(mil-)X
576 3444(liseconds)N
909(through)X
1193(the)X
2 f
1326(pr_fasttimo)X
1 f
1729(entry)X
1929(and)X
2080(every)X
2294(500)X
2449(milliseconds)X
2887(through)X
3170(the)X
2 f
3302(pr_slowtimo)X
1 f
3735(for)X
3863(timer)X
576 3540(based)N
780(actions.)X
1068(The)X
1214(system)X
1457(will)X
1602(call)X
1739(the)X
2 f
1858(pr_drain)X
1 f
2163(entry)X
2349(if)X
2419(it)X
2485(is)X
2560(low)X
2702(on)X
2804(space)X
3005(and)X
3143(this)X
3280(should)X
3515(throw)X
3724(away)X
3916(any)X
576 3636(non-critical)N
966(data.)X
776 3760(Protocols)N
1107(pass)X
1274(data)X
1437(between)X
1734(themselves)X
2119(as)X
2215(chains)X
2449(of)X
2545(mbufs)X
2774(using)X
2976(the)X
2 f
3103(pr_input)X
1 f
3407(and)X
2 f
3553(pr_output)X
1 f
3898(rou-)X
576 3856(tines.)N
2 f
788(Pr_input)X
1 f
1093(passes)X
1319(data)X
1474(up)X
1575(\(towards)X
1877(the)X
1996(user\))X
2178(and)X
2 f
2315(pr_output)X
1 f
2651(passes)X
2876(it)X
2940(down)X
3138(\(towards)X
3439(the)X
3557(network\);)X
3889(con-)X
576 3952(trol)N
713(information)X
1117(passes)X
1348(up)X
1454(and)X
1596(down)X
1801(on)X
2 f
1908(pr_ctlinput)X
1 f
2290(and)X
2 f
2433(pr_ctloutput)X
1 f
2828(.)X
2895(The)X
3047(protocol)X
3341(is)X
3421(responsible)X
3813(for)X
3934(the)X
576 4048(space)N
784(occupied)X
1103(by)X
1212(any)X
1357(of)X
1452(the)X
1578(arguments)X
1940(to)X
2030(these)X
2223(entries)X
2465(and)X
2609(must)X
2792(either)X
3003(pass)X
3169(it)X
3241(onward)X
3510(or)X
3605(dispose)X
3873(of)X
3968(it.)X
576 4144(\(On)N
724(output,)X
971(the)X
1093(lowest)X
1326(level)X
1506(reached)X
1781(must)X
1960(free)X
2110(buffers)X
2362(storing)X
2608(the)X
2730(arguments;)X
3110(on)X
3214(input,)X
3422(the)X
3544(highest)X
3799(level)X
3979(is)X
576 4240(responsible)N
961(for)X
1075(freeing)X
1323(buffers.\))X
776 4364(The)N
2 f
921(pr_usrreq)X
1 f
1261(routine)X
1508(interfaces)X
1841(protocols)X
2159(to)X
2241(the)X
2359(socket)X
2584(code)X
2756(and)X
2892(is)X
2965(described)X
3293(below.)X
776 4488(The)N
2 f
921(pr_\257ags)X
1 f
1203(\256eld)X
1365(is)X
1438(constructed)X
1828(from)X
2004(the)X
2122(following)X
2453(values:)X
864 4632(#de\256ne)N
1120(PR_ATOMIC)X
1949(0x01)X
2269(/*)X
2351(exchange)X
2675(atomic)X
2913(messages)X
3236(only)X
3398(*/)X
864 4728(#de\256ne)N
1120(PR_ADDR)X
1949(0x02)X
2269(/*)X
2351(addresses)X
2679(given)X
2877(with)X
3039(messages)X
3362(*/)X
864 4824(#de\256ne)N
1120(PR_CONNREQUIRED)X
1949(0x04)X
2269(/*)X
2351(connection)X
2723(required)X
3011(by)X
3111(protocol)X
3398(*/)X
864 4920(#de\256ne)N
1120(PR_WANTRCVD)X
1949(0x08)X
2269(/*)X
2351(want)X
2527(PRU_RCVD)X
2964(calls)X
3131(*/)X
864 5016(#de\256ne)N
1120(PR_RIGHTS)X
1949(0x10)X
2269(/*)X
2351(passes)X
2576(capabilities)X
2961(*/)X
576 5160(Protocols)N
905(which)X
1128(are)X
1254(connection-based)X
1843(specify)X
2102(the)X
2227(PR_CONNREQUIRED)X
3023(\257ag)X
3170(so)X
3268(that)X
3415(the)X
3541(socket)X
3774(routines)X
576 5256(will)N
725(never)X
929(attempt)X
1194(to)X
1281(send)X
1453(data)X
1612(before)X
1843(a)X
1904(connection)X
2281(has)X
2413(been)X
2590(established.)X
3011(If)X
3089(the)X
3211(PR_WANTRCVD)X
3835(\257ag)X
3979(is)X
576 5352(set,)N
710(the)X
833(socket)X
1063(routines)X
1346(will)X
1495(notify)X
1711(the)X
1834(protocol)X
2126(when)X
2325(the)X
2448(user)X
2607(has)X
2739(removed)X
3045(data)X
3204(from)X
3386(the)X
3510(socket's)X
3799(receive)X
576 5448(queue.)N
832(This)X
997(allows)X
1229(the)X
1350(protocol)X
1640(to)X
1725(implement)X
2090(acknowledgement)X
2697(on)X
2800(user)X
2957(receipt,)X
3219(and)X
3358(also)X
3510(update)X
3747(window-)X
576 5544(ing)N
705(information)X
1110(based)X
1320(on)X
1427(the)X
1552(amount)X
1819(of)X
1913(space)X
2119(available)X
2436(in)X
2525(the)X
2650(receive)X
2910(queue.)X
3169(The)X
3321(PR_ADDR)X
3712(\256eld)X
3881(indi-)X
576 5640(cates)N
759(that)X
901(any)X
1039(data)X
1195(placed)X
1427(in)X
1511(the)X
1631(socket's)X
1916(receive)X
2171(queue)X
2385(will)X
2531(be)X
2629(preceded)X
2942(by)X
3044(the)X
3164(address)X
3427(of)X
3516(the)X
3636(sender.)X
3907(The)X
576 5736(PR_ATOMIC)N
1049(\257ag)X
1189(speci\256es)X
1485(that)X
1625(each)X
2 f
1794(user)X
1 f
1953(request)X
2206(to)X
2289(send)X
2457(data)X
2612(must)X
2788(be)X
2885(performed)X
3241(in)X
3324(a)X
3381(single)X
2 f
3593(protocol)X
1 f
3885(send)X
576 5832(request;)N
877(it)X
968(is)X
1068(the)X
1213(protocol's)X
1585(responsibility)X
2067(to)X
2176(maintain)X
2503(record)X
2756(boundaries)X
3155(on)X
3282(data)X
3462(to)X
3570(be)X
3692(sent.)X
3907(The)X

10 p
%%Page: 10 10
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-10)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
576 672(PR_RIGHTS)N
1022(\257ag)X
1162(indicates)X
1467(that)X
1607(the)X
1725(protocol)X
2013(supports)X
2305(the)X
2424(passing)X
2685(of)X
2773(capabilities;)X
3201(this)X
3337(is)X
3411(currently)X
3722(used)X
3890(only)X
576 768(by)N
676(the)X
794(protocols)X
1112(in)X
1194(the)X
1312(UNIX)X
1533(protocol)X
1820(family.)X
776 892(When)N
994(a)X
1056(socket)X
1287(is)X
1366(created,)X
1645(the)X
1769(socket)X
2000(routines)X
2284(scan)X
2453(the)X
2577(protocol)X
2870(table)X
3052(for)X
3172(the)X
3297(domain)X
3564(looking)X
3835(for)X
3956(an)X
576 988(appropriate)N
964(protocol)X
1253(to)X
1337(support)X
1599(the)X
1719(type)X
1879(of)X
1968(socket)X
2194(being)X
2393(created.)X
2687(The)X
2 f
2833(pr_type)X
1 f
3099(\256eld)X
3262(contains)X
3550(one)X
3687(of)X
3775(the)X
3894(pos-)X
576 1084(sible)N
751(socket)X
980(types)X
1173(\(e.g.)X
1340(SOCK_STREAM\),)X
1988(while)X
2190(the)X
2 f
2312(pr_domain)X
1 f
2688(is)X
2766(a)X
2827(back)X
3004(pointer)X
3256(to)X
3343(the)X
3466(domain)X
3731(structure.)X
576 1180(The)N
2 f
721(pr_protocol)X
1 f
1123(\256eld)X
1285(contains)X
1572(the)X
1690(protocol)X
1977(number)X
2242(of)X
2329(the)X
2447(protocol,)X
2754(normally)X
3063(a)X
3119(well-known)X
3522(value.)X
3 f
576 1372(6.3.)N
736 0.2344(Network-interface)AX
1386(layer)X
1 f
776 1496(Each)N
963 0.2188(network-interface)AX
1561(con\256gured)X
1930(into)X
2080(a)X
2142(system)X
2390(de\256nes)X
2643(a)X
2705(path)X
2869(through)X
3144(which)X
3367(packets)X
3635(may)X
3800(be)X
3903(sent)X
576 1592(and)N
714(received.)X
1049(Normally)X
1378(a)X
1436(hardware)X
1758(device)X
1990(is)X
2065(associated)X
2417(with)X
2581(this)X
2718(interface,)X
3042(though)X
3286(there)X
3469(is)X
3543(no)X
3644(requirement)X
576 1688(for)N
698(this)X
841(\(for)X
991(example,)X
1312(all)X
1421(systems)X
1703(have)X
1884(a)X
1949(software)X
2255(``loopback'')X
2686(interface)X
2997(used)X
3173(for)X
3296(debugging)X
3663(and)X
3808(perfor-)X
576 1784(mance)N
813(analysis\).)X
1165(In)X
1259(addition)X
1548(to)X
1637(manipulating)X
2086(the)X
2210(hardware)X
2536(device,)X
2792(an)X
2894(interface)X
3202(module)X
3468(is)X
3547(responsible)X
3938(for)X
576 1880(encapsulation)N
1043(and)X
1185(decapsulation)X
1652(of)X
1745(any)X
1887(link-layer)X
2225(header)X
2467(information)X
2872(required)X
3167(to)X
3256(deliver)X
3506(a)X
3569(message)X
3868(to)X
3957(its)X
576 1976(destination.)N
988(The)X
1134(selection)X
1439(of)X
1526(which)X
1742(interface)X
2044(to)X
2126(use)X
2253(in)X
2335(delivering)X
2680(packets)X
2941(is)X
3014(a)X
3070(routing)X
3321(decision)X
3608(carried)X
3852(out)X
3974(at)X
576 2072(a)N
638(higher)X
869(level)X
1051(than)X
1215(the)X
1339 0.2188(network-interface)AX
1937(layer.)X
2164(An)X
2288(interface)X
2596(may)X
2760(have)X
2938(addresses)X
3273(in)X
3362(one)X
3505(or)X
3599(more)X
3791(address)X
576 2168(families.)N
895(The)X
1041(address)X
1303(is)X
1377(set)X
1487(at)X
1566(boot)X
1729(time)X
1892(using)X
2086(an)X
2 f
2183(ioctl)X
1 f
2345(on)X
2445(a)X
2501(socket)X
2726(in)X
2808(the)X
2926(appropriate)X
3312(domain;)X
3594(this)X
3729(operation)X
576 2264(is)N
649(implemented)X
1087(by)X
1187(the)X
1305(protocol)X
1592(family,)X
1841(after)X
2009(verifying)X
2323(the)X
2441(operation)X
2764(through)X
3033(the)X
3151(device)X
2 f
3381(ioctl)X
1 f
3543(entry.)X
776 2388(An)N
894(interface)X
1196(is)X
1269(de\256ned)X
1525(by)X
1625(the)X
1743(following)X
2074(structure,)X
864 2532(struct)N
1062(ifnet)X
1229({)X
1152 2628(char)N
1390(*if_name;)X
2053(/*)X
2135(name,)X
2349(e.g.)X
2485(``en'')X
2689(or)X
2776(``lo'')X
2966(*/)X
1152 2724(short)N
1390(if_unit;)X
2053(/*)X
2135(sub-unit)X
2417(for)X
2531(lower)X
2734(level)X
2910(driver)X
3122(*/)X
1152 2820(short)N
1390(if_mtu;)X
2053(/*)X
2135(maximum)X
2479(transmission)X
2903(unit)X
3047(*/)X
1152 2916(short)N
1390(if_\257ags;)X
2053(/*)X
2135(up/down,)X
2455(broadcast,)X
2803(etc.)X
2937(*/)X
1152 3012(short)N
1390(if_timer;)X
2053(/*)X
2135(time)X
2297('til)X
2410(if_watchdog)X
2831(called)X
3043(*/)X
1152 3108(struct)N
1390(ifaddr)X
1602(*if_addrlist;)X
2053(/*)X
2135(list)X
2252(of)X
2339(addresses)X
2667(of)X
2754(interface)X
3056(*/)X
1152 3204(struct)N
1390(ifqueue)X
1651(if_snd;)X
2053(/*)X
2135(output)X
2359(queue)X
2571(*/)X
1152 3300(int)N
1390(\(*if_init\)\(\);)X
2053(/*)X
2135(init)X
2261(routine)X
2508(*/)X
1152 3396(int)N
1390(\(*if_output\)\(\);)X
2053(/*)X
2135(output)X
2359(routine)X
2606(*/)X
1152 3492(int)N
1390(\(*if_ioctl\)\(\);)X
2053(/*)X
2135(ioctl)X
2297(routine)X
2544(*/)X
1152 3588(int)N
1390(\(*if_reset\)\(\);)X
2053(/*)X
2135(bus)X
2266(reset)X
2438(routine)X
2685(*/)X
1152 3684(int)N
1390(\(*if_watchdog\)\(\);)X
2053(/*)X
2135(timer)X
2324(routine)X
2571(*/)X
1152 3780(int)N
1390(if_ipackets;)X
2053(/*)X
2135(packets)X
2396(received)X
2689(on)X
2789(interface)X
3091(*/)X
1152 3876(int)N
1390(if_ierrors;)X
2053(/*)X
2135(input)X
2319(errors)X
2527(on)X
2627(interface)X
2929(*/)X
1152 3972(int)N
1390(if_opackets;)X
2053(/*)X
2135(packets)X
2396(sent)X
2545(on)X
2645(interface)X
2947(*/)X
1152 4068(int)N
1390(if_oerrors;)X
2053(/*)X
2135(output)X
2359(errors)X
2567(on)X
2667(interface)X
2969(*/)X
1152 4164(int)N
1390(if_collisions;)X
2053(/*)X
2135(collisions)X
2461(on)X
2561(csma)X
2746(interfaces)X
3079(*/)X
1152 4260(struct)N
1390(ifnet)X
1557(*if_next;)X
864 4356(};)N
576 4500(Each)N
757(interface)X
1059(address)X
1320(has)X
1447(the)X
1565(following)X
1896(form:)X
864 4644(struct)N
1062(ifaddr)X
1274({)X
1120 4740(struct)N
1358(sockaddr)X
1668(ifa_addr;)X
2018(/*)X
2100(address)X
2361(of)X
2448(interface)X
2750(*/)X
1120 4836(union)N
1322({)X
1358 4932(struct)N
1596(sockaddr)X
1906(ifu_broadaddr;)X
1358 5028(struct)N
1596(sockaddr)X
1906(ifu_dstaddr;)X
1120 5124(})N
1178(ifa_ifu;)X
1120 5220(struct)N
1358(ifnet)X
1525(*ifa_ifp;)X
2018(/*)X
2100(back-pointer)X
2526(to)X
2608(interface)X
2910(*/)X
1120 5316(struct)N
1358(ifaddr)X
1570(*ifa_next;)X
2018(/*)X
2100(next)X
2258(address)X
2519(for)X
2633(interface)X
2935(*/)X
864 5412(};)N
864 5508(#de\256ne)N
1120(ifa_broadaddr)X
1631(ifa_ifu.ifu_broadaddr)X
2458(/*)X
2540(broadcast)X
2868(address)X
3129(*/)X
864 5604(#de\256ne)N
1120(ifa_dstaddr)X
1631(ifa_ifu.ifu_dstaddr)X
2458(/*)X
2540(other)X
2725(end)X
2861(of)X
2948(p-to-p)X
3164(link)X
3308(*/)X
576 5748(The)N
726(protocol)X
1018(generally)X
1342(maintains)X
1678(this)X
1818(structure)X
2124(as)X
2216(part)X
2366(of)X
2458(a)X
2520(larger)X
2734(structure)X
3041(containing)X
3405(additional)X
3751(informa-)X
576 5844(tion)N
720(concerning)X
1097(the)X
1215(address.)X

11 p
%%Page: 11 11
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3637(SMM:18-11)X
776 672(Each)N
961(interface)X
1267(has)X
1398(a)X
1458(send)X
1629(queue)X
1845(and)X
1985(routines)X
2267(used)X
2438(for)X
2556(initialization,)X
2 f
3004(if_init)X
1 f
3194(,)X
3238(and)X
3378(output,)X
2 f
3626(if_output)X
1 f
3914(.)X
3978(If)X
576 768(the)N
706(interface)X
1020(resides)X
1274(on)X
1385(a)X
1452(system)X
1705(bus,)X
1867(the)X
1996(routine)X
2 f
2254(if_reset)X
1 f
2525(will)X
2680(be)X
2787(called)X
3010(after)X
3189(a)X
3256(bus)X
3398(reset)X
3581(has)X
3719(been)X
3902(per-)X
576 864(formed.)N
859(An)X
988(interface)X
1301(may)X
1470(also)X
1630(specify)X
1893(a)X
1960(timer)X
2160(routine,)X
2 f
2438(if_watchdog)X
1 f
2833(;)X
2886(if)X
2 f
2966(if_timer)X
1 f
3250(is)X
3334(non-zero,)X
3671(it)X
3746(is)X
3830(decre-)X
576 960(mented)N
832(once)X
1004(per)X
1127(second)X
1370(until)X
1536(it)X
1600(reaches)X
1862(zero,)X
2041(at)X
2119(which)X
2335(time)X
2497(the)X
2615(watchdog)X
2947(routine)X
3194(is)X
3267(called.)X
776 1084(The)N
931(state)X
1108(of)X
1205(an)X
1311(interface)X
1623(and)X
1769(certain)X
2018(characteristics)X
2508(are)X
2637(stored)X
2864(in)X
2957(the)X
2 f
3086(if_\257ags)X
1 f
3352(\256eld.)X
3565(The)X
3721(following)X
576 1180(values)N
801(are)X
920(possible:)X
864 1324(#de\256ne)N
1209(IFF_UP)X
2073(0x1)X
2361(/*)X
2443(interface)X
2745(is)X
2818(up)X
2918(*/)X
864 1420(#de\256ne)N
1209(IFF_BROADCAST)X
2073(0x2)X
2361(/*)X
2443(broadcast)X
2771(is)X
2844(possible)X
3126(*/)X
864 1516(#de\256ne)N
1209(IFF_DEBUG)X
2073(0x4)X
2361(/*)X
2443(turn)X
2592(on)X
2692(debugging)X
3050(*/)X
864 1612(#de\256ne)N
1209(IFF_LOOPBACK)X
2073(0x8)X
2361(/*)X
2443(is)X
2516(a)X
2572(loopback)X
2886(net)X
3004(*/)X
864 1708(#de\256ne)N
1209(IFF_POINTOPOINT)X
2073(0x10)X
2361(/*)X
2443(interface)X
2745(is)X
2818(point-to-point)X
3282(link)X
3426(*/)X
864 1804(#de\256ne)N
1209(IFF_NOTRAILERS)X
2073(0x20)X
2361(/*)X
2443(avoid)X
2641(use)X
2768(of)X
2855(trailers)X
3098(*/)X
864 1900(#de\256ne)N
1209(IFF_RUNNING)X
2073(0x40)X
2361(/*)X
2443(resources)X
2767(allocated)X
3077(*/)X
864 1996(#de\256ne)N
1209(IFF_NOARP)X
2073(0x80)X
2361(/*)X
2443(no)X
2543(address)X
2804(resolution)X
3144(protocol)X
3431(*/)X
576 2140(If)N
677(the)X
822(interface)X
1151(is)X
1251(connected)X
1624(to)X
1733(a)X
1816(network)X
2127(which)X
2371(supports)X
2690(transmission)X
3142(of)X
2 f
3257(broadcast)X
1 f
3625(packets,)X
3934(the)X
576 2236(IFF_BROADCAST)N
1237(\257ag)X
1379(will)X
1525(be)X
1623(set)X
1734(and)X
1872(the)X
2 f
1992(ifa_broadaddr)X
1 f
2480(\256eld)X
2644(will)X
2789(contain)X
3046(the)X
3165(address)X
3427(to)X
3510(be)X
3607(used)X
3775(in)X
3858(send-)X
576 2332(ing)N
703(or)X
795(accepting)X
1128(a)X
1189(broadcast)X
1522(packet.)X
1797(If)X
1876(the)X
1999(interface)X
2306(is)X
2384(associated)X
2739(with)X
2906(a)X
2967(point-to-point)X
3436(hardware)X
3761(link)X
3911(\(for)X
576 2428(example,)N
904(a)X
976(DEC)X
1172(DMR-11\),)X
1544(the)X
1678(IFF_POINTOPOINT)X
2399(\257ag)X
2555(will)X
2715(be)X
2826(set)X
2950(and)X
2 f
3101(ifa_dstaddr)X
1 f
3504(will)X
3663(contain)X
3934(the)X
576 2524(address)N
840(of)X
930(the)X
1051(host)X
1207(on)X
1310(the)X
1431(other)X
1619(side)X
1771(of)X
1861(the)X
1982(connection.)X
2397(These)X
2612(addresses)X
2943(and)X
3082(the)X
3203(local)X
3382(address)X
3646(of)X
3736(the)X
3858(inter-)X
576 2620(face,)N
2 f
758(if_addr)X
1 f
993(,)X
1040(are)X
1166(used)X
1340(in)X
1429(\256ltering)X
1709(incoming)X
2038(packets.)X
2346(The)X
2498(interface)X
2807(sets)X
2954(IFF_RUNNING)X
3506(after)X
3681(it)X
3752(has)X
3885(allo-)X
576 2716(cated)N
770(system)X
1016(resources)X
1344(and)X
1484(posted)X
1717(an)X
1817(initial)X
2027(read)X
2191(on)X
2296(the)X
2419(device)X
2654(it)X
2723(manages.)X
3069(This)X
3236(state)X
3408(bit)X
3517(is)X
3595(used)X
3767(to)X
3854(avoid)X
576 2812(multiple)N
873(allocation)X
1220(requests)X
1514(when)X
1719(an)X
1826(interface's)X
2197(address)X
2469(is)X
2553(changed.)X
2892(The)X
3048(IFF_NOTRAILERS)X
3731(\257ag)X
3881(indi-)X
576 2908(cates)N
765(the)X
891(interface)X
1201(should)X
1442(refrain)X
1686(from)X
1871(using)X
2073(a)X
2 f
2138(trailer)X
1 f
2371(encapsulation)X
2841(on)X
2950(outgoing)X
3263(packets,)X
3553(or)X
3649(\(where)X
3902(per-)X
576 3004(host)N
733(negotiation)X
1117(of)X
1207(trailers)X
1453(is)X
1529(possible\))X
1841(that)X
1984(trailer)X
2199(encapsulations)X
2694(should)X
2930(not)X
3055(be)X
3154(requested;)X
2 f
3507(trailer)X
1 f
3734(protocols)X
576 3100(are)N
696(described)X
1025(in)X
1109(section)X
1358(14.)X
1500(The)X
1647(IFF_NOARP)X
2095(\257ag)X
2237(indicates)X
2544(the)X
2664(interface)X
2968(should)X
3203(not)X
3327(use)X
3456(an)X
3554(``address)X
3871(reso-)X
576 3196(lution)N
782(protocol'')X
1123(in)X
1205(mapping)X
1505(internetwork)X
1935(addresses)X
2263(to)X
2345(local)X
2521(network)X
2804(addresses.)X
776 3320(Various)N
1054(statistics)X
1353(are)X
1476(also)X
1629(stored)X
1849(in)X
1935(the)X
2057(interface)X
2363(structure.)X
2708(These)X
2924(may)X
3086(be)X
3186(viewed)X
3442(by)X
3546(users)X
3736(using)X
3934(the)X
2 f
576 3416(netstat)N
1 f
789(\(1\))X
903(program.)X
776 3540(The)N
932(interface)X
1245(address)X
1517(and)X
1664(\257ags)X
1846(may)X
2015(be)X
2122(set)X
2243(with)X
2417(the)X
2547(SIOCSIFADDR)X
3103(and)X
3251(SIOCSIFFLAGS)X
2 f
3833(ioctl)X
1 f
3981(s.)X
576 3636(SIOCSIFADDR)N
1126(is)X
1205(used)X
1378(initially)X
1652(to)X
1740(de\256ne)X
1962(each)X
2136(interface's)X
2502(address;)X
2790(SIOGSIFFLAGS)X
3370(can)X
3507(be)X
3608(used)X
3780(to)X
3867(mark)X
576 3732(an)N
675(interface)X
980(down)X
1181(and)X
1320(perform)X
1602(site-speci\256c)X
2009(con\256guration.)X
2500(The)X
2649(destination)X
3024(address)X
3289(of)X
3380(a)X
3440(point-to-point)X
3908(link)X
576 3828(is)N
650(set)X
760(with)X
923(SIOCSIFDSTADDR.)X
1659(Corresponding)X
2156(operations)X
2511(exist)X
2682(to)X
2764(read)X
2923(each)X
3091(value.)X
3325(Protocol)X
3616(families)X
3894(may)X
576 3924(also)N
744(support)X
1023(operations)X
1396(to)X
1497(set)X
1625(and)X
1780(read)X
1958(the)X
2095(broadcast)X
2442(address.)X
2762(In)X
2868(addition,)X
3189(the)X
3326(SIOCGIFCONF)X
2 f
3890(ioctl)X
1 f
576 4020(retrieves)N
873(a)X
929(list)X
1046(of)X
1133(interface)X
1435(names)X
1660(and)X
1796(addresses)X
2124(for)X
2238(all)X
2338(interfaces)X
2671(and)X
2807(protocols)X
3125(on)X
3225(the)X
3343(host.)X
3 f
576 4212(6.3.1.)N
796(UNIBUS)X
1118(interfaces)X
1 f
776 4336(All)N
909(hardware)X
1240(related)X
1490(interfaces)X
1834(currently)X
2156(reside)X
2380(on)X
2492(the)X
2622(UNIBUS.)X
2992(Consequently)X
3464(a)X
3532(common)X
3844(set)X
3965(of)X
576 4432(utility)N
788(routines)X
1068(for)X
1184(dealing)X
1442(with)X
1606(the)X
1725(UNIBUS)X
2044(has)X
2172(been)X
2345(developed.)X
2736(Each)X
2918(UNIBUS)X
3237(interface)X
3540(utilizes)X
3792(a)X
3849(struc-)X
576 4528(ture)N
721(of)X
808(the)X
926(following)X
1257(form:)X
864 4672(struct)N
1120(ifubinfo)X
1398({)X
1120 4768(short)N
1515(iff_uban;)X
2763(/*)X
2845(uba)X
2981(number)X
3246(*/)X
1120 4864(short)N
1515(iff_hlen;)X
2763(/*)X
2845(local)X
3021(net)X
3139(header)X
3374(length)X
3594(*/)X
1120 4960(struct)N
1515(uba_regs)X
1825(*iff_uba;)X
2763(/*)X
2845(uba)X
2981(regs,)X
3155(in)X
3237(vm)X
3359(*/)X
1120 5056(short)N
1515(iff_\257ags;)X
2763(/*)X
2845(used)X
3012(during)X
3241(uballoc's)X
3555(*/)X
864 5152(};)N
576 5296(Additional)N
939(structures)X
1272(are)X
1392(associated)X
1743(with)X
1906(each)X
2075(receive)X
2329(and)X
2466(transmit)X
2749(buffer,)X
2987(normally)X
3297(one)X
3434(each)X
3603(per)X
3728(interface;)X
576 5392(for)N
690(read,)X

12 p
%%Page: 12 12
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-12)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
864 720(struct)N
1120(ifrw)X
1274({)X
1120 816(caddr_t)N
1515(ifrw_addr;)X
2763(/*)X
2845(virt)X
2976(addr)X
3139(of)X
3226(header)X
3461(*/)X
1120 912(short)N
1515(ifrw_bdp;)X
2763(/*)X
2845(unibus)X
3078(bdp)X
3218(*/)X
1120 1008(short)N
1515(ifrw_\257ags;)X
2763(/*)X
2845(type,)X
3023(etc.)X
3157(*/)X
864 1104(#de\256ne)N
1120(IFRW_W)X
1515(0x01)X
2763(/*)X
2845(is)X
2918(a)X
2974(transmit)X
3256(buffer)X
3473(*/)X
1120 1200(int)N
1515(ifrw_info;)X
2763(/*)X
2845(value)X
3039(from)X
3215(ubaalloc)X
3507(*/)X
1120 1296(int)N
1515(ifrw_proto;)X
2763(/*)X
2845(map)X
3003(register)X
3264(prototype)X
3591(*/)X
1120 1392(struct)N
1515(pte)X
1633(*ifrw_mr;)X
2763(/*)X
2845(base)X
3008(of)X
3095(map)X
3253(registers)X
3545(*/)X
864 1488(};)N
576 1632(and)N
712(for)X
826(write,)X
864 1776(struct)N
1120(ifxmt)X
1313({)X
1120 1872(struct)N
1515(ifrw)X
1669(ifrw;)X
1120 1968(caddr_t)N
1515(ifw_base;)X
2763(/*)X
2845(virt)X
2976(addr)X
3139(of)X
3226(buffer)X
3443(*/)X
1120 2064(struct)N
1515(pte)X
1633(ifw_wmap[IF_MAXNUBAMR];)X
2763(/*)X
2845(base)X
3008(pages)X
3211(for)X
3325(output)X
3549(*/)X
1120 2160(struct)N
1515(mbuf)X
1704(*ifw_xtofree;)X
2763(/*)X
2845(pages)X
3048(being)X
3246(dma'd)X
3471(out)X
3593(*/)X
1120 2256(short)N
1515(ifw_xswapd;)X
2763(/*)X
2845(mask)X
3034(of)X
3121(clusters)X
3386(swapped)X
3687(*/)X
1120 2352(short)N
1515(ifw_nmr;)X
2763(/*)X
2845(number)X
3110(of)X
3197(entries)X
3431(in)X
3513(wmap)X
3729(*/)X
864 2448(};)N
864 2544(#de\256ne)N
1120(ifw_addr)X
1515(ifrw.ifrw_addr)X
864 2640(#de\256ne)N
1120(ifw_bdp)X
1515(ifrw.ifrw_bdp)X
864 2736(#de\256ne)N
1120(ifw_\257ags)X
1515(ifrw.ifrw_\257ags)X
864 2832(#de\256ne)N
1120(ifw_info)X
1515(ifrw.ifrw_info)X
864 2928(#de\256ne)N
1120(ifw_proto)X
1515(ifrw.ifrw_proto)X
864 3024(#de\256ne)N
1120(ifw_mr)X
1515(ifrw.ifrw_mr)X
576 3168(One)N
734(of)X
825(each)X
997(of)X
1088(these)X
1277(structures)X
1613(is)X
1691(conveniently)X
2130(packaged)X
2459(for)X
2578(interfaces)X
2916(with)X
3083(single)X
3299(buffers)X
3552(for)X
3671(each)X
3844(direc-)X
576 3264(tion,)N
740(as)X
827(follows:)X
864 3408(struct)N
1120(ifuba)X
1305({)X
1120 3504(struct)N
1515(ifubinfo)X
1793(ifu_info;)X
1120 3600(struct)N
1515(ifrw)X
1669(ifu_r;)X
1120 3696(struct)N
1515(ifxmt)X
1708(ifu_xmt;)X
864 3792(};)N
864 3888(#de\256ne)N
1120(ifu_uban)X
1515(ifu_info.iff_uban)X
864 3984(#de\256ne)N
1120(ifu_hlen)X
1515(ifu_info.iff_hlen)X
864 4080(#de\256ne)N
1120(ifu_uba)X
1515(ifu_info.iff_uba)X
864 4176(#de\256ne)N
1120(ifu_\257ags)X
1515(ifu_info.iff_\257ags)X
864 4272(#de\256ne)N
1120(ifu_w)X
1515(ifu_xmt.ifrw)X
864 4368(#de\256ne)N
1120(ifu_xtofree)X
1515(ifu_xmt.ifw_xtofree)X
776 4540(The)N
2 f
938(if_ubinfo)X
1 f
1263(structure)X
1582(contains)X
1887(the)X
2023(general)X
2298(information)X
2714(needed)X
2980(to)X
3080 0.3409(characterize)AX
3508(the)X
3644(I/O-mapped)X
576 4636(buffers)N
825(for)X
940(the)X
1059(device.)X
1329(In)X
1416(addition,)X
1718(there)X
1899(is)X
1972(a)X
2028(structure)X
2329(describing)X
2683(each)X
2851(buffer,)X
3088(including)X
3410(UNIBUS)X
3728(resources)X
576 4732(held)N
734(by)X
834(the)X
952(interface.)X
1294(Suf\256cient)X
1626(memory)X
1914(pages)X
2118(and)X
2255(bus)X
2387(map)X
2546(registers)X
2839(are)X
2959(allocated)X
3270(to)X
3353(each)X
3522(buffer)X
3740(upon)X
3921(ini-)X
576 4828(tialization)N
929(according)X
1279(to)X
1374(the)X
1505(maximum)X
1862(packet)X
2105(size)X
2263(and)X
2412(header)X
2659(length.)X
2931(The)X
3088(kernel)X
3321(virtual)X
3562(address)X
3835(of)X
3934(the)X
576 4924(buffer)N
801(is)X
882(held)X
1048(in)X
2 f
1139(ifrw_addr)X
1 f
1458(,)X
1507(and)X
1652(the)X
1779(map)X
1946(registers)X
2247(begin)X
2454(at)X
2 f
2541(ifrw_mr)X
1 f
2798(.)X
2867(UNIBUS)X
3194(map)X
3361(register)X
2 f
3631(ifrw_mr)X
1 f
3894([)X
9 f
3921(-)X
1 f
3965(1])X
576 5020(maps)N
769(the)X
891(local)X
1071(network)X
1358(header)X
1597(ending)X
1839(on)X
1943(a)X
2003(page)X
2179(boundary.)X
2546(UNIBUS)X
2868(data)X
3026(paths)X
3219(are)X
3341(reserved)X
3637(for)X
3754(read)X
3916(and)X
576 5116(for)N
707(write,)X
929(given)X
1144(by)X
2 f
1261(ifrw_bdp)X
1 f
1549(.)X
1626(The)X
1788(prototype)X
2133(of)X
2238(the)X
2374(map)X
2550(registers)X
2860(for)X
2992(read)X
3169(and)X
3323(for)X
3455(write)X
3658(is)X
3749(saved)X
3970(in)X
2 f
576 5212(ifrw_proto)N
1 f
917(.)X
776 5336(When)N
990(write)X
1177(transfers)X
1476(are)X
1597(not)X
1721(at)X
1801(least)X
1970(half-full)X
2255(pages)X
2460(on)X
2563(page)X
2738(boundaries,)X
3133(the)X
3254(data)X
3411(are)X
3533(just)X
3671(copied)X
3908(into)X
576 5432(the)N
697(pages)X
903(mapped)X
1179(on)X
1281(the)X
1401(UNIBUS)X
1721(and)X
1859(the)X
1979(transfer)X
2247(is)X
2322(started.)X
2598(If)X
2674(a)X
2732(write)X
2919(transfer)X
3187(is)X
3262(at)X
3342(least)X
3511(half)X
3658(a)X
3716(page)X
3890(long)X
576 5528(and)N
715(on)X
818(a)X
877(page)X
1052(boundary,)X
1398(UNIBUS)X
1719(page)X
1894(table)X
2073(entries)X
2310(are)X
2432(swapped)X
2737(to)X
2823 0.4531(reference)AX
3148(the)X
3270(pages,)X
3497(and)X
3637(then)X
3799(the)X
3921(ini-)X
576 5624(tial)N
705(pages)X
915(are)X
1041(remapped)X
1385(from)X
2 f
1568(ifw_wmap)X
1 f
1923(when)X
2124(the)X
2249(transfer)X
2522(completes.)X
2913(The)X
3064(mbufs)X
3290(containing)X
3654(the)X
3778(mapped)X
576 5720(pages)N
779(are)X
898(placed)X
1128(on)X
1228(the)X
2 f
1346(ifw_xtofree)X
1 f
1726(queue)X
1938(to)X
2020(be)X
2116(freed)X
2302(after)X
2470(transmission.)X

13 p
%%Page: 13 13
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3637(SMM:18-13)X
776 672(When)N
995(read)X
1161(transfers)X
1465(give)X
1630(at)X
1715(least)X
1889(half)X
2041(a)X
2104(page)X
2283(of)X
2377(data)X
2538(to)X
2627(be)X
2730(input,)X
2941(page)X
3120(frames)X
3367(are)X
3494(allocated)X
3812(from)X
3996(a)X
576 768(network)N
868(page)X
1049(list)X
1175(and)X
1320(traded)X
1550(with)X
1721(the)X
1848(pages)X
2060(already)X
2326(containing)X
2693(the)X
2820(data,)X
3003(mapping)X
3312(the)X
3439(allocated)X
3758(pages)X
3970(to)X
576 864(replace)N
829(the)X
947(input)X
1131(pages)X
1334(for)X
1448(the)X
1566(next)X
1724(UNIBUS)X
2042(data)X
2196(input.)X
776 988(The)N
928(following)X
1266(utility)X
1483(routines)X
1768(are)X
1894(available)X
2211(for)X
2333(use)X
2468(in)X
2558(writing)X
2817(network)X
3108(interface)X
3418(drivers;)X
3691(all)X
3799(use)X
3934(the)X
576 1084(structures)N
908(described)X
1236(above.)X
576 1208(if_ubaminit\(ifubinfo,)N
1274(uban,)X
1470(hlen,)X
1648(nmr,)X
1817(ifr,)X
1933(nr,)X
2040(ifx,)X
2169(nx\);)X
576 1304(if_ubainit\(ifuba,)N
1119(uban,)X
1315(hlen,)X
1493(nmr\);)X
2 f
776 1428(if_ubaminit)N
1 f
1175(allocates)X
1487(resources)X
1823(on)X
1935(UNIBUS)X
2265(adapter)X
2 f
2534(uban)X
1 f
(,)S
2746(storing)X
3000(the)X
3130(information)X
3540(in)X
3634(the)X
2 f
3764(ifubinfo)X
1 f
4012(,)X
2 f
776 1524(ifrw)N
1 f
935(and)X
2 f
1082(ifxmt)X
1 f
1273(structures)X
1615 0.3625(referenced.)AX
2026(The)X
2 f
2181(ifr)X
1 f
2286(and)X
2 f
2432(ifx)X
1 f
2542(parameters)X
2925(are)X
3054(pointers)X
3342(to)X
3434(arrays)X
3661(of)X
2 f
3758(ifrw)X
1 f
3916(and)X
2 f
776 1620(ifxmt)N
1 f
964(structures)X
1304(whose)X
1538(dimensions)X
1931(are)X
2 f
2059(nr)X
1 f
2159(and)X
2 f
2304(nx)X
1 f
2380(,)X
2429(respectively.)X
2 f
2886(if_ubainit)X
1 f
3225(is)X
3307(a)X
3372(simpler,)X
3661(backwards-)X
776 1716(compatible)N
1153(interface)X
1456(used)X
1624(for)X
1739(hardware)X
2060(with)X
2222(single)X
2433(buffers)X
2681(of)X
2768(each)X
2936(type.)X
3134(They)X
3319(are)X
3438(called)X
3650(only)X
3812(at)X
3890(boot)X
776 1812(time)N
948(or)X
1045(after)X
1223(a)X
1289(UNIBUS)X
1617(reset.)X
1820(One)X
1985(data)X
2150(path)X
2319(\(buffered)X
2650(or)X
2748(unbuffered,)X
3152(depending)X
3517(on)X
3628(the)X
2 f
3757(ifu_\257ags)X
1 f
776 1908(\256eld\))N
975(is)X
1058(allocated)X
1378(for)X
1502(each)X
1680(buffer.)X
1947(The)X
2 f
2102(nmr)X
1 f
2261(parameter)X
2613(indicates)X
2928(the)X
3055(number)X
3329(of)X
3425(UNIBUS)X
3752(mapping)X
776 2004(registers)N
1068(required)X
1356(to)X
1438(map)X
1596(a)X
1652(maximal)X
1952(sized)X
2137(packet)X
2367(onto)X
2530(the)X
2649(UNIBUS,)X
2988(while)X
2 f
3187(hlen)X
1 f
3346(speci\256es)X
3643(the)X
3762(size)X
3908(of)X
3996(a)X
776 2100(local)N
958(network)X
1247(header,)X
1508(if)X
1583(any,)X
1745(which)X
1966(should)X
2204(be)X
2305(mapped)X
2584(separately)X
2935(from)X
3116(the)X
3239(data)X
3398(\(see)X
3553(the)X
3676(description)X
776 2196(of)N
868(trailer)X
1085(protocols)X
1408(in)X
1495(chapter)X
1758(14\).)X
1931(Suf\256cient)X
2268(UNIBUS)X
2592(mapping)X
2898(registers)X
3196(and)X
3338(pages)X
3547(of)X
3640(memory)X
3933(are)X
776 2292(allocated)N
1089(to)X
1174(initialize)X
1477(the)X
1598(input)X
1785(data)X
1942(path)X
2103(for)X
2220(an)X
2319(initial)X
2528(read.)X
2730(For)X
2864(the)X
2985(output)X
3211(data)X
3367(path,)X
3547(mapping)X
3849(regis-)X
776 2388(ters)N
918(and)X
1060(pages)X
1270(of)X
1364(memory)X
1658(are)X
1784(also)X
1940(allocated)X
2257(and)X
2400(mapped)X
2681(onto)X
2850(the)X
2975(UNIBUS.)X
3340(The)X
3492(pages)X
3702(associated)X
776 2484(with)N
943(the)X
1066(output)X
1295(data)X
1454(path)X
1617(are)X
1741(held)X
1904(in)X
1991(reserve)X
2249(in)X
2336(the)X
2458(event)X
2656(a)X
2716(write)X
2905(requires)X
3188(copying)X
3470(non-page-aligned)X
776 2580(data)N
935(\(see)X
2 f
1090(if_wubaput)X
1 f
1474(below\).)X
1762(If)X
2 f
1842(if_ubainit)X
1 f
2178(is)X
2257(called)X
2475(with)X
2643(memory)X
2936(pages)X
3145(already)X
3408(allocated,)X
3744(they)X
3908(will)X
776 2676(be)N
875(used)X
1045(instead)X
1295(of)X
1385(allocating)X
1724(new)X
1881(ones)X
2051(\(this)X
2215(normally)X
2526(occurs)X
2758(after)X
2928(a)X
2986(UNIBUS)X
3306(reset\).)X
3547(A)X
3627(1)X
3689(is)X
3764(returned)X
776 2772(when)N
970(allocation)X
1306(and)X
1442(initialization)X
1866(are)X
1985(successful,)X
2355(0)X
2415(otherwise.)X
576 2896(m)N
658(=)X
723(if_ubaget\(ifubinfo,)X
1351(ifr,)X
1467(totlen,)X
1689(off0,)X
1863(ifp\);)X
576 2992(m)N
658(=)X
723(if_rubaget\(ifuba,)X
1285(totlen,)X
1507(off0,)X
1681(ifp\);)X
2 f
776 3116(if_ubaget)N
1 f
1105(and)X
2 f
1249(if_rubaget)X
1 f
1610(pull)X
1762(input)X
1954(data)X
2116(out)X
2246(of)X
2341(an)X
2445(interface)X
2755(receive)X
3016(buffer)X
3241(and)X
3385(into)X
3537(an)X
3641(mbuf)X
3838(chain.)X
776 3212(The)N
925(\256rst)X
1073(interface)X
1379(passes)X
1608(pointers)X
1890(to)X
1976(the)X
2 f
2098(ifubinfo)X
1 f
2370(structure)X
2675(for)X
2793(the)X
2915(interface)X
3221(and)X
3361(the)X
2 f
3483(ifrw)X
1 f
3634(structure)X
3938(for)X
776 3308(the)N
908(receive)X
1175(buffer;)X
1428(the)X
1560(second)X
1818(call)X
1969(may)X
2142(be)X
2253(used)X
2435(for)X
2564(single-buffered)X
3090(devices.)X
2 f
3406(totlen)X
1 f
3623(speci\256es)X
3934(the)X
776 3404(length)N
997(of)X
1085(data)X
1240(to)X
1323(be)X
1420(obtained,)X
1736(not)X
1858(counting)X
2158(the)X
2276(local)X
2452(network)X
2735(header.)X
3010(If)X
2 f
3084(off0)X
1 f
3228(is)X
3301(non-zero,)X
3627(it)X
3691(indicates)X
3996(a)X
776 3500(byte)N
949(offset)X
1167(to)X
1264(a)X
1335(trailing)X
1601(local)X
1792(network)X
2090(header)X
2340(which)X
2571(should)X
2819(be)X
2930(copied)X
3179(into)X
3339(a)X
3411(separate)X
3711(mbuf)X
3916(and)X
776 3596(prepended)N
1137(to)X
1225(the)X
1349(front)X
1531(of)X
1624(the)X
1748(resultant)X
2049(mbuf)X
2243(chain.)X
2482(When)X
2699(the)X
2822(data)X
2981(amount)X
3246(to)X
3333(at)X
3416(least)X
3588(a)X
3649(half)X
3799(a)X
3860(page,)X
776 3692(the)N
899(previously)X
1262(mapped)X
1541(data)X
1700(pages)X
1908(are)X
2032(remapped)X
2374(into)X
2523(the)X
2646(mbufs)X
2871(and)X
3012(swapped)X
3318(with)X
3485(fresh)X
3671(pages,)X
3899(thus)X
776 3788(avoiding)N
1081(any)X
1222(copy.)X
1443(The)X
1593(receiving)X
1917(interface)X
2224(is)X
2302(recorded)X
2609(as)X
2 f
2700(ifp)X
1 f
2784(,)X
2828(a)X
2888(pointer)X
3139(to)X
3225(an)X
2 f
3325(ifnet)X
1 f
3491(structure,)X
3816(for)X
3934(the)X
776 3884(use)N
903(of)X
990(the)X
1108(receiving)X
1427(network)X
1710(protocol.)X
2037(A)X
2115(0)X
2175(return)X
2387(value)X
2581(indicates)X
2886(a)X
2942(failure)X
3172(to)X
3254(allocate)X
3524(resources.)X
576 4008(if_wubaput\(ifubinfo,)N
1266(ifx,)X
1395(m\);)X
576 4104(if_wubaput\(ifuba,)N
1173(m\);)X
2 f
776 4228(if_ubaput)N
1 f
1108(and)X
2 f
1250(if_wubaput)X
1 f
1635(map)X
1799(a)X
1861(chain)X
2061(of)X
2154(mbufs)X
2380(onto)X
2548(a)X
2610(network)X
2899(interface)X
3207(in)X
3295(preparation)X
3687(for)X
3808(output.)X
776 4324(The)N
930(\256rst)X
1083(interface)X
1394(is)X
1476(used)X
1652(by)X
1761(devices)X
2031(with)X
2202(multiple)X
2496(transmit)X
2786(buffers.)X
3082(The)X
3235(chain)X
3437(includes)X
3732(any)X
3876(local)X
776 4420(network)N
1059(header,)X
1314(which)X
1530(is)X
1603(copied)X
1837(so)X
1928(that)X
2068(it)X
2132(resides)X
2375(in)X
2457(the)X
2576(mapped)X
2851(and)X
2988(aligned)X
3245(I/O)X
3373(space.)X
3613(Page-aligned)X
776 4516(data)N
939(that)X
1088(are)X
1216(page-aligned)X
1660(in)X
1751(the)X
1878(output)X
2111(buffer)X
2337(are)X
2465(mapped)X
2748(to)X
2839(the)X
2966(UNIBUS)X
3293(in)X
3384(place)X
3583(of)X
3679(the)X
3805(normal)X
776 4612(buffer)N
1000(page,)X
1199(and)X
1342(the)X
1467(corresponding)X
1953(mbuf)X
2149(is)X
2229(placed)X
2466(on)X
2574(a)X
2638(queue)X
2858(to)X
2948(be)X
3052(freed)X
3246(after)X
3422(transmission.)X
3894(Any)X
776 4708(other)N
976(mbufs)X
1211(which)X
1442(contained)X
1789(non-page-sized)X
2315(data)X
2484(portions)X
2781(are)X
2914(copied)X
3162(to)X
3258(the)X
3390(I/O)X
3531(space)X
3744(and)X
3894(then)X
776 4804(freed.)N
1002(Pages)X
1209(mapped)X
1483(from)X
1659(a)X
1715(previous)X
2011(output)X
2235(operation)X
2558(\(no)X
2685(longer)X
2910(needed\))X
3185(are)X
3304(unmapped.)X

14 p
%%Page: 14 14
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-14)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
3 f
576 672(7.)N
12 s
684(Socket/protocol)X
1349(interface)X
1 f
10 s
776 796(The)N
923(interface)X
1227(between)X
1517(the)X
1637(socket)X
1864(routines)X
2144(and)X
2282(the)X
2402(communication)X
2922(protocols)X
3243(is)X
3319(through)X
3591(the)X
2 f
3712(pr_usrreq)X
1 f
576 892(routine)N
823(de\256ned)X
1079(in)X
1161(the)X
1279(protocol)X
1566(switch)X
1795(table.)X
2011(The)X
2156(following)X
2487(requests)X
2770(to)X
2852(a)X
2908(protocol)X
3195(module)X
3455(are)X
3574(possible:)X
864 1036(#de\256ne)N
1209(PRU_ATTACH)X
2073(0)X
2361(/*)X
2443(attach)X
2655(protocol)X
2942(*/)X
864 1132(#de\256ne)N
1209(PRU_DETACH)X
2073(1)X
2361(/*)X
2443(detach)X
2673(protocol)X
2960(*/)X
864 1228(#de\256ne)N
1209(PRU_BIND)X
2073(2)X
2361(/*)X
2443(bind)X
2605(socket)X
2830(to)X
2912(address)X
3173(*/)X
864 1324(#de\256ne)N
1209(PRU_LISTEN)X
2073(3)X
2361(/*)X
2443(listen)X
2636(for)X
2750(connection)X
3122(*/)X
864 1420(#de\256ne)N
1209(PRU_CONNECT)X
2073(4)X
2361(/*)X
2443(establish)X
2743(connection)X
3115(to)X
3197(peer)X
3356(*/)X
864 1516(#de\256ne)N
1209(PRU_ACCEPT)X
2073(5)X
2361(/*)X
2443(accept)X
2669(connection)X
3041(from)X
3217(peer)X
3376(*/)X
864 1612(#de\256ne)N
1209(PRU_DISCONNECT)X
2073(6)X
2361(/*)X
2443(disconnect)X
2806(from)X
2982(peer)X
3141(*/)X
864 1708(#de\256ne)N
1209(PRU_SHUTDOWN)X
2073(7)X
2361(/*)X
2443(won't)X
2650(send)X
2817(any)X
2953(more)X
3138(data)X
3292(*/)X
864 1804(#de\256ne)N
1209(PRU_RCVD)X
2073(8)X
2361(/*)X
2443(have)X
2615(taken)X
2809(data;)X
2985(more)X
3170(room)X
3359(now)X
3517(*/)X
864 1900(#de\256ne)N
1209(PRU_SEND)X
2073(9)X
2361(/*)X
2443(send)X
2610(this)X
2745(data)X
2899(*/)X
864 1996(#de\256ne)N
1209(PRU_ABORT)X
2073(10)X
2361(/*)X
2443(abort)X
2628(\(fast)X
2791(DISCONNECT,)X
3338(DETATCH\))X
3759(*/)X
864 2092(#de\256ne)N
1209(PRU_CONTROL)X
2073(11)X
2361(/*)X
2443(control)X
2690(operations)X
3044(on)X
3144(protocol)X
3431(*/)X
864 2188(#de\256ne)N
1209(PRU_SENSE)X
2073(12)X
2361(/*)X
2443(return)X
2655(status)X
2857(into)X
3001(m)X
3083(*/)X
864 2284(#de\256ne)N
1209(PRU_RCVOOB)X
2073(13)X
2361(/*)X
2443(retrieve)X
2709(out)X
2831(of)X
2918(band)X
3094(data)X
3248(*/)X
864 2380(#de\256ne)N
1209(PRU_SENDOOB)X
2073(14)X
2361(/*)X
2443(send)X
2610(out)X
2732(of)X
2819(band)X
2995(data)X
3149(*/)X
864 2476(#de\256ne)N
1209(PRU_SOCKADDR)X
2073(15)X
2361(/*)X
2443(fetch)X
2624(socket's)X
2907(address)X
3168(*/)X
864 2572(#de\256ne)N
1209(PRU_PEERADDR)X
2073(16)X
2361(/*)X
2443(fetch)X
2624(peer's)X
2841(address)X
3102(*/)X
864 2668(#de\256ne)N
1209(PRU_CONNECT2)X
2073(17)X
2361(/*)X
2443(connect)X
2713(two)X
2853(sockets)X
3109(*/)X
864 2764(/*)N
946(begin)X
1144(for)X
1258(protocols)X
1576(internal)X
1841(use)X
1968(*/)X
864 2860(#de\256ne)N
1209(PRU_FASTTIMO)X
2073(18)X
2361(/*)X
2443(200ms)X
2676(timeout)X
2940(*/)X
864 2956(#de\256ne)N
1209(PRU_SLOWTIMO)X
2073(19)X
2361(/*)X
2443(500ms)X
2676(timeout)X
2940(*/)X
864 3052(#de\256ne)N
1209(PRU_PROTORCV)X
2073(20)X
2361(/*)X
2443(receive)X
2696(from)X
2872(below)X
3088(*/)X
864 3148(#de\256ne)N
1209(PRU_PROTOSEND)X
2073(21)X
2361(/*)X
2443(send)X
2610(to)X
2692(below)X
2908(*/)X
576 3292(A)N
654(call)X
790(on)X
890(the)X
1008(user)X
1162(request)X
1414(routine)X
1661(is)X
1734(of)X
1821(the)X
1939(form,)X
864 3436(error)N
1041(=)X
1106 0.1400(\(*protosw[].pr_usrreq\)\(so,)AX
1978(req,)X
2121(m,)X
2223(addr,)X
2406(rights\);)X
864 3532(int)N
968(error;)X
1167(struct)X
1365(socket)X
1590(*so;)X
1743(int)X
1847(req;)X
1992(struct)X
2190(mbuf)X
2379(*m,)X
2521(*addr,)X
2744(*rights;)X
576 3676(The)N
731(mbuf)X
930(data)X
1095(chain)X
2 f
1300(m)X
1 f
1389(is)X
1473(supplied)X
1775(for)X
1900(output)X
2135(operations)X
2500(and)X
2647(for)X
2772(certain)X
3022(other)X
3218(operations)X
3583(where)X
3811(it)X
3886(is)X
3970(to)X
576 3772(receive)N
847(a)X
920(result.)X
1175(The)X
1337(address)X
2 f
1615(addr)X
1 f
1803(is)X
1893(supplied)X
2201(for)X
2332(address-oriented)X
2900(requests)X
3200(such)X
3384(as)X
3488(PRU_BIND)X
3916(and)X
576 3868(PRU_CONNECT.)N
1214(The)X
2 f
1364(rights)X
1 f
1575(parameter)X
1922(is)X
2000(an)X
2101(optional)X
2388(pointer)X
2640(to)X
2727(an)X
2828(mbuf)X
3022(chain)X
3222(containing)X
3586(user-speci\256ed)X
576 3964(capabilities)N
971(\(see)X
1130(the)X
2 f
1257(sendmsg)X
1 f
1562(and)X
2 f
1707(recvmsg)X
1 f
2004(system)X
2255(calls\).)X
2498(The)X
2652(protocol)X
2948(is)X
3030(responsible)X
3424(for)X
3547(disposal)X
3838(of)X
3934(the)X
576 4060(data)N
732(mbuf)X
923(chains)X
1150(on)X
1252(output)X
1478(operations.)X
1875(A)X
1956(non-zero)X
2265(return)X
2480(value)X
2677(gives)X
2869(a)X
2928(UNIX)X
3152(error)X
3332(number)X
3600(which)X
3819(should)X
576 4156(be)N
672(passed)X
906(to)X
988(higher)X
1213(level)X
1389(software.)X
1726(The)X
1871(following)X
2202(paragraphs)X
2575(describe)X
2863(each)X
3031(of)X
3118(the)X
3236(requests)X
3519(possible.)X
576 4280(PRU_ATTACH)N
776 4376(When)N
989(a)X
1046(protocol)X
1334(is)X
1408(bound)X
1629(to)X
1712(a)X
1769(socket)X
1995(\(with)X
2185(the)X
2 f
2304(socket)X
1 f
2526(system)X
2769(call\))X
2933(the)X
3052(protocol)X
3340(module)X
3601(is)X
3676(called)X
3890(with)X
776 4472(this)N
915(request.)X
1211(It)X
1284(is)X
1361(the)X
1483(responsibility)X
1942(of)X
2033(the)X
2154(protocol)X
2444(module)X
2707(to)X
2792(allocate)X
3065(any)X
3204(resources)X
3531(necessary.)X
3907(The)X
776 4568(``attach'')N
1108(request)X
1372(will)X
1528(always)X
1783(precede)X
2066(any)X
2214(of)X
2313(the)X
2443(other)X
2640(requests,)X
2955(and)X
3103(should)X
3349(not)X
3484(occur)X
3696(more)X
3894(than)X
776 4664(once.)N
576 4788(PRU_DETACH)N
776 4884(This)N
943(is)X
1021(the)X
1144(antithesis)X
1471(of)X
1563(the)X
1686(attach)X
1903(request,)X
2180(and)X
2321(is)X
2399(used)X
2571(at)X
2654(the)X
2777(time)X
2944(a)X
3006(socket)X
3237(is)X
3316(deleted.)X
3614(The)X
3765(protocol)X
776 4980(module)N
1036(may)X
1194(deallocate)X
1540(any)X
1676(resources)X
2000(assigned)X
2296(to)X
2378(the)X
2496(socket.)X
576 5104(PRU_BIND)N
776 5200(When)N
988(a)X
1044(socket)X
1269(is)X
1343(initially)X
1612(created)X
1866(it)X
1931(has)X
2059(no)X
2160(address)X
2422(bound)X
2643(to)X
2726(it.)X
2831(This)X
2994(request)X
3247(indicates)X
3553(that)X
3694(an)X
3791(address)X
776 5296(should)N
1010(be)X
1107(bound)X
1328(to)X
1411(an)X
1508(existing)X
1782(socket.)X
2048(The)X
2194(protocol)X
2482(module)X
2743(must)X
2919(verify)X
3132(that)X
3272(the)X
3390(requested)X
3718(address)X
3979(is)X
776 5392(valid)N
956(and)X
1092(available)X
1402(for)X
1516(use.)X
576 5516(PRU_LISTEN)N
776 5612(The)N
933(``listen'')X
1246(request)X
1510(indicates)X
1828(the)X
1959(user)X
2126(wishes)X
2377(to)X
2472(listen)X
2678(for)X
2805(incoming)X
3140(connection)X
3525(requests)X
3821(on)X
3934(the)X
776 5708(associated)N
1134(socket.)X
1407(The)X
1560(protocol)X
1855(module)X
2122(should)X
2362(perform)X
2648(any)X
2791(state)X
2965(changes)X
3251(needed)X
3506(to)X
3595(carry)X
3788(out)X
3917(this)X
776 5804(request)N
1028(\(if)X
1124(possible\).)X
1473(A)X
1551(``listen'')X
1852(request)X
2104(always)X
2347(precedes)X
2649(a)X
2705(request)X
2957(to)X
3039(accept)X
3265(a)X
3321(connection.)X

15 p
%%Page: 15 15
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3637(SMM:18-15)X
576 672(PRU_CONNECT)N
776 768(The)N
928(``connect'')X
1313(request)X
1572(indicates)X
1885(the)X
2011(user)X
2173(wants)X
2388(to)X
2478(a)X
2542(establish)X
2850(an)X
2954(association.)X
3378(The)X
2 f
3531(addr)X
1 f
3710(parameter)X
776 864(supplied)N
1071(describes)X
1394(the)X
1516(peer)X
1679(to)X
1765(be)X
1865(connected)X
2214(to.)X
2339(The)X
2487(effect)X
2694(of)X
2784(a)X
2843(connect)X
3116(request)X
3371(may)X
3532(vary)X
3698(depending)X
776 960(on)N
878(the)X
998(protocol.)X
1327(Virtual)X
1577(circuit)X
1805(protocols,)X
2146(such)X
2316(as)X
2406(TCP)X
2575([Postel81b],)X
2987(use)X
3117(this)X
3255(request)X
3510(to)X
3595(initiate)X
3840(estab-)X
776 1056(lishment)N
1087(of)X
1190(a)X
1262(TCP)X
1444(connection.)X
1872(Datagram)X
2225(protocols,)X
2578(such)X
2760(as)X
2862(UDP)X
3057([Postel80],)X
3441(simply)X
3693(record)X
3934(the)X
776 1152(peer's)N
996(address)X
1260(in)X
1345(a)X
1404(private)X
1650(data)X
1807(structure)X
2111(and)X
2250(use)X
2380(it)X
2447(to)X
2532(tag)X
2653(all)X
2756(outgoing)X
3063(packets.)X
3367(There)X
3578(are)X
3700(no)X
3804(restric-)X
776 1248(tions)N
958(on)X
1065(how)X
1230(many)X
1434(times)X
1633(a)X
1695(connect)X
1971(request)X
2229(may)X
2393(be)X
2495(used)X
2668(after)X
2842(an)X
2944(attach.)X
3202(If)X
3282(a)X
3344(protocol)X
3637(supports)X
3934(the)X
776 1344(notion)N
1003(of)X
2 f
1093(multi-casting)X
1 f
1515(,)X
1558(it)X
1625(is)X
1701(possible)X
1986(to)X
2071(use)X
2201(multiple)X
2490(connects)X
2795(to)X
2881(establish)X
3185(a)X
3245(multi-cast)X
3589(group.)X
3840(Alter-)X
776 1440(natively,)N
1085(an)X
1192(association)X
1579(may)X
1748(be)X
1855(broken)X
2109(by)X
2220(a)X
2286(PRU_DISCONNECT)X
3018(request,)X
3300(and)X
3446(a)X
3512(new)X
3676(association)X
776 1536(created)N
1029(with)X
1191(a)X
1247(subsequent)X
1623(connect)X
1893(request;)X
2167(all)X
2267(without)X
2531(destroying)X
2889(and)X
3025(creating)X
3304(a)X
3360(new)X
3514(socket.)X
576 1660(PRU_ACCEPT)N
776 1756(Following)N
1142(a)X
1216(successful)X
1584(PRU_LISTEN)X
2093(request)X
2363(and)X
2518(the)X
2655(arrival)X
2904(of)X
3010(one)X
3165(or)X
3271(more)X
3475(connections,)X
3917(this)X
776 1852(request)N
1035(is)X
1115(made)X
1316(to)X
1405(indicate)X
1686(the)X
1811(user)X
1971(has)X
2104(accepted)X
2412(the)X
2536(\256rst)X
2686(connection)X
3064(on)X
3170(the)X
3294(queue)X
3512(of)X
3605(pending)X
3889(con-)X
776 1948(nections.)N
1105(The)X
1252(protocol)X
1541(module)X
1803(should)X
2038(\256ll)X
2148(in)X
2232(the)X
2352(supplied)X
2645(address)X
2908(buffer)X
3128(with)X
3293(the)X
3414(address)X
3678(of)X
3768(the)X
3889(con-)X
776 2044(nected)N
1006(party.)X
576 2168(PRU_DISCONNECT)N
776 2264(Eliminate)N
1107(an)X
1203(association)X
1579(created)X
1832(with)X
1994(a)X
2050(PRU_CONNECT)X
2643(request.)X
576 2388(PRU_SHUTDOWN)N
776 2484(This)N
942(call)X
1082(is)X
1159(used)X
1330(to)X
1416(indicate)X
1694(no)X
1798(more)X
1987(data)X
2145(will)X
2293(be)X
2393(sent)X
2546(and/or)X
2776(received)X
3074(\(the)X
2 f
3224(addr)X
1 f
3400(parameter)X
3747(indicates)X
776 2580(the)N
901(direction)X
1212(of)X
1305(the)X
1429(shutdown,)X
1786(as)X
1879(encoded)X
2173(in)X
2261(the)X
2 f
2385(soshutdown)X
1 f
2788(system)X
3036(call\).)X
3245(The)X
3396(protocol)X
3689(may,)X
3873(at)X
3957(its)X
776 2676(discretion,)N
1139(deallocate)X
1492(any)X
1635(data)X
1796(structures)X
2135(related)X
2381(to)X
2470(the)X
2595(shutdown)X
2933(and/or)X
3165(notify)X
3383(a)X
3446(connected)X
3799(peer)X
3965(of)X
776 2772(the)N
894(shutdown.)X
576 2896(PRU_RCVD)N
776 2992(This)N
969(request)X
1252(is)X
1356(made)X
1582(only)X
1776(if)X
1877(the)X
2027(protocol)X
2346(entry)X
2563(in)X
2677(the)X
2827(protocol)X
3146(switch)X
3407(table)X
3615(includes)X
3934(the)X
776 3088(PR_WANTRCVD)N
1401(\257ag.)X
1586(When)X
1803(a)X
1864(user)X
2023(removes)X
2320(data)X
2479(from)X
2660(the)X
2783(receive)X
3041(queue)X
3258(this)X
3398(request)X
3655(will)X
3803(be)X
3903(sent)X
776 3184(to)N
865(the)X
991(protocol)X
1286(module.)X
1594(It)X
1671(may)X
1837(be)X
1941(used)X
2116(to)X
2206(trigger)X
2448(acknowledgements,)X
3111(refresh)X
3363(windowing)X
3751(informa-)X
776 3280(tion,)N
940(initiate)X
1182(data)X
1336(transfer,)X
1622(etc.)X
576 3404(PRU_SEND)N
776 3500(Each)N
962(user)X
1121(request)X
1379(to)X
1467(send)X
1640(data)X
1800(is)X
1879(translated)X
2217(into)X
2367(one)X
2509(or)X
2602(more)X
2793(PRU_SEND)X
3223(requests)X
3512(\(a)X
3601(protocol)X
3894(may)X
776 3596(indicate)N
1052(that)X
1194(a)X
1252(single)X
1465(user)X
1620(send)X
1788(request)X
2041(must)X
2217(be)X
2314(translated)X
2647(into)X
2792(a)X
2849(single)X
3061(PRU_SEND)X
3486(request)X
3739(by)X
3840(speci-)X
776 3692(fying)N
965(the)X
1083(PR_ATOMIC)X
1556(\257ag)X
1696(in)X
1778(its)X
1873(protocol)X
2160(description\).)X
2603(The)X
2748(data)X
2902(to)X
2984(be)X
3081(sent)X
3231(is)X
3305(presented)X
3634(to)X
3717(the)X
3836(proto-)X
776 3788(col)N
900(as)X
993(a)X
1054(list)X
1176(of)X
1268(mbufs)X
1493(and)X
1634(an)X
1735(address)X
2001(is,)X
2099(optionally,)X
2468(supplied)X
2764(in)X
2851(the)X
2 f
2974(addr)X
1 f
3150(parameter.)X
3537(The)X
3687(protocol)X
3979(is)X
776 3884(responsible)N
1163(for)X
1279(preserving)X
1640(the)X
1760(data)X
1916(in)X
2001(the)X
2122(socket's)X
2408(send)X
2578(queue)X
2793(if)X
2865(it)X
2932(is)X
3008(not)X
3133(able)X
3290(to)X
3375(send)X
3545(it)X
3612(immediately,)X
776 3980(or)N
863(if)X
932(it)X
996(may)X
1154(need)X
1326(it)X
1390(at)X
1468(some)X
1657(later)X
1820(time)X
1982(\(e.g.)X
2145(for)X
2259(retransmission\).)X
576 4104(PRU_ABORT)N
776 4200(This)N
944(request)X
1202(indicates)X
1513(an)X
1616(abnormal)X
1946(termination)X
2342(of)X
2436(service.)X
2731(The)X
2883(protocol)X
3177(should)X
3417(delete)X
3636(any)X
3779(existing)X
776 4296(association\(s\).)N
576 4420(PRU_CONTROL)N
776 4516(The)N
923(``control'')X
1280(request)X
1534(is)X
1609(generated)X
1944(when)X
2140(a)X
2198(user)X
2354(performs)X
2667(a)X
2726(UNIX)X
2 f
2950(ioctl)X
1 f
3115(system)X
3360(call)X
3499(on)X
3602(a)X
3661(socket)X
3889(\(and)X
776 4612(the)N
901(ioctl)X
1070(is)X
1150(not)X
1278(intercepted)X
1661(by)X
1767(the)X
1891(socket)X
2122(routines\).)X
2473(It)X
2548(allows)X
2783(protocol-speci\256c)X
3348(operations)X
3708(to)X
3796(be)X
3898(pro-)X
776 4708(vided)N
977(outside)X
1231(the)X
1352(scope)X
1558(of)X
1648(the)X
1769(common)X
2072(socket)X
2300(interface.)X
2645(The)X
2 f
2793(addr)X
1 f
2967(parameter)X
3312(contains)X
3602(a)X
3661(pointer)X
3911(to)X
3996(a)X
776 4804(static)N
975(kernel)X
1206(data)X
1370(area)X
1535(where)X
1762(relevant)X
2051(information)X
2459(may)X
2626(be)X
2731(obtained)X
3036(or)X
3132(returned.)X
3469(The)X
2 f
3623(m)X
1 f
3710(parameter)X
776 4900(contains)N
1064(the)X
1183(actual)X
2 f
1396(ioctl)X
1 f
1559(request)X
1812(code)X
1985(\(note)X
2171(the)X
2290(non-standard)X
2730(calling)X
2969(convention\).)X
3413(The)X
2 f
3560(rights)X
1 f
3768(parame-)X
776 4996(ter)N
884(contains)X
1174(a)X
1233(pointer)X
1483(to)X
1568(an)X
2 f
1667(ifnet)X
1 f
1832(structure)X
2136(if)X
2208(the)X
2 f
2329(ioctl)X
1 f
2494(operation)X
2820(pertains)X
3097(to)X
3182(a)X
3241(particular)X
3572(network)X
3858(inter-)X
776 5092(face.)N
576 5216(PRU_SENSE)N
776 5312(The)N
926(``sense'')X
1233(request)X
1490(is)X
1569(generated)X
1908(when)X
2108(the)X
2232(user)X
2392(makes)X
2623(an)X
2 f
2725(fstat)X
1 f
2888(system)X
3136(call)X
3278(on)X
3384(a)X
3446(socket;)X
3699(it)X
3769(requests)X
776 5408(status)N
984(of)X
1077(the)X
1201(associated)X
1557(socket.)X
1808(This)X
1976(currently)X
2292(returns)X
2541(a)X
2603(standard)X
2 f
2900(stat)X
1 f
3040(structure.)X
3386(It)X
3460(typically)X
3765(contains)X
776 5504(only)N
944(the)X
1068(optimal)X
1338(transfer)X
1610(size)X
1761(for)X
1881(the)X
2005(connection)X
2384(\(based)X
2621(on)X
2728(buffer)X
2952(size,)X
3124(windowing)X
3511(information)X
3916(and)X
776 5600(maximum)N
1129(packet)X
1368(size\).)X
1589(The)X
2 f
1743(m)X
1 f
1830(parameter)X
2181(contains)X
2477(a)X
2542(pointer)X
2798(to)X
2889(a)X
2954(static)X
3152(kernel)X
3382(data)X
3545(area)X
3709(where)X
3934(the)X
776 5696(status)N
978(buffer)X
1195(should)X
1428(be)X
1524(placed.)X

16 p
%%Page: 16 16
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-16)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
576 672(PRU_RCVOOB)N
776 768(Any)N
944(``out-of-band'')X
1461(data)X
1625(presently)X
1949(available)X
2269(is)X
2352(to)X
2444(be)X
2550(returned.)X
2888(An)X
3016(mbuf)X
3215(is)X
3298(passed)X
3543(to)X
3636(the)X
3765(protocol)X
776 864(module,)N
1063(and)X
1206(the)X
1331(protocol)X
1625(should)X
1865(either)X
2075(place)X
2272(data)X
2433(in)X
2522(the)X
2647(mbuf)X
2843(or)X
2936(attach)X
3154(new)X
3314(mbufs)X
3540(to)X
3628(the)X
3752(one)X
3894(sup-)X
776 960(plied)N
957(if)X
1027(there)X
1209(is)X
1283(insuf\256cient)X
1664(space)X
1864(in)X
1947(the)X
2066(single)X
2278(mbuf.)X
2508(An)X
2627(error)X
2805(may)X
2964(be)X
3061(returned)X
3351(if)X
3422(out-of-band)X
3823(data)X
3979(is)X
776 1056(not)N
902(\(yet\))X
1078(available)X
1392(or)X
1483(has)X
1614(already)X
1875(been)X
2051(consumed.)X
2440(The)X
2 f
2589(addr)X
1 f
2763(parameter)X
3108(contains)X
3398(any)X
3537(options)X
3795(such)X
3965(as)X
776 1152(MSG_PEEK)N
1209(to)X
1291(examine)X
1583(data)X
1737(without)X
2001(consuming)X
2372(it.)X
576 1276(PRU_SENDOOB)N
776 1372(Like)N
943(PRU_SEND,)X
1387(but)X
1509(for)X
1623(out-of-band)X
2022(data.)X
576 1496(PRU_SOCKADDR)N
776 1592(The)N
921(local)X
1097(address)X
1358(of)X
1445(the)X
1563(socket)X
1788(is)X
1861(returned,)X
2169(if)X
2238(any)X
2374(is)X
2447(currently)X
2758(bound)X
2979(to)X
3062(it.)X
3167(The)X
3313(address)X
3575(\(with)X
3765(protocol)X
776 1688(speci\256c)N
1041(format\))X
1302(is)X
1375(returned)X
1663(in)X
1745(the)X
2 f
1863(addr)X
1 f
2034(parameter.)X
576 1812(PRU_PEERADDR)N
776 1908(The)N
935(address)X
1210(of)X
1311(the)X
1443(peer)X
1617(to)X
1714(which)X
1945(the)X
2078(socket)X
2318(is)X
2406(connected)X
2767(is)X
2855(returned.)X
3198(The)X
3358(socket)X
3598(must)X
3788(be)X
3899(in)X
3996(a)X
776 2004(SS_ISCONNECTED)N
1484(state)X
1655(for)X
1773(this)X
1912(request)X
2168(to)X
2254(be)X
2354(made)X
2552(to)X
2638(the)X
2759(protocol.)X
3089(The)X
3237(address)X
3501(format)X
3738(\(protocol)X
776 2100(speci\256c\))N
1068(is)X
1141(returned)X
1429(in)X
1511(the)X
2 f
1629(addr)X
1 f
1800(parameter.)X
576 2224(PRU_CONNECT2)N
776 2320(The)N
921(protocol)X
1208(module)X
1468(is)X
1541(supplied)X
1832(two)X
1972(sockets)X
2228(and)X
2364(requested)X
2692(to)X
2774(establish)X
3074(a)X
3131(connection)X
3504(between)X
3793(the)X
3912(two)X
776 2416(without)N
1046(binding)X
1316(any)X
1458(addresses,)X
1812(if)X
1886(possible.)X
2213(This)X
2380(call)X
2521(is)X
2599(used)X
2771(in)X
2858(implementing)X
3327(the)X
2 f
3450(socketpair)X
1 f
3784(\(2\))X
3903(sys-)X
776 2512(tem)N
916(call.)X
776 2636(The)N
927(following)X
1264(requests)X
1554(are)X
1680(used)X
1854(internally)X
2188(by)X
2295(the)X
2420(protocol)X
2714(modules)X
3012(and)X
3155(are)X
3281(never)X
3487(generated)X
3827(by)X
3934(the)X
576 2732(socket)N
810(routines.)X
1137(In)X
1233(certain)X
1481(instances,)X
1824(they)X
1991(are)X
2119(handed)X
2380(to)X
2470(the)X
2 f
2596(pr_usrreq)X
1 f
2944(routine)X
3199(solely)X
3418(for)X
3540(convenience)X
3970(in)X
576 2828(tracing)N
819(a)X
875(protocol's)X
1220(operation)X
1543(\(e.g.)X
1706(PRU_SLOWTIMO\).)X
576 2952(PRU_FASTTIMO)N
776 3048(A)N
870(``fast)X
1076(timeout'')X
1410(has)X
1553(occurred.)X
1912(This)X
2091(request)X
2360(is)X
2450(made)X
2661(when)X
2872(a)X
2945(timeout)X
3226(occurs)X
3473(in)X
3572(the)X
3707(protocol's)X
2 f
776 3144(pr_fastimo)N
1 f
1142(routine.)X
1429(The)X
2 f
1574(addr)X
1 f
1745(parameter)X
2087(indicates)X
2392(which)X
2608(timer)X
2797(expired.)X
576 3268(PRU_SLOWTIMO)N
776 3364(A)N
868(``slow)X
1107(timeout'')X
1439(has)X
1580(occurred.)X
1936(This)X
2112(request)X
2378(is)X
2465(made)X
2673(when)X
2882(a)X
2953(timeout)X
3232(occurs)X
3477(in)X
3574(the)X
3707(protocol's)X
2 f
776 3460(pr_slowtimo)N
1 f
1195(routine.)X
1482(The)X
2 f
1627(addr)X
1 f
1798(parameter)X
2140(indicates)X
2445(which)X
2661(timer)X
2850(expired.)X
576 3584(PRU_PROTORCV)N
776 3680(This)N
944(request)X
1202(is)X
1282(used)X
1456(in)X
1545(the)X
1670(protocol-protocol)X
2258(interface,)X
2587(not)X
2716(by)X
2823(the)X
2948(routines.)X
3273(It)X
3349(requests)X
3639(reception)X
3965(of)X
776 3776(data)N
930(destined)X
1217(for)X
1331(the)X
1449(protocol)X
1736(and)X
1872(not)X
1994(the)X
2112(user.)X
2306(No)X
2424(protocols)X
2742(currently)X
3052(use)X
3179(this)X
3314(facility.)X
576 3900(PRU_PROTOSEND)N
776 3996(This)N
946(request)X
1206(allows)X
1443(a)X
1508(protocol)X
1804(to)X
1895(send)X
2071(data)X
2234(destined)X
2530(for)X
2653(another)X
2923(protocol)X
3219(module,)X
3508(not)X
3639(a)X
3704(user.)X
3907(The)X
776 4092(details)N
1008(of)X
1098(how)X
1259(data)X
1416(is)X
1492(marked)X
1755(``addressed)X
2148(to)X
2232(protocol'')X
2575(instead)X
2824(of)X
2913(``addressed)X
3306(to)X
3390(user'')X
3600(are)X
3721(left)X
3850(to)X
3934(the)X
776 4188(protocol)N
1063(modules.)X
1394(No)X
1512(protocols)X
1830(currently)X
2140(use)X
2267(this)X
2402(facility.)X
3 f
576 4380(8.)N
12 s
684(Protocol/protocol)X
1425(interface)X
1 f
10 s
776 4504(The)N
928(interface)X
1237(between)X
1532(protocol)X
1826(modules)X
2124(is)X
2204(through)X
2480(the)X
2 f
2605(pr_usrreq)X
1 f
(,)S
2 f
2972(pr_input)X
1 f
3247(,)X
2 f
3294(pr_output)X
1 f
3609(,)X
2 f
3657(pr_ctlinput)X
1 f
4012(,)X
576 4600(and)N
2 f
724(pr_ctloutput)X
1 f
1151(routines.)X
1481(The)X
1638(calling)X
1888(conventions)X
2307(for)X
2433(all)X
2545(but)X
2678(the)X
2 f
2807(pr_usrreq)X
1 f
3158(routine)X
3416(are)X
3546(expected)X
3863(to)X
3956(be)X
576 4696(speci\256c)N
844(to)X
930(the)X
1052(protocol)X
1343(modules)X
1638(and)X
1778(are)X
1901(not)X
2027(guaranteed)X
2404(to)X
2490(be)X
2590(consistent)X
2934(across)X
3159(protocol)X
3450(families.)X
3772(We)X
3908(will)X
576 4792(examine)N
868(the)X
986(conventions)X
1393(used)X
1560(for)X
1674(some)X
1863(of)X
1950(the)X
2068(Internet)X
2338(protocols)X
2656(in)X
2738(this)X
2873(section)X
3120(as)X
3207(an)X
3303(example.)X
3 f
576 4984(8.1.)N
736(pr_output)X
1 f
776 5108(The)N
921(Internet)X
1191(protocol)X
1478(UDP)X
1658(uses)X
1816(the)X
1934(convention,)X
864 5252(error)N
1041(=)X
1106(udp_output\(inp,)X
1639(m\);)X
864 5348(int)N
968(error;)X
1167(struct)X
1365(inpcb)X
1563(*inp;)X
1747(struct)X
1945(mbuf)X
2134(*m;)X
576 5492(where)N
800(the)X
2 f
925(inp)X
1 f
1027(,)X
1074(``)X
2 f
1128(in)X
1 f
1196(ternet)X
2 f
1406(p)X
1 f
1452(rotocol)X
2 f
1706(c)X
1 f
1748(ontrol)X
2 f
1966(b)X
1 f
2012(lock'',)X
2251(passed)X
2492(between)X
2787(modules)X
3085(conveys)X
3375(per)X
3505(connection)X
3885(state)X
576 5588(information,)N
999(and)X
1140(the)X
1263(mbuf)X
1457(chain)X
1656(contains)X
1948(the)X
2071(data)X
2230(to)X
2317(be)X
2417(sent.)X
2610(UDP)X
2794(performs)X
3108(consistency)X
3506(checks,)X
3769(appends)X
576 5684(its)N
671(header,)X
926(calculates)X
1263(a)X
1319(checksum,)X
1680(etc.)X
1814(before)X
2040(passing)X
2300(the)X
2419(packet)X
2650(on.)X
2791(UDP)X
2972(is)X
3046(based)X
3250(on)X
3351(the)X
3470(Internet)X
3741(Protocol,)X
576 5780(IP)N
667([Postel81a],)X
1072(as)X
1159(its)X
1254(transport.)X
1599(UDP)X
1779(passes)X
2004(a)X
2060(packet)X
2290(to)X
2372(the)X
2490(IP)X
2581(module)X
2841(for)X
2955(output)X
3179(as)X
3266(follows:)X

17 p
%%Page: 17 17
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3637(SMM:18-17)X
864 720(error)N
1041(=)X
1106(ip_output\(m,)X
1541(opt,)X
1683(ro,)X
1790(\257ags\);)X
864 816(int)N
968(error;)X
1167(struct)X
1365(mbuf)X
1554(*m,)X
1696(*opt;)X
1880(struct)X
2078(route)X
2263(*ro;)X
2412(int)X
2516(\257ags;)X
776 988(The)N
926(call)X
1067(to)X
1154(IP's)X
1308(output)X
1537(routine)X
1789(is)X
1867(more)X
2057(complicated)X
2474(than)X
2637(that)X
2782(for)X
2901(UDP,)X
3106(as)X
3198(be\256ts)X
3397(the)X
3521(additional)X
3867(work)X
576 1084(the)N
697(IP)X
791(module)X
1054(must)X
1232(do.)X
1375(The)X
2 f
1523(m)X
1 f
1604(parameter)X
1949(is)X
2025(the)X
2146(data)X
2303(to)X
2388(be)X
2487(sent,)X
2659(and)X
2798(the)X
2 f
2919(opt)X
1 f
3044(parameter)X
3389(is)X
3464(an)X
3562(optional)X
3846(list)X
3965(of)X
576 1180(IP)N
670(options)X
929(which)X
1149(should)X
1386(be)X
1486(placed)X
1720(in)X
1806(the)X
1928(IP)X
2023(packet)X
2257(header.)X
2536(The)X
2 f
2685(ro)X
1 f
2780(parameter)X
3126(is)X
3203(is)X
3280(used)X
3451(in)X
3537(making)X
3801(routing)X
576 1276(decisions)N
897(\(and)X
1063(passing)X
1326(them)X
1509(back)X
1684(to)X
1769(the)X
1890(caller)X
2092(for)X
2209(use)X
2339(in)X
2424(subsequent)X
2803(calls\).)X
3040(The)X
3188(\256nal)X
3352(parameter,)X
2 f
3716(\257ags)X
1 f
3889(con-)X
576 1372(tains)N
750(\257ags)X
924(indicating)X
1267(whether)X
1549(the)X
1670(user)X
1827(is)X
1903(allowed)X
2180(to)X
2265(transmit)X
2550(a)X
2609(broadcast)X
2940(packet)X
3173(and)X
3312(if)X
3384(routing)X
3639(is)X
3716(to)X
3802(be)X
3902(per-)X
576 1468(formed.)N
870(The)X
1017(broadcast)X
1347(\257ag)X
1489(may)X
1649(be)X
1747(inconsequential)X
2272(if)X
2343(the)X
2463(underlying)X
2832(hardware)X
3154(does)X
3323(not)X
3447(support)X
3709(the)X
3828(notion)X
576 1564(of)N
663(broadcasting.)X
776 1688(All)N
903(output)X
1132(routines)X
1415(return)X
1632(0)X
1697(on)X
1802(success)X
2068(and)X
2209(a)X
2270(UNIX)X
2497(error)X
2680(number)X
2951(if)X
3026(a)X
3088(failure)X
3324(occurred)X
3632(which)X
3854(could)X
576 1784(be)N
672(detected)X
960(immediately)X
1380(\(no)X
1507(buffer)X
1724(space)X
1923(available,)X
2253(no)X
2353(route)X
2538(to)X
2620(destination,)X
3011(etc.\).)X
3 f
576 1976(8.2.)N
736(pr_input)X
1 f
776 2100(Both)N
951(UDP)X
1131(and)X
1267(TCP)X
1433(use)X
1560(the)X
1678(following)X
2009(calling)X
2247(convention,)X
864 2244(\(void\))N
1080(\(*protosw[].pr_input\)\(m,)X
1906(ifp\);)X
864 2340(struct)N
1062(mbuf)X
1251(*m;)X
1395(struct)X
1593(ifnet)X
1760(*ifp;)X
576 2484(Each)N
758(mbuf)X
948(list)X
1066(passed)X
1301(is)X
1375(a)X
1432(single)X
1644(packet)X
1875(to)X
1958(be)X
2055(processed)X
2394(by)X
2496(the)X
2616(protocol)X
2905(module.)X
3207(The)X
3354(interface)X
3658(from)X
3836(which)X
576 2580(the)N
694(packet)X
924(was)X
1069(received)X
1362(is)X
1435(passed)X
1669(as)X
1756(the)X
1874(second)X
2117(parameter.)X
776 2704(The)N
922(IP)X
1014(input)X
1200(routine)X
1449(is)X
1524(a)X
1582(VAX)X
1778(software)X
2077(interrupt)X
2375(level)X
2553(routine,)X
2822(and)X
2960(so)X
3053(is)X
3128(not)X
3252(called)X
3466(with)X
3630(any)X
3768(parame-)X
576 2800(ters.)N
755(It)X
827(instead)X
1077(communicates)X
1563(with)X
1728(network)X
2014(interfaces)X
2350(through)X
2622(a)X
2681(queue,)X
2 f
2915(ipintrq)X
1 f
3132(,)X
3174(which)X
3392(is)X
3467(identical)X
3765(in)X
3849(struc-)X
576 2896(ture)N
725(to)X
811(the)X
933(queues)X
1180(used)X
1351(by)X
1455(the)X
1577(network)X
1865(interfaces)X
2203(for)X
2322(storing)X
2569(packets)X
2835(awaiting)X
3136(transmission.)X
3605(The)X
3755(software)X
576 2992(interrupt)N
872(is)X
945(enabled)X
1215(by)X
1315(the)X
1433(network)X
1716(interfaces)X
2049(when)X
2243(they)X
2401(place)X
2591(input)X
2775(data)X
2929(on)X
3029(the)X
3147(input)X
3331(queue.)X
3 f
576 3184(8.3.)N
736(pr_ctlinput)X
1 f
776 3308(This)N
944(routine)X
1197(is)X
1277(used)X
1451(to)X
1540(convey)X
1799(``control'')X
2161(information)X
2566(to)X
2655(a)X
2718(protocol)X
3012(module)X
3279(\(i.e.)X
3431(information)X
3836(which)X
576 3404(might)N
782(be)X
878(passed)X
1112(to)X
1194(the)X
1312(user,)X
1486(but)X
1608(is)X
1681(not)X
1803(data\).)X
776 3528(The)N
921(common)X
1221(calling)X
1459(convention)X
1835(for)X
1949(this)X
2084(routine)X
2331(is,)X
864 3672(\(void\))N
1080(\(*protosw[].pr_ctlinput\)\(req,)X
2027(addr\);)X
864 3768(int)N
968(req;)X
1113(struct)X
1311(sockaddr)X
1621(*addr;)X
576 3912(The)N
2 f
721(req)X
1 f
848(parameter)X
1190(is)X
1263(one)X
1399(of)X
1486(the)X
1604(following,)X

18 p
%%Page: 18 18
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-18)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
864 720(#de\256ne)N
1140(PRC_IFDOWN)X
2244(0)X
2564(/*)X
2646(interface)X
2948(transition)X
3270(*/)X
864 816(#de\256ne)N
1140(PRC_ROUTEDEAD)X
2244(1)X
2564(/*)X
2646(select)X
2849(new)X
3003(route)X
3188(if)X
3257(possible)X
3539(*/)X
864 912(#de\256ne)N
1140(PRC_QUENCH)X
2244(4)X
2564(/*)X
2646(some)X
2835(said)X
2984(to)X
3066(slow)X
3237(down)X
3435(*/)X
864 1008(#de\256ne)N
1140(PRC_MSGSIZE)X
2244(5)X
2564(/*)X
2646(message)X
2938(size)X
3083(forced)X
3309(drop)X
3476(*/)X
864 1104(#de\256ne)N
1140(PRC_HOSTDEAD)X
2244(6)X
2564(/*)X
2646(normally)X
2955(from)X
3131(IMP)X
3293(*/)X
864 1200(#de\256ne)N
1140(PRC_HOSTUNREACH)X
2244(7)X
2564(/*)X
2646(ditto)X
2812(*/)X
864 1296(#de\256ne)N
1140(PRC_UNREACH_NET)X
2244(8)X
2564(/*)X
2646(no)X
2746(route)X
2931(to)X
3013(network)X
3296(*/)X
864 1392(#de\256ne)N
1140(PRC_UNREACH_HOST)X
2244(9)X
2564(/*)X
2646(no)X
2746(route)X
2931(to)X
3013(host)X
3166(*/)X
864 1488(#de\256ne)N
1140(PRC_UNREACH_PROTOCOL)X
2244(10)X
2564(/*)X
2646(dst)X
2759(says)X
2917(bad)X
3053(protocol)X
3340(*/)X
864 1584(#de\256ne)N
1140(PRC_UNREACH_PORT)X
2244(11)X
2564(/*)X
2646(bad)X
2782(port)X
2931(#)X
2991(*/)X
864 1680(#de\256ne)N
1140(PRC_UNREACH_NEEDFRAG)X
2244(12)X
2564(/*)X
2646(IP_DF)X
2879(caused)X
3118(drop)X
3285(*/)X
864 1776(#de\256ne)N
1140(PRC_UNREACH_SRCFAIL)X
2244(13)X
2564(/*)X
2646(source)X
2876(route)X
3061(failed)X
3264(*/)X
864 1872(#de\256ne)N
1140(PRC_REDIRECT_NET)X
2244(14)X
2564(/*)X
2646(net)X
2764(routing)X
3015(redirect)X
3281(*/)X
864 1968(#de\256ne)N
1140(PRC_REDIRECT_HOST)X
2244(15)X
2564(/*)X
2646(host)X
2799(routing)X
3050(redirect)X
3316(*/)X
864 2064(#de\256ne)N
1140(PRC_REDIRECT_TOSNET)X
2244(14)X
2564(/*)X
2646(redirect)X
2912(for)X
3026(type)X
3184(of)X
3271(service)X
3519(&)X
3601(net)X
3719(*/)X
864 2160(#de\256ne)N
1140(PRC_REDIRECT_TOSHOST)X
2244(15)X
2564(/*)X
2646(redirect)X
2912(for)X
3026(tos)X
3139(&)X
3221(host)X
3374(*/)X
864 2256(#de\256ne)N
1140(PRC_TIMXCEED_INTRANS)X
2244(18)X
2564(/*)X
2646(packet)X
2876(lifetime)X
3145(expired)X
3406(in)X
3488(transit)X
3708(*/)X
864 2352(#de\256ne)N
1140(PRC_TIMXCEED_REASS)X
2244(19)X
2564(/*)X
2646(lifetime)X
2915(expired)X
3176(on)X
3276(reass)X
3457(q)X
3517(*/)X
864 2448(#de\256ne)N
1140(PRC_PARAMPROB)X
2244(20)X
2564(/*)X
2646(header)X
2881(incorrect)X
3187(*/)X
576 2592(while)N
780(the)X
2 f
904(addr)X
1 f
1081(parameter)X
1429(is)X
1508(the)X
1633(address)X
1901(to)X
1990(which)X
2213(the)X
2338(condition)X
2667(applies.)X
2961(Many)X
3175(of)X
3269(the)X
3394(requests)X
3684(have)X
3863(obvi-)X
576 2688(ously)N
776(been)X
955(derived)X
1223(from)X
1406(ICMP)X
1628(\(the)X
1780(Internet)X
2057(Control)X
2327(Message)X
2634(Protocol)X
2931([Postel81c]\),)X
3369(and)X
3511(from)X
3693(error)X
3876(mes-)X
576 2784(sages)N
772(de\256ned)X
1030(in)X
1114(the)X
1234(1822)X
1416(host/IMP)X
1735(convention)X
2113([BBN78].)X
2474(Mapping)X
2786(tables)X
2996(exist)X
3170(to)X
3255(convert)X
3519(control)X
3769(requests)X
576 2880(to)N
658(UNIX)X
879(error)X
1056(codes)X
1259(which)X
1475(are)X
1594(delivered)X
1913(to)X
1995(a)X
2051(user.)X
3 f
576 3072(8.4.)N
736(pr_ctloutput)X
1 f
776 3196(This)N
946(is)X
1027(the)X
1153(routine)X
1408(that)X
1556(implements)X
1957(per-socket)X
2320(options)X
2583(at)X
2669(the)X
2795(protocol)X
3091(level)X
3276(for)X
2 f
3399(getsockopt)X
1 f
3771(and)X
2 f
3916(set-)X
576 3292(sockopt)N
1 f
821(.)X
881(The)X
1026(calling)X
1264(convention)X
1640(is,)X
864 3436(error)N
1041(=)X
1106(\(*protosw[].pr_ctloutput\)\(op,)X
2070(so,)X
2181(level,)X
2377(optname,)X
2693(mp\);)X
864 3532(int)N
968(op;)X
1090(struct)X
1288(socket)X
1513(*so;)X
1666(int)X
1770(level,)X
1966(optname;)X
2284(struct)X
2482(mbuf)X
2671(**mp;)X
576 3676(where)N
2 f
796(op)X
1 f
899(is)X
975(one)X
1114(of)X
1204(PRCO_SETOPT)X
1768(or)X
1858(PRCO_GETOPT,)X
2 f
2456(so)X
1 f
2550(is)X
2626(the)X
2747(socket)X
2975(from)X
3155(whence)X
3425(the)X
3547(call)X
3687(originated,)X
576 3772(and)N
2 f
727(level)X
1 f
914(and)X
2 f
1065(optname)X
1 f
1376(are)X
1510(the)X
1643(protocol)X
1945(level)X
2136(and)X
2287(option)X
2526(name)X
2734(supplied)X
3039(by)X
3153(the)X
3285(user.)X
3493(The)X
3652(results)X
3895(of)X
3996(a)X
576 3868(PRCO_GETOPT)N
1172(call)X
1329(are)X
1470(returned)X
1780(in)X
1884(an)X
2002(mbuf)X
2213(whose)X
2460(address)X
2743(is)X
2838(placed)X
3090(in)X
2 f
3194(mp)X
1 f
3334(before)X
3582(return.)X
3856(On)X
3996(a)X
576 3964(PRCO_SETOPT)N
1143(call,)X
2 f
1305(mp)X
1 f
1429(contains)X
1722(the)X
1846(address)X
2113(of)X
2206(an)X
2308(mbuf)X
2503(containing)X
2867(the)X
2991(option)X
3220(data;)X
3401(the)X
3524(mbuf)X
3718(should)X
3956(be)X
576 4060(freed)N
762(before)X
988(return.)X
3 f
576 4252(9.)N
12 s
684 0.1275(Protocol/network-interface)AX
1820(interface)X
1 f
10 s
776 4376(The)N
922(lowest)X
1152(layer)X
1334(in)X
1417(the)X
1537(set)X
1648(of)X
1737(protocols)X
2057(which)X
2275(comprise)X
2591(a)X
2649(protocol)X
2938(family)X
3169(must)X
3346(interface)X
3650(itself)X
3832(to)X
3916(one)X
576 4472(or)N
670(more)X
862(network)X
1152(interfaces)X
1492(in)X
1581(order)X
1778(to)X
1867(transmit)X
2156(and)X
2299(receive)X
2559(packets.)X
2867(It)X
2943(is)X
3023(assumed)X
3326(that)X
3472(any)X
3614(routing)X
3871(deci-)X
576 4568(sions)N
761(have)X
934(been)X
1107(made)X
1302(before)X
1529(handing)X
1808(a)X
1865(packet)X
2096(to)X
2179(a)X
2236(network)X
2521(interface,)X
2845(in)X
2929(fact)X
3072(this)X
3209(is)X
3284(absolutely)X
3635(necessary)X
3970(in)X
576 4664(order)N
770(to)X
856(locate)X
1072(any)X
1212(interface)X
1518(at)X
1600(all)X
1704(\(unless,)X
1975(of)X
2066(course,)X
2320(one)X
2459(uses)X
2620(a)X
2679(single)X
2893 0.2708(``hardwired'')AX
3350(interface\).)X
3722(There)X
3933(are)X
576 4760(two)N
720(cases)X
914(with)X
1080(which)X
1300(to)X
1386(be)X
1486(concerned,)X
1861(transmission)X
2289(of)X
2380(a)X
2440(packet)X
2674(and)X
2814(receipt)X
3057(of)X
3148(a)X
3209(packet;)X
3466(each)X
3639(will)X
3788(be)X
3889(con-)X
576 4856(sidered)N
828(separately.)X
3 f
576 5048(9.1.)N
736(Packet)X
988(transmission)X
1 f
776 5172(Assuming)N
1122(a)X
1180(protocol)X
1469(has)X
1598(a)X
1656(handle)X
1892(on)X
1994(an)X
2092(interface,)X
2 f
2416(ifp)X
1 f
2500(,)X
2542(a)X
2600(\(struct)X
2827(ifnet)X
2994(*\),)X
3104(it)X
3171(transmits)X
3487(a)X
3546(fully)X
3720(formatted)X
576 5268(packet)N
806(with)X
968(the)X
1086(following)X
1417(call,)X
864 5412(error)N
1041(=)X
1106(\(*ifp->if_output\)\(ifp,)X
1810(m,)X
1912(dst\))X
864 5508(int)N
968(error;)X
1167(struct)X
1365(ifnet)X
1532(*ifp;)X
1703(struct)X
1901(mbuf)X
2090(*m;)X
2234(struct)X
2432(sockaddr)X
2742(*dst;)X
576 5652(The)N
726(output)X
956(routine)X
1209(for)X
1329(the)X
1453(network)X
1742(interface)X
2050(transmits)X
2369(the)X
2493(packet)X
2 f
2729(m)X
1 f
2813(to)X
2901(the)X
2 f
3025(dst)X
1 f
3144(address,)X
3431(or)X
3524(returns)X
3773(an)X
3875(error)X
576 5748(indication)N
923(\(a)X
1012(UNIX)X
1239(error)X
1422(number\).)X
1760(In)X
1853(reality)X
2084(transmission)X
2514(may)X
2678(not)X
2806(be)X
2908(immediate)X
3272(or)X
3365(successful;)X
3743(normally)X
576 5844(the)N
703(output)X
936(routine)X
1192(simply)X
1438(queues)X
1690(the)X
1818(packet)X
2058(on)X
2168(its)X
2273(send)X
2450(queue)X
2672(and)X
2818(primes)X
3066(an)X
3172(interrupt)X
3478(driven)X
3713(routine)X
3970(to)X

19 p
%%Page: 19 19
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3637(SMM:18-19)X
576 672(actually)N
852(transmit)X
1136(the)X
1256(packet.)X
1528(For)X
1661(unreliable)X
2004(media,)X
2242(such)X
2411(as)X
2499(the)X
2618(Ethernet,)X
2931(``successful'')X
3390(transmission)X
3815(simply)X
576 768(means)N
805(that)X
949(the)X
1071(packet)X
1305(has)X
1436(been)X
1612(placed)X
1846(on)X
1950(the)X
2072(cable)X
2266(without)X
2534(a)X
2595(collision.)X
2935(On)X
3058(the)X
3181(other)X
3371(hand,)X
3572(an)X
3673(1822)X
3858(inter-)X
576 864(face)N
735(guarantees)X
1103(proper)X
1337(delivery)X
1624(or)X
1715(an)X
1815(error)X
1996(indication)X
2339(for)X
2456(each)X
2627(message)X
2922(transmitted.)X
3345(The)X
3493(model)X
3716(employed)X
576 960(in)N
666(the)X
792(networking)X
1185(system)X
1435(attaches)X
1722(no)X
1830(promises)X
2147(of)X
2242(delivery)X
2533(to)X
2624(the)X
2751(packets)X
3021(handed)X
3282(to)X
3373(a)X
3438(network)X
3730(interface,)X
576 1056(and)N
713(thus)X
867(corresponds)X
1276(more)X
1462(closely)X
1710(to)X
1793(the)X
1912(Ethernet.)X
2244(Errors)X
2465(returned)X
2753(by)X
2853(the)X
2971(output)X
3195(routine)X
3442(are)X
3561(only)X
3723(those)X
3912(that)X
576 1152(can)N
714(be)X
816(detected)X
1110(immediately,)X
1556(and)X
1698(are)X
1823(normally)X
2138(trivial)X
2355(in)X
2443(nature)X
2670(\(no)X
2803(buffer)X
3026(space,)X
3251(address)X
3519(format)X
3760(not)X
3889(han-)X
576 1248(dled,)N
754(etc.\).)X
955(No)X
1073(indication)X
1413(is)X
1486(received)X
1779(if)X
1848(errors)X
2056(are)X
2175(detected)X
2463(after)X
2631(the)X
2749(call)X
2885(has)X
3012(returned.)X
3 f
576 1440(9.2.)N
736(Packet)X
988(reception)X
1 f
776 1564(Each)N
964(protocol)X
1258(family)X
1494(must)X
1676(have)X
1855(one)X
1999(or)X
2094(more)X
2287(``lowest)X
2578(level'')X
2816(protocols.)X
3182(These)X
3402(protocols)X
3728(deal)X
3890(with)X
576 1660(internetwork)N
1017(addressing)X
1390(and)X
1536(are)X
1665(responsible)X
2060(for)X
2184(the)X
2312(delivery)X
2605(of)X
2702(incoming)X
3034(packets)X
3305(to)X
3397(the)X
3525(proper)X
3765(protocol)X
576 1756(processing)N
940(modules.)X
1272(In)X
1360(the)X
1479(PUP)X
1646(model)X
1867([Boggs78])X
2226(these)X
2412(protocols)X
2731(are)X
2851(termed)X
3095(Level)X
3299(1)X
3360(protocols,)X
3699(in)X
3783(the)X
3903(ISO)X
576 1852(model,)N
831(network)X
1129(layer)X
1325(protocols.)X
1698(In)X
1800(this)X
1950(system)X
2207(each)X
2390(such)X
2572(protocol)X
2873(module)X
3147(has)X
3288(an)X
3398(input)X
3596(packet)X
3840(queue)X
576 1948(assigned)N
872(to)X
954(it.)X
1058(Incoming)X
1385(packets)X
1646(received)X
1939(by)X
2039(a)X
2096(network)X
2380(interface)X
2683(are)X
2803(queued)X
3056(for)X
3171(the)X
3290(protocol)X
3578(module,)X
3859(and)X
3996(a)X
576 2044(VAX)N
770(software)X
1067(interrupt)X
1363(is)X
1436(posted)X
1665(to)X
1747(initiate)X
1989(processing.)X
776 2168(Three)N
984(macros)X
1236(are)X
1355(available)X
1665(for)X
1779(queuing)X
2057(and)X
2193(dequeuing)X
2547(packets:)X
576 2292(IF_ENQUEUE\(ifq,)N
1222(m\))X
776 2388(This)N
938(places)X
1159(the)X
1277(packet)X
2 f
1507(m)X
1 f
1585(at)X
1663(the)X
1781(tail)X
1903(of)X
1990(the)X
2108(queue)X
2 f
2320(ifq)X
1 f
2404(.)X
576 2512(IF_DEQUEUE\(ifq,)N
1222(m\))X
776 2608(This)N
945(places)X
1174(a)X
1238(pointer)X
1493(to)X
1583(the)X
1709(packet)X
1947(at)X
2033(the)X
2159(head)X
2339(of)X
2434(queue)X
2 f
2654(ifq)X
1 f
2766(in)X
2 f
2856(m)X
1 f
2942(and)X
3086(removes)X
3386(the)X
3512(packet)X
3750(from)X
3934(the)X
776 2704(queue.)N
1028(A)X
1106(zero)X
1265(value)X
1459(will)X
1603(be)X
1699(returned)X
1987(in)X
2 f
2069(m)X
1 f
2147(if)X
2216(the)X
2334(queue)X
2546(is)X
2619(empty.)X
576 2828(IF_DEQUEUEIF\(ifq,)N
1293(m,)X
1395(ifp\))X
776 2924(Like)N
948(IF_DEQUEUE,)X
1483(this)X
1623(removes)X
1920(the)X
2044(next)X
2208(packet)X
2444(from)X
2626(the)X
2750(head)X
2928(of)X
3021(a)X
3083(queue)X
3301(and)X
3443(returns)X
3692(it)X
3762(in)X
2 f
3850(m)X
1 f
3908(.)X
3974(A)X
776 3020(pointer)N
1023(to)X
1105(the)X
1223(interface)X
1525(on)X
1625(which)X
1841(the)X
1959(packet)X
2189(was)X
2334(received)X
2627(is)X
2700(placed)X
2930(in)X
2 f
3012(ifp)X
1 f
3096(,)X
3136(a)X
3192(\(struct)X
3417(ifnet)X
3584(*\).)X
576 3144(IF_PREPEND\(ifq,)N
1198(m\))X
776 3240(This)N
938(places)X
1159(the)X
1277(packet)X
2 f
1507(m)X
1 f
1585(at)X
1663(the)X
1781(head)X
1953(of)X
2040(the)X
2158(queue)X
2 f
2370(ifq)X
1 f
2454(.)X
776 3364(Each)N
964(queue)X
1183(has)X
1317(a)X
1380(maximum)X
1731(length)X
1958(associated)X
2316(with)X
2486(it)X
2558(as)X
2653(a)X
2717(simple)X
2958(form)X
3142(of)X
3237(congestion)X
3612(control.)X
3907(The)X
576 3460(macro)N
806(IF_QFULL\(ifq\))X
1347(returns)X
1599(1)X
1668(if)X
1745(the)X
1871(queue)X
2091(is)X
2172(\256lled,)X
2384(in)X
2474(which)X
2698(case)X
2865(the)X
2991(macro)X
3220(IF_DROP\(ifq\))X
3715(should)X
3956(be)X
576 3556(used)N
749(to)X
837(increment)X
1184(the)X
1308(count)X
1512(of)X
1605(the)X
1729(number)X
2000(of)X
2093(packets)X
2360(dropped,)X
2669(and)X
2811(the)X
2935(offending)X
3274(packet)X
3511(is)X
3591(dropped.)X
3921(For)X
576 3652(example,)N
888(the)X
1006(following)X
1337(code)X
1509(fragment)X
1819(is)X
1892(commonly)X
2254(found)X
2461(in)X
2543(a)X
2599(network)X
2882(interface's)X
3242(input)X
3426(routine,)X
864 3796(if)N
933(\(IF_QFULL\(inq\)\))X
1532({)X
1152 3892(IF_DROP\(inq\);)N
1152 3988(m_freem\(m\);)N
864 4084(})N
922(else)X
1152 4180(IF_ENQUEUE\(inq,)N
1811(m\);)X
3 f
576 4420(10.)N
12 s
724(Gateways)X
1148(and)X
1326(routing)X
1654(issues)X
1 f
10 s
776 4544(The)N
927(system)X
1175(has)X
1308(been)X
1486(designed)X
1797(with)X
1965(the)X
2089(expectation)X
2485(that)X
2632(it)X
2703(will)X
2854(be)X
2957(used)X
3131(in)X
3220(an)X
3323(internetwork)X
3760(environ-)X
576 4640(ment.)N
797(The)X
943(``canonical'')X
1380(environment)X
1806(was)X
1952(envisioned)X
2320(to)X
2403(be)X
2500(a)X
2557(collection)X
2894(of)X
2982(local)X
3159(area)X
3314(networks)X
3628(connected)X
3974(at)X
576 4736(one)N
718(or)X
811(more)X
1002(points)X
1223(through)X
1499(hosts)X
1690(with)X
1859(multiple)X
2152(network)X
2442(interfaces)X
2782(\(one)X
2952(on)X
3059(each)X
3234(local)X
3417(area)X
3579(network\),)X
3916(and)X
576 4832(possibly)N
876(a)X
946(connection)X
1332(to)X
1428(a)X
1497(long)X
1672(haul)X
1843(network)X
2139(\(for)X
2293(example,)X
2618(the)X
2749(ARPANET\).)X
3218(In)X
3318(such)X
3498(an)X
3607(environment,)X
576 4928(issues)N
792(of)X
884(gatewaying)X
1279(and)X
1420(packet)X
1655(routing)X
1911(become)X
2187(very)X
2356(important.)X
2733(Certain)X
2995(of)X
3088(these)X
3279(issues,)X
3516(such)X
3689(as)X
3782(conges-)X
576 5024(tion)N
724(control,)X
995(have)X
1170(been)X
1345(handled)X
1622(in)X
1707(a)X
1766(simplistic)X
2099(manner)X
2363(or)X
2453(speci\256cally)X
2841(not)X
2966(addressed.)X
3346(Instead,)X
3621(where)X
3841(possi-)X
576 5120(ble,)N
714(the)X
832(network)X
1115(system)X
1357(attempts)X
1648(to)X
1730(provide)X
1995(simple)X
2228(mechanisms)X
2644(upon)X
2824(which)X
3040(more)X
3226(involved)X
3527(policies)X
3797(may)X
3956(be)X
576 5216(implemented.)N
1055(As)X
1165(some)X
1355(of)X
1443(these)X
1629(problems)X
1948(become)X
2219(better)X
2423(understood,)X
2820(the)X
2939(solutions)X
3248(developed)X
3599(will)X
3744(be)X
3840(incor-)X
576 5312(porated)N
837(into)X
981(the)X
1099(system.)X
776 5436(This)N
940(section)X
1189(will)X
1335(describe)X
1626(the)X
1747(facilities)X
2046(provided)X
2354(for)X
2471(packet)X
2704(routing.)X
2998(The)X
3146(simplistic)X
3479(mechanisms)X
3898(pro-)X
576 5532(vided)N
774(for)X
888(congestion)X
1255(control)X
1502(are)X
1621(described)X
1949(in)X
2031(chapter)X
2288(12.)X

20 p
%%Page: 20 20
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-20)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
3 f
576 672(10.1.)N
776(Routing)X
1071(tables)X
1 f
776 796(The)N
934(network)X
1230(system)X
1485(maintains)X
1829(a)X
1898(set)X
2020(of)X
2120(routing)X
2384(tables)X
2604(for)X
2731(selecting)X
3050(a)X
3120(network)X
3417(interface)X
3733(to)X
3829(use)X
3970(in)X
576 892(delivering)N
921(a)X
977(packet)X
1207(to)X
1289(its)X
1384(destination.)X
1795(These)X
2007(tables)X
2214(are)X
2333(of)X
2420(the)X
2538(form:)X
864 1036(struct)N
1062(rtentry)X
1296({)X
1102 1132(u_long)N
1384(rt_hash;)X
2153(/*)X
2235(hash)X
2402(key)X
2538(for)X
2652(lookups)X
2925(*/)X
1102 1228(struct)N
1384(sockaddr)X
1694(rt_dst;)X
2153(/*)X
2235(destination)X
2606(net)X
2724(or)X
2811(host)X
2964(*/)X
1102 1324(struct)N
1384(sockaddr)X
1694(rt_gateway;)X
2153(/*)X
2235(forwarding)X
2612(agent)X
2806(*/)X
1102 1420(short)N
1384(rt_\257ags;)X
2153(/*)X
2235(see)X
2358(below)X
2574(*/)X
1102 1516(short)N
1384(rt_refcnt;)X
2153(/*)X
2235(no.)X
2355(of)X
2442 0.3889(references)AX
2794(to)X
2876(structure)X
3177(*/)X
1102 1612(u_long)N
1384(rt_use;)X
2153(/*)X
2235(packets)X
2496(sent)X
2645(using)X
2838(route)X
3023(*/)X
1102 1708(struct)N
1384(ifnet)X
1551(*rt_ifp;)X
2153(/*)X
2235(interface)X
2537(to)X
2619(give)X
2777(packet)X
3007(to)X
3089(*/)X
864 1804(};)N
776 1976(The)N
932(routing)X
1194(information)X
1603(is)X
1687(organized)X
2035(in)X
2128(two)X
2279(separate)X
2574(tables,)X
2813(one)X
2961(for)X
3087(routes)X
3315(to)X
3409(a)X
3477(host)X
3642(and)X
3790(one)X
3938(for)X
576 2072(routes)N
798(to)X
886(a)X
948(network.)X
1277(The)X
1428(distinction)X
1791(between)X
2084(hosts)X
2273(and)X
2414(networks)X
2733(is)X
2811(necessary)X
3149(so)X
3245(that)X
3390(a)X
3451(single)X
3667(mechanism)X
576 2168(may)N
740(be)X
842(used)X
1015(for)X
1135(both)X
1303(broadcast)X
1637(and)X
1780(multi-drop)X
2149(type)X
2314(networks,)X
2655(and)X
2798(also)X
2954(for)X
3075(networks)X
3396(built)X
3569(from)X
3752(point-to-)X
576 2264(point)N
760(links)X
935(\(e.g)X
1078(DECnet)X
1356([DEC80]\).)X
776 2388(Each)N
958(table)X
1135(is)X
1209(organized)X
1547(as)X
1635(a)X
1692(hashed)X
1937(set)X
2048(of)X
2137(linked)X
2359(lists.)X
2549(Two)X
2718(32-bit)X
2931(hash)X
3100(values)X
3327(are)X
3448(calculated)X
3796(by)X
3898(rou-)X
576 2484(tines)N
751(de\256ned)X
1011(for)X
1128(each)X
1299(address)X
1563(family;)X
1817(one)X
1956(based)X
2162(on)X
2265(the)X
2386(destination)X
2760(being)X
2961(a)X
3020(host,)X
3196(and)X
3335(one)X
3474(assuming)X
3799(the)X
3920(tar-)X
576 2580(get)N
696(is)X
771(the)X
891(network)X
1176(portion)X
1429(of)X
1518(the)X
1638(address.)X
1941(Each)X
2124(hash)X
2294(value)X
2491(is)X
2567(used)X
2737(to)X
2822(locate)X
3037(a)X
3096(hash)X
3266(chain)X
3463(to)X
3548(search)X
3777(\(by)X
3907(tak-)X
576 2676(ing)N
703(the)X
826(value)X
1025(modulo)X
1294(the)X
1417(hash)X
1589(table)X
1770(size\))X
1947(and)X
2088(the)X
2211(entire)X
2419(32-bit)X
2635(value)X
2834(is)X
2912(then)X
3075(used)X
3247(as)X
3339(a)X
3399(key)X
3539(in)X
3625(scanning)X
3934(the)X
576 2772(list)N
694(of)X
782(routes.)X
1039(Lookups)X
1340(are)X
1460(applied)X
1717(\256rst)X
1862(to)X
1945(the)X
2064(routing)X
2316(table)X
2493(for)X
2608(hosts,)X
2813(then)X
2972(to)X
3055(the)X
3174(routing)X
3426(table)X
3603(for)X
3718(networks.)X
576 2868(If)N
656(both)X
824(lookups)X
1103(fail,)X
1256(a)X
1318(\256nal)X
1486(lookup)X
1734(is)X
1813(made)X
2013(for)X
2133(a)X
2195(``wildcard'')X
2610(route)X
2801(\(by)X
2934(convention,)X
3336(network)X
3625(0\).)X
3758(The)X
3908(\256rst)X
576 2964(appropriate)N
965(route)X
1153(discovered)X
1525(is)X
1602(used.)X
1813(By)X
1930(doing)X
2136(this,)X
2295(routes)X
2515(to)X
2601(a)X
2661(speci\256c)X
2930(host)X
3087(on)X
3191(a)X
3251(network)X
3538(may)X
3700(be)X
3800(present)X
576 3060(as)N
666(well)X
827(as)X
917(routes)X
1136(to)X
1221(the)X
1342(network.)X
1668(This)X
1833(also)X
1985(allows)X
2217(a)X
2276(``fall)X
2460(back'')X
2689(network)X
2975(route)X
3163(to)X
3248(be)X
3346(de\256ned)X
3604(to)X
3688(a)X
3746(``smart'')X
576 3156(gateway)N
864(which)X
1080(may)X
1238(then)X
1396(perform)X
1675(more)X
1860(intelligent)X
2204(routing.)X
776 3280(Each)N
961(routing)X
1216(table)X
1396(entry)X
1585(contains)X
1876(a)X
1936(destination)X
2311(\(the)X
2461(desired)X
2718(\256nal)X
2885(destination\),)X
3308(a)X
3369(gateway)X
3662(to)X
3749(which)X
3970(to)X
576 3376(send)N
746(the)X
867(packet,)X
1120(and)X
1259(various)X
1518(\257ags)X
1692(which)X
1911(indicate)X
2188(the)X
2309(route's)X
2555(status)X
2760(and)X
2899(type)X
3060(\(host)X
3243(or)X
3333(network\).)X
3685(A)X
3765(count)X
3965(of)X
576 3472(the)N
696(number)X
963(of)X
1052(packets)X
1315(sent)X
1466(using)X
1661(the)X
1781(route)X
1968(is)X
2043(kept,)X
2223(along)X
2423(with)X
2587(a)X
2645(count)X
2845(of)X
2935(``held)X
3150 0.3864(references'')AX
3559(to)X
3644(the)X
3765(dynami-)X
576 3568(cally)N
768(allocated)X
1094(structure)X
1411(to)X
1509(insure)X
1741(that)X
1897(memory)X
2200(reclamation)X
2615(occurs)X
2861(only)X
3039(when)X
3249(the)X
3383(route)X
3583(is)X
3671(not)X
3808(in)X
3905(use.)X
576 3664(Finally,)N
847(a)X
908(pointer)X
1160(to)X
1247(the)X
1370(a)X
1432(network)X
1721(interface)X
2029(is)X
2108(kept;)X
2294(packets)X
2561(sent)X
2716(using)X
2915(the)X
3039(route)X
3230(should)X
3469(be)X
3571(handed)X
3829(to)X
3917(this)X
576 3760(interface.)N
776 3884(Routes)N
1035(are)X
1171(typed)X
1386(in)X
1485(two)X
1642(ways:)X
1866(either)X
2086(as)X
2190(host)X
2360(or)X
2464(network,)X
2784(and)X
2937(as)X
3042(``direct'')X
3371(or)X
3476(``indirect''.)X
3907(The)X
576 3980(host/network)N
1017(distinction)X
1377(determines)X
1752(how)X
1913(to)X
1998(compare)X
2298(the)X
2 f
2419(rt_dst)X
1 f
2628(\256eld)X
2792(during)X
3023(lookup.)X
3307(If)X
3383(the)X
3503(route)X
3690(is)X
3765(to)X
3849(a)X
3907(net-)X
576 4076(work,)N
782(only)X
945(a)X
1002(packet's)X
1291(destination)X
1663(network)X
1947(is)X
2021(compared)X
2359(to)X
2442(the)X
2 f
2561(rt_dst)X
1 f
2769(entry)X
2956(stored)X
3174(in)X
3258(the)X
3378(table.)X
3596(If)X
3672(the)X
3792(route)X
3979(is)X
576 4172(to)N
658(a)X
714(host,)X
887(the)X
1005(addresses)X
1333(must)X
1508(match)X
1724(bit)X
1828(for)X
1942(bit.)X
776 4296(The)N
924(distinction)X
1284(between)X
1575(``direct'')X
1889(and)X
2028(``indirect'')X
2404(routes)X
2623(indicates)X
2931(whether)X
3213(the)X
3335(destination)X
3710(is)X
3787(directly)X
576 4392(connected)N
926(to)X
1012(the)X
1134(source.)X
1408(This)X
1574(is)X
1651(needed)X
1903(when)X
2100(performing)X
2484(local)X
2663(network)X
2949(encapsulation.)X
3453(If)X
3530(a)X
3589(packet)X
3822(is)X
3898(des-)X
576 4488(tined)N
759(for)X
876(a)X
935(peer)X
1097(at)X
1178(a)X
1237(host)X
1393(or)X
1483(network)X
1769(which)X
1988(is)X
2064(not)X
2189(directly)X
2457(connected)X
2806(to)X
2891(the)X
3012(source,)X
3266(the)X
3388(internetwork)X
3822(packet)X
576 4584(header)N
814(will)X
961(contain)X
1220(the)X
1341(address)X
1605(of)X
1695(the)X
1816(eventual)X
2111(destination,)X
2505(while)X
2705(the)X
2825(local)X
3003(network)X
3288(header)X
3525(will)X
3671(address)X
3934(the)X
576 4680(intervening)N
965(gateway.)X
1297(Should)X
1547(the)X
1669(destination)X
2044(be)X
2144(directly)X
2413(connected,)X
2783(these)X
2972(addresses)X
3304(are)X
3428(likely)X
3635(to)X
3722(be)X
3823(identi-)X
576 4776(cal,)N
723(or)X
823(a)X
892(mapping)X
1205(between)X
1506(the)X
1637(two)X
1790(exists.)X
2045(The)X
2203(RTF_GATEWAY)X
2828(\257ag)X
2981(indicates)X
3298(that)X
3450(the)X
3580(route)X
3777(is)X
3862(to)X
3956(an)X
576 4872(``indirect'')N
954(gateway)X
1247(agent,)X
1466(and)X
1607(that)X
1752(the)X
1875(local)X
2056(network)X
2344(header)X
2584(should)X
2822(be)X
2923(\256lled)X
3112(in)X
3199(from)X
3380(the)X
2 f
3504(rt_gateway)X
1 f
3890(\256eld)X
576 4968(instead)N
823(of)X
910(from)X
1086(the)X
1204(\256nal)X
1366(internetwork)X
1796(destination)X
2167(address.)X
776 5092(It)N
852(is)X
932(assumed)X
1235(that)X
1383(multiple)X
1677(routes)X
1901(to)X
1991(the)X
2117(same)X
2310(destination)X
2689(will)X
2841(not)X
2971(be)X
3075(present;)X
3357(only)X
3527(one)X
3671(of)X
3766(multiple)X
576 5188(routes,)N
812(that)X
952(most)X
1127(recently)X
1406(installed,)X
1717(will)X
1861(be)X
1957(used.)X
776 5312(Routing)N
1061(redirect)X
1335(control)X
1590(messages)X
1921(are)X
2048(used)X
2223(to)X
2313(dynamically)X
2737(modify)X
2996(existing)X
3277(routing)X
3537(table)X
3722(entries)X
3965(as)X
576 5408(well)N
736(as)X
825(dynamically)X
1243(create)X
1458(new)X
1614(routing)X
1867(table)X
2044(entries.)X
2319(On)X
2438(hosts)X
2623(where)X
2841(exhaustive)X
3205(routing)X
3457(information)X
3856(is)X
3930(too)X
576 5504(expensive)N
919(to)X
1003(maintain)X
1305(\(e.g.)X
1470(work)X
1657(stations\),)X
1970(the)X
2090(combination)X
2512(of)X
2601(wildcard)X
2904(routing)X
3157(entries)X
3393(and)X
3532(routing)X
3786(redirect)X
576 5600(messages)N
907(can)X
1047(be)X
1151(used)X
1326(to)X
1416(provide)X
1689(a)X
1753(simple)X
1994(routing)X
2252(management)X
2689(scheme)X
2957(without)X
3228(the)X
3353(use)X
3487(of)X
3581(a)X
3644(higher)X
3876(level)X
576 5696(policy)N
803(process.)X
1091(Current)X
1363(connections)X
1773(may)X
1938(be)X
2041(rerouted)X
2336(after)X
2511(noti\256cation)X
2902(of)X
2997(the)X
3123(protocols)X
3449(by)X
3557(means)X
3790(of)X
3885(their)X
2 f
576 5792(pr_ctlinput)N
1 f
954(entries.)X
1231(Statistics)X
1542(are)X
1664(kept)X
1825(by)X
1928(the)X
2049(routing)X
2303(table)X
2482(routines)X
2763(on)X
2866(the)X
2987(use)X
3117(of)X
3207(routing)X
3461(redirect)X
3729(messages)X

21 p
%%Page: 21 21
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3637(SMM:18-21)X
576 672(and)N
712(their)X
879(affect)X
1083(on)X
1183(the)X
1301(routing)X
1552(tables.)X
1799(These)X
2011(statistics)X
2306(may)X
2464(be)X
2560(viewed)X
2812(using)X
2 f
3005(netstat)X
1 f
3218(\(1\).)X
776 796(Status)N
1003(information)X
1413(other)X
1610(than)X
1780(routing)X
2043(redirect)X
2321(control)X
2580(messages)X
2915(may)X
3085(be)X
3193(used)X
3372(in)X
3466(the)X
3596(future,)X
3840(but)X
3974(at)X
576 892(present)N
842(they)X
1014(are)X
1147(ignored.)X
1466(Likewise,)X
1814(more)X
2013(intelligent)X
2371(``metrics'')X
2749(may)X
2921(be)X
3031(used)X
3212(to)X
3308(describe)X
3610(routes)X
3839(in)X
3934(the)X
576 988(future,)N
808(possibly)X
1094(based)X
1297(on)X
1397(bandwidth)X
1755(and)X
1891(monetary)X
2214(costs.)X
3 f
576 1180(10.2.)N
776(Routing)X
1071(table)X
1260(interface)X
1 f
776 1304(A)N
861(protocol)X
1155(accesses)X
1455(the)X
1580(routing)X
1838(tables)X
2052(through)X
2328(three)X
2516(routines,)X
2821(one)X
2964(to)X
3053(allocate)X
3331(a)X
3395(route,)X
3608(one)X
3752(to)X
3842(free)X
3996(a)X
576 1400(route,)N
783(and)X
921(one)X
1059(to)X
1143(process)X
1406(a)X
1464(routing)X
1717(redirect)X
1985(control)X
2234(message.)X
2568(The)X
2715(routine)X
2 f
2963(rtalloc)X
1 f
3197(performs)X
3508(route)X
3694(allocation;)X
576 1496(it)N
640(is)X
713(called)X
925(with)X
1087(a)X
1143(pointer)X
1390(to)X
1472(the)X
1590(following)X
1921(structure)X
2222(containing)X
2580(the)X
2698(desired)X
2950(destination:)X
864 1640(struct)N
1062(route)X
1247({)X
1152 1736(struct)N
1584(rtentry)X
1818(*ro_rt;)X
1152 1832(struct)N
1584(sockaddr)X
1894(ro_dst;)X
864 1928(};)N
576 2072(The)N
732(route)X
928(returned)X
1227(is)X
1311(assumed)X
1618(``held'')X
1895(by)X
2007(the)X
2137(caller)X
2348(until)X
2526(released)X
2822(with)X
2996(an)X
2 f
3104(rtfree)X
1 f
3314(call.)X
3502(Protocols)X
3836(which)X
576 2168(implement)N
947(virtual)X
1185(circuits,)X
1470(such)X
1646(as)X
1742(TCP,)X
1937(hold)X
2108(onto)X
2278(routes)X
2502(for)X
2624(the)X
2750(duration)X
3045(of)X
3140(the)X
3266(circuit's)X
3557(lifetime,)X
3854(while)X
576 2264(connection-less)N
1117(protocols,)X
1477(such)X
1666(as)X
1775(UDP,)X
1997(allocate)X
2289(and)X
2447(free)X
2615(routes)X
2853(whenever)X
3208(their)X
3397(destination)X
3791(address)X
576 2360(changes.)N
776 2484(The)N
921(routine)X
2 f
1168(rtredirect)X
1 f
1495(is)X
1568(called)X
1780(to)X
1862(process)X
2123(a)X
2179(routing)X
2430(redirect)X
2696(control)X
2944(message.)X
3277(It)X
3347(is)X
3421(called)X
3634(with)X
3797(a)X
3854(desti-)X
576 2580(nation)N
800(address,)X
1085(the)X
1207(new)X
1365(gateway)X
1657(to)X
1743(that)X
1887(destination,)X
2282(and)X
2422(the)X
2544(source)X
2778(of)X
2869(the)X
2991(redirect.)X
3301(Redirects)X
3628(are)X
3750(accepted)X
576 2676(only)N
741(from)X
920(the)X
1041(current)X
1292(router)X
1507(for)X
1624(the)X
1746(destination.)X
2161(If)X
2239(a)X
2299(non-wildcard)X
2751(route)X
2940(exists)X
3146(to)X
3232(the)X
3354(destination,)X
3749(the)X
3871(gate-)X
576 2772(way)N
738(entry)X
931(in)X
1021(the)X
1147(route)X
1340(is)X
1421(modi\256ed)X
1733(to)X
1822(point)X
2013(at)X
2098(the)X
2223(new)X
2384(gateway)X
2679(supplied.)X
3017(Otherwise,)X
3394(a)X
3457(new)X
3618(routing)X
3876(table)X
576 2868(entry)N
762(is)X
837(inserted)X
1113(re\257ecting)X
1438(the)X
1558(information)X
1958(supplied.)X
2291(Routes)X
2535(to)X
2619(interfaces)X
2954(and)X
3092(routes)X
3310(to)X
3394(gateways)X
3715(which)X
3933(are)X
576 2964(not)N
698(directly)X
963(accessible)X
1309(from)X
1485(the)X
1603(host)X
1756(are)X
1875(ignored.)X
3 f
576 3156(10.3.)N
776(User)X
957(level)X
1133(routing)X
1406(policies)X
1 f
776 3280(Routing)N
1065(policies)X
1346(implemented)X
1796(in)X
1890(user)X
2056(processes)X
2396(manipulate)X
2784(the)X
2914(kernel)X
3147(routing)X
3410(tables)X
3630(through)X
3912(two)X
2 f
576 3376(ioctl)N
1 f
747(calls.)X
963(The)X
1117(commands)X
1493(SIOCADDRT)X
1980(and)X
2125(SIOCDELRT)X
2593(add)X
2737(and)X
2881(delete)X
3101(routing)X
3360(entries,)X
3622(respectively;)X
576 3472(the)N
696(tables)X
905(are)X
1026(read)X
1187(through)X
1458(the)X
1578(/dev/kmem)X
1960(device.)X
2232(The)X
2379(decision)X
2668(to)X
2753(place)X
2946(policy)X
3169(decisions)X
3490(in)X
3575(a)X
3634(user)X
3791(process)X
576 3568(implies)N
840(that)X
989(routing)X
1249(table)X
1434(updates)X
1708(may)X
1875(lag)X
2002(a)X
2067(bit)X
2180(behind)X
2427(the)X
2554(identi\256cation)X
3005(of)X
3100(new)X
3262(routes,)X
3506(or)X
3601(the)X
3727(failure)X
3965(of)X
576 3664(existing)N
850(routes,)X
1087(but)X
1210(this)X
1346(period)X
1572(of)X
1660(instability)X
2001(is)X
2076(normally)X
2387(very)X
2552(small)X
2747(with)X
2911(proper)X
3143(implementation)X
3667(of)X
3756(the)X
3876(rout-)X
576 3760(ing)N
706(process.)X
1015(Advisory)X
1341(information,)X
1767(such)X
1942(as)X
2037(ICMP)X
2259(error)X
2443(messages)X
2773(and)X
2916(IMP)X
3085(diagnostic)X
3441(messages,)X
3791(may)X
3956(be)X
576 3856(read)N
735(from)X
911(raw)X
1052(sockets)X
1308(\(described)X
1663(in)X
1745(the)X
1863(next)X
2021(section\).)X
776 3980(Several)N
1050(routing)X
1315(policy)X
1549(processes)X
1891(have)X
2077(already)X
2348(been)X
2534(implemented.)X
3026(The)X
3185(system)X
3441(standard)X
3747(``routing)X
576 4076(daemon'')N
911(uses)X
1075(a)X
1137(variant)X
1386(of)X
1479(the)X
1603(Xerox)X
1830(NS)X
1958(Routing)X
2241(Information)X
2650(Protocol)X
2947([Xerox82])X
3308(to)X
3396(maintain)X
3702(up-to-date)X
576 4172(routing)N
828(tables)X
1036(in)X
1119(our)X
1247(local)X
1424(environment.)X
1890(Interaction)X
2259(with)X
2422(other)X
2608(existing)X
2882(routing)X
3135(protocols,)X
3475(such)X
3644(as)X
3733(the)X
3853(Inter-)X
576 4268(net)N
694(EGP)X
865(\(Exterior)X
1175(Gateway)X
1481(Protocol\),)X
1819(has)X
1946(been)X
2118(accomplished)X
2579(using)X
2772(a)X
2828(similar)X
3070(process.)X
3 f
576 4460(11.)N
12 s
724(Raw)X
934(sockets)X
1 f
10 s
776 4584(A)N
861(raw)X
1009(socket)X
1241(is)X
1321(an)X
1424(object)X
1647(which)X
1870(allows)X
2106(users)X
2298(direct)X
2508(access)X
2741(to)X
2830(a)X
2893(lower-level)X
3286(protocol.)X
3621(Raw)X
3796(sockets)X
576 4680(are)N
711(intended)X
1023(for)X
1153(knowledgeable)X
1675(processes)X
2019(which)X
2250(wish)X
2436(to)X
2533(take)X
2702(advantage)X
3063(of)X
3165(some)X
3369(protocol)X
3671(feature)X
3930(not)X
576 4776(directly)N
841(accessible)X
1187(through)X
1456(the)X
1574(normal)X
1821(interface,)X
2143(or)X
2230(for)X
2344(the)X
2462(development)X
2896(of)X
2983(new)X
3137(protocols)X
3455(built)X
3621(atop)X
3779(existing)X
576 4872(lower)N
780(level)X
957(protocols.)X
1316(For)X
1448(example,)X
1761(a)X
1818(new)X
1973(version)X
2230(of)X
2318(TCP)X
2485(might)X
2692(be)X
2789(developed)X
3140(at)X
3218(the)X
3336(user)X
3490(level)X
3666(by)X
3766(utilizing)X
576 4968(a)N
634(raw)X
777(IP)X
870(socket)X
1097(for)X
1214(delivery)X
1500(of)X
1590(packets.)X
1894(The)X
2042(raw)X
2186(IP)X
2280(socket)X
2508(interface)X
2813(attempts)X
3107(to)X
3192(provide)X
3460(an)X
3559(identical)X
3858(inter-)X
576 5064(face)N
731(to)X
813(the)X
931(one)X
1067(a)X
1123(protocol)X
1410(would)X
1630(have)X
1802(if)X
1871(it)X
1935(were)X
2112(resident)X
2386(in)X
2468(the)X
2586(kernel.)X
776 5188(The)N
936(raw)X
1092(socket)X
1332(support)X
1607(is)X
1695(built)X
1876(around)X
2134(a)X
2205(generic)X
2477(raw)X
2633(socket)X
2873(interface,)X
3210(\(possibly\))X
3565(augmented)X
3952(by)X
576 5284(protocol-speci\256c)N
1135(processing)X
1498(routines.)X
1816(This)X
1978(section)X
2225(will)X
2369(describe)X
2657(the)X
2775(core)X
2934(of)X
3021(the)X
3139(raw)X
3280(socket)X
3505(interface.)X
3 f
576 5476(11.1.)N
776(Control)X
1063(blocks)X
1 f
776 5600(Every)N
988(raw)X
1129(socket)X
1354(has)X
1481(a)X
1537(protocol)X
1824(control)X
2071(block)X
2269(of)X
2356(the)X
2474(following)X
2805(form:)X

22 p
%%Page: 22 22
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-22)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
864 720(struct)N
1062(rawcb)X
1279({)X
1082 816(struct)N
1363(rawcb)X
1580(*rcb_next;)X
2113(/*)X
2195(doubly)X
2437(linked)X
2657(list)X
2774(*/)X
1082 912(struct)N
1363(rawcb)X
1580(*rcb_prev;)X
1082 1008(struct)N
1363(socket)X
1588(*rcb_socket;)X
2113(/*)X
2195(back)X
2367(pointer)X
2614(to)X
2696(socket)X
2921(*/)X
1082 1104(struct)N
1363(sockaddr)X
1673(rcb_faddr;)X
2113(/*)X
2195(destination)X
2566(address)X
2827(*/)X
1082 1200(struct)N
1363(sockaddr)X
1673(rcb_laddr;)X
2113(/*)X
2195(socket's)X
2478(address)X
2739(*/)X
1082 1296(struct)N
1363(sockproto)X
1699(rcb_proto;)X
2113(/*)X
2195(protocol)X
2482(family,)X
2731(protocol)X
3018(*/)X
1082 1392(caddr_t)N
1363(rcb_pcb;)X
2113(/*)X
2195(protocol)X
2482(speci\256c)X
2747(stuff)X
2914(*/)X
1082 1488(struct)N
1363(mbuf)X
1552(*rcb_options;)X
2113(/*)X
2195(protocol)X
2482(speci\256c)X
2747(options)X
3002(*/)X
1082 1584(struct)N
1363(route)X
1548(rcb_route;)X
2113(/*)X
2195(routing)X
2446(information)X
2844(*/)X
1082 1680(short)N
1363(rcb_\257ags;)X
864 1776(};)N
576 1920(All)N
711(the)X
842(control)X
1102(blocks)X
1344(are)X
1476(kept)X
1647(on)X
1760(a)X
1829(doubly)X
2084(linked)X
2317(list)X
2448(for)X
2576(performing)X
2971(lookups)X
3258(during)X
3501(packet)X
3745(dispatch.)X
576 2016(Associations)N
1010(may)X
1172(be)X
1272(recorded)X
1578(in)X
1664(the)X
1786(control)X
2037(block)X
2239(and)X
2379(used)X
2550(by)X
2654(the)X
2776(output)X
3004(routine)X
3255(in)X
3341(preparing)X
3673(packets)X
3938(for)X
576 2112(transmission.)N
1049(The)X
2 f
1203(rcb_proto)X
1 f
1552(structure)X
1862(contains)X
2158(the)X
2285(protocol)X
2581(family)X
2819(and)X
2964(protocol)X
3261(number)X
3536(with)X
3708(which)X
3934(the)X
576 2208(raw)N
719(socket)X
946(is)X
1021(associated.)X
1412(The)X
1558(protocol,)X
1866(family)X
2096(and)X
2233(addresses)X
2562(are)X
2682(used)X
2850(to)X
2933(\256lter)X
3105(packets)X
3367(on)X
3468(input;)X
3675(this)X
3811(will)X
3956(be)X
576 2304(described)N
906(in)X
991(more)X
1179(detail)X
1380(shortly.)X
1665(If)X
1742(any)X
1881(protocol-speci\256c)X
2443(information)X
2844(is)X
2920(required,)X
3231(it)X
3298(may)X
3459(be)X
3558(attached)X
3849(to)X
3934(the)X
576 2400(control)N
829(block)X
1033(using)X
1232(the)X
2 f
1356(rcb_pcb)X
1 f
1645(\256eld.)X
1853(Protocol-speci\256c)X
2422(options)X
2683(for)X
2803(transmission)X
3232(in)X
3319(outgoing)X
3628(packets)X
3894(may)X
576 2496(be)N
672(stored)X
888(in)X
2 f
970(rcb_options)X
1 f
1352(.)X
776 2620(A)N
860(raw)X
1007(socket)X
1238(interface)X
1546(is)X
1625(datagram)X
1950(oriented.)X
2279(That)X
2452(is,)X
2551(each)X
2725(send)X
2898(or)X
2991(receive)X
3250(on)X
3356(the)X
3480(socket)X
3711(requires)X
3996(a)X
576 2716(destination)N
951(address.)X
1256(This)X
1421(address)X
1685(may)X
1846(be)X
1945(supplied)X
2239(by)X
2342(the)X
2463(user)X
2620(or)X
2710(stored)X
2929(in)X
3014(the)X
3135(control)X
3385(block)X
3586(and)X
3725(automati-)X
576 2812(cally)N
752(installed)X
1043(in)X
1125(the)X
1243(outgoing)X
1547(packet)X
1777(by)X
1877(the)X
1995(output)X
2219(routine.)X
2507(Since)X
2706(it)X
2771(is)X
2845(not)X
2968(possible)X
3251(to)X
3334(determine)X
3676(whether)X
3956(an)X
576 2908(address)N
843(is)X
922(present)X
1180(or)X
1273(not)X
1401(in)X
1489(the)X
1613(control)X
1866(block,)X
2090(two)X
2235(\257ags,)X
2431(RAW_LADDR)X
2959(and)X
3100(RAW_FADDR,)X
3643(indicate)X
3922(if)X
3996(a)X
576 3004(local)N
758(and)X
900(foreign)X
1159(address)X
1427(are)X
1553(present.)X
1852(Routing)X
2136(is)X
2216(expected)X
2529(to)X
2618(be)X
2721(performed)X
3083(by)X
3190(the)X
3315(underlying)X
3689(protocol)X
3983(if)X
576 3100(necessary.)N
3 f
576 3292(11.2.)N
776(Input)X
986(processing)X
1 f
776 3416(Input)N
967(packets)X
1231(are)X
1353(``assigned'')X
1760(to)X
1845(raw)X
1989(sockets)X
2248(based)X
2454(on)X
2557(a)X
2616(simple)X
2852(pattern)X
3098(matching)X
3419(scheme.)X
3723(Each)X
3907(net-)X
576 3512(work)N
761(interface)X
1063(or)X
1150(protocol)X
1437(gives)X
1626(unassigned)X
2002(packets)X
2263(to)X
2345(the)X
2463(raw)X
2604(input)X
2788(routine)X
3035(with)X
3197(the)X
3315(call:)X
864 3656(raw_input\(m,)N
1318(proto,)X
1527(src,)X
1661(dst\))X
864 3752(struct)N
1062(mbuf)X
1251(*m;)X
1395(struct)X
1593(sockproto)X
1929(*proto,)X
2178(struct)X
2376(sockaddr)X
2686(*src,)X
2860(*dst;)X
576 3896(The)N
721(data)X
875(packet)X
1105(then)X
1263(has)X
1390(a)X
1446(generic)X
1703(header)X
1938(prepended)X
2293(to)X
2375(it)X
2439(of)X
2526(the)X
2644(form)X
864 4040(struct)N
1062(raw_header)X
1458({)X
1152 4136(struct)N
1584(sockproto)X
1920(raw_proto;)X
1152 4232(struct)N
1584(sockaddr)X
1894(raw_dst;)X
1152 4328(struct)N
1584(sockaddr)X
1894(raw_src;)X
864 4424(};)N
576 4568(and)N
714(it)X
780(is)X
855(placed)X
1087(in)X
1171(a)X
1229(packet)X
1461(queue)X
1675(for)X
1791(the)X
1911(``raw)X
2108(input)X
2294(protocol'')X
2637(module.)X
2939(Packets)X
3206(taken)X
3402(from)X
3580(this)X
3718(queue)X
3933(are)X
576 4664(copied)N
810(into)X
954(any)X
1090(raw)X
1231(sockets)X
1487(that)X
1627(match)X
1843(the)X
1961(header)X
2196(according)X
2533(to)X
2615(the)X
2733(following)X
3064(rules,)X
576 4788(1\))N
776(The)X
921(protocol)X
1208(family)X
1437(of)X
1524(the)X
1642(socket)X
1867(and)X
2003(header)X
2238(agree.)X
576 4912(2\))N
776(If)X
850(the)X
968(protocol)X
1255(number)X
1520(in)X
1602(the)X
1720(socket)X
1945(is)X
2018(non-zero,)X
2344(then)X
2502(it)X
2566(agrees)X
2792(with)X
2954(that)X
3094(found)X
3301(in)X
3383(the)X
3501(packet)X
3731(header.)X
576 5036(3\))N
776(If)X
853(a)X
912(local)X
1091(address)X
1355(is)X
1431(de\256ned)X
1690(for)X
1807(the)X
1928(socket,)X
2176(the)X
2297(address)X
2561(format)X
2798(of)X
2888(the)X
3010(local)X
3190(address)X
3455(is)X
3532(the)X
3654(same)X
3843(as)X
3934(the)X
776 5132(destination)N
1147(address's)X
1466(and)X
1602(the)X
1720(two)X
1860(addresses)X
2188(agree)X
2383(bit)X
2487(for)X
2601(bit.)X
576 5256(4\))N
776(The)X
921(rules)X
1097(of)X
1184(3\))X
1271(are)X
1390(applied)X
1646(to)X
1728(the)X
1846(socket's)X
2129(foreign)X
2381(address)X
2642(and)X
2778(the)X
2896(packet's)X
3184(source)X
3414(address.)X
576 5380(A)N
658(basic)X
847(assumption)X
1235(is)X
1312(that)X
1456(addresses)X
1788(present)X
2044(in)X
2130(the)X
2252(control)X
2503(block)X
2705(and)X
2845(packet)X
3079(header)X
3318(\(as)X
3436(constructed)X
3830(by)X
3934(the)X
576 5476(network)N
863(interface)X
1168(and)X
1307(any)X
1446(raw)X
1590(input)X
1777(protocol)X
2067(module\))X
2357(are)X
2479(in)X
2564(a)X
2623(canonical)X
2954(form)X
3133(which)X
3352(may)X
3513(be)X
3612(``block)X
3867(com-)X
576 5572(pared''.)N

23 p
%%Page: 23 23
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3637(SMM:18-23)X
3 f
576 672(11.3.)N
776(Output)X
1044(processing)X
1 f
776 796(On)N
899(output)X
1128(the)X
1251(raw)X
2 f
1397(pr_usrreq)X
1 f
1742(routine)X
1994(passes)X
2224(the)X
2347(packet)X
2582(and)X
2723(a)X
2784(pointer)X
3036(to)X
3123(the)X
3246(raw)X
3392(control)X
3644(block)X
3847(to)X
3934(the)X
576 892(raw)N
726(protocol)X
1022(output)X
1255(routine)X
1511(for)X
1634(any)X
1778(processing)X
2149(required)X
2445(before)X
2679(it)X
2751(is)X
2832(delivered)X
3159(to)X
3249(the)X
3375(appropriate)X
3769(network)X
576 988(interface.)N
918(The)X
1063(output)X
1287(routine)X
1534(is)X
1607(normally)X
1916(the)X
2034(only)X
2196(code)X
2368(required)X
2656(to)X
2738(implement)X
3100(a)X
3156(raw)X
3297(socket)X
3522(interface.)X
3 f
576 1180(12.)N
12 s
724(Buffering)X
1143(and)X
1321(congestion)X
1777(control)X
1 f
10 s
776 1304(One)N
938(of)X
1033(the)X
1159(major)X
1374(factors)X
1621(in)X
1711(the)X
1837(performance)X
2272(of)X
2367(a)X
2432(protocol)X
2728(is)X
2810(the)X
2937(buffering)X
3265(policy)X
3494(used.)X
3710(Lack)X
3900(of)X
3996(a)X
576 1400(proper)N
808(buffering)X
1129(policy)X
1351(can)X
1485(force)X
1673(packets)X
1936(to)X
2020(be)X
2118(dropped,)X
2423(cause)X
2624(falsi\256ed)X
2903(windowing)X
3284(information)X
3683(to)X
3766(be)X
3863(emit-)X
576 1496(ted)N
696(by)X
798(protocols,)X
1138(fragment)X
1450(host)X
1605(memory,)X
1914(degrade)X
2192(the)X
2313(overall)X
2559(host)X
2715(performance,)X
3165(etc.)X
3322(Due)X
3479(to)X
3564(problems)X
3885(such)X
576 1592(as)N
675(these,)X
892(most)X
1079(systems)X
1364(allocate)X
1646(a)X
1714(\256xed)X
1906(pool)X
2080(of)X
2179(memory)X
2478(to)X
2572(the)X
2702(networking)X
3099(system)X
3353(and)X
3501(impose)X
3764(a)X
3832(policy)X
576 1688(optimized)N
916(for)X
1030(``normal'')X
1385(network)X
1668(operation.)X
776 1812(The)N
928(networking)X
1320(system)X
1569(developed)X
1926(for)X
2047(UNIX)X
2275(is)X
2355(little)X
2528(different)X
2832(in)X
2921(this)X
3064(respect.)X
3360(At)X
3468(boot)X
3638(time)X
3808(a)X
3872(\256xed)X
576 1908(amount)N
846(of)X
943(memory)X
1240(is)X
1323(allocated)X
1643(by)X
1753(the)X
1880(networking)X
2274(system.)X
2565(At)X
2674(later)X
2846(times)X
3048(more)X
3242(system)X
3493(memory)X
3789(may)X
3956(be)X
576 2004(requested)N
904(as)X
991(the)X
1109(need)X
1281(arises,)X
1505(but)X
1628(at)X
1707(no)X
1808(time)X
1971(is)X
2045(memory)X
2333(ever)X
2493(returned)X
2782(to)X
2865(the)X
2984(system.)X
3267(It)X
3337(is)X
3411(possible)X
3694(to)X
3777(garbage)X
576 2100(collect)N
813(memory)X
1103(from)X
1282(the)X
1403(network,)X
1709(but)X
1834(dif\256cult.)X
2150(In)X
2240(order)X
2432(to)X
2516(perform)X
2797(this)X
2934(garbage)X
3211(collection)X
3549(properly,)X
3863(some)X
576 2196(portion)N
827(of)X
914(the)X
1032(network)X
1315(will)X
1459(have)X
1631(to)X
1713(be)X
1809(``turned)X
2088(off'')X
2256(as)X
2343(data)X
2497(structures)X
2829(are)X
2948(updated.)X
3262(The)X
3407(interval)X
3672(over)X
3836(which)X
576 2292(this)N
717(occurs)X
953(must)X
1134(kept)X
1297(small)X
1495(compared)X
1837(to)X
1924(the)X
2047(average)X
2323(inter-packet)X
2732(arrival)X
2967(time,)X
3154(or)X
3246(too)X
3373(much)X
3576(traf\256c)X
3793(may)X
3956(be)X
576 2388(lost,)N
735(impacting)X
1079(other)X
1268(hosts)X
1456(on)X
1560(the)X
1682(network,)X
1990(as)X
2082(well)X
2245(as)X
2337(increasing)X
2692(load)X
2855(on)X
2960(the)X
3083(interconnecting)X
3607(mediums.)X
3965(In)X
576 2484(our)N
715(environment)X
1152(we)X
1278(have)X
1462(not)X
1596(experienced)X
2017(a)X
2085(need)X
2269(for)X
2395(such)X
2574(compaction,)X
3000(and)X
3148(thus)X
3313(have)X
3497(left)X
3636(the)X
3765(problem)X
576 2580(unresolved.)N
776 2704(The)N
926(mbuf)X
1120(structure)X
1426(was)X
1576(introduced)X
1944(in)X
2031(chapter)X
2294(5.)X
2400(In)X
2493(this)X
2634(section)X
2887(a)X
2949(brief)X
3127(description)X
3509(will)X
3659(be)X
3761(given)X
3965(of)X
576 2800(the)N
694(allocation)X
1030(mechanisms,)X
1466(and)X
1602(policies)X
1871(used)X
2038(by)X
2138(the)X
2256(protocols)X
2574(in)X
2656(performing)X
3037(connection)X
3409(level)X
3585(buffering.)X
3 f
576 2992(12.1.)N
776(Memory)X
1091(management)X
1 f
776 3116(The)N
925(basic)X
1114(memory)X
1405(allocation)X
1745(routines)X
2027(manage)X
2302(a)X
2363(private)X
2611(page)X
2788(map,)X
2971(the)X
3094(size)X
3244(of)X
3336(which)X
3557(determines)X
3934(the)X
576 3212(maximum)N
927(amount)X
1194(of)X
1288(memory)X
1582(that)X
1729(may)X
1894(be)X
1996(allocated)X
2312(by)X
2418(the)X
2542(network.)X
2871(A)X
2955(small)X
3154(amount)X
3420(of)X
3513(memory)X
3806(is)X
3885(allo-)X
576 3308(cated)N
767(at)X
846(boot)X
1009(time)X
1172(to)X
1255(initialize)X
1556(the)X
1675(mbuf)X
1865(and)X
2002(mbuf)X
2192(page)X
2365(cluster)X
2600(free)X
2748(lists.)X
2938(When)X
3152(the)X
3272(free)X
3420(lists)X
3570(are)X
3691(exhausted,)X
576 3404(more)N
763(memory)X
1052(is)X
1126(requested)X
1455(from)X
1632(the)X
1751(system)X
1994(memory)X
2282(allocator)X
2584(if)X
2654(space)X
2854(remains)X
3129(in)X
3212(the)X
3331(map.)X
3530(If)X
3605(memory)X
3893(can-)X
576 3500(not)N
710(be)X
818(allocated,)X
1160(callers)X
1402(may)X
1572(block)X
1782(awaiting)X
2090(free)X
2248(memory,)X
2567(or)X
2666(the)X
2796(failure)X
3038(may)X
3208(be)X
3317(re\257ected)X
3627(to)X
3722(the)X
3853(caller)X
576 3596(immediately.)N
1043(The)X
1195(allocator)X
1503(will)X
1654(not)X
1783(block)X
1988(awaiting)X
2291(free)X
2444(map)X
2609(entries,)X
2870(however,)X
3194(as)X
3288(exhaustion)X
3662(of)X
3756(the)X
3880(page)X
576 3692(map)N
740(usually)X
997(indicates)X
1308(that)X
1454(buffers)X
1708(have)X
1886(been)X
2064(lost)X
2205(due)X
2348(to)X
2437(a)X
2500(``leak.'')X
2809(The)X
2961(private)X
3211(page)X
3390(table)X
3573(is)X
3653(used)X
3827(by)X
3934(the)X
576 3788(network)N
864(buffer)X
1086(management)X
1521(routines)X
1804(in)X
1890(remapping)X
2257(pages)X
2464(to)X
2550(be)X
2650(logically)X
2954(contiguous)X
3329(as)X
3420(the)X
3542(need)X
3718(arises.)X
3965(In)X
576 3884(addition,)N
886(an)X
990(array)X
1185(of)X
1281 0.4531(reference)AX
1611(counts)X
1849(parallels)X
2150(the)X
2277(page)X
2458(table)X
2643(and)X
2788(is)X
2870(used)X
3046(when)X
3249(multiple)X
3544 0.3889(references)AX
3905(to)X
3996(a)X
576 3980(page)N
748(are)X
867(present.)X
776 4104(Mbufs)N
1007(are)X
1128(128)X
1270(byte)X
1430(structures,)X
1784(8)X
1846(\256tting)X
2058(in)X
2142(a)X
2200(1Kbyte)X
2458(page)X
2632(of)X
2721(memory.)X
3050(When)X
3264(data)X
3420(is)X
3495(placed)X
3727(in)X
3812(mbufs,)X
576 4200(it)N
641(is)X
715(copied)X
950(or)X
1038(remapped)X
1376(into)X
1521(logically)X
1822(contiguous)X
2193(pages)X
2396(of)X
2483(memory)X
2770(from)X
2946(the)X
3064(network)X
3347(page)X
3519(pool)X
3681(if)X
3750(possible.)X
576 4296(Data)N
748(smaller)X
1004(than)X
1162(half)X
1307(of)X
1394(the)X
1512(size)X
1657(of)X
1744(a)X
1800(page)X
1972(is)X
2045(copied)X
2279(into)X
2423(one)X
2559(or)X
2646(more)X
2831(112)X
2971(byte)X
3129(mbuf)X
3318(data)X
3472(areas.)X
3 f
576 4488(12.2.)N
776(Protocol)X
1086(buffering)X
1426(policies)X
1 f
776 4612(Protocols)N
1108(reserve)X
1371(\256xed)X
1561(amounts)X
1862(of)X
1959(buffering)X
2288(for)X
2412(send)X
2590(and)X
2737(receive)X
3001(queues)X
3255(at)X
3344(socket)X
3580(creation)X
3870(time.)X
576 4708(These)N
791(amounts)X
1085(de\256ne)X
1304(the)X
1425(high)X
1590(and)X
1729(low)X
1872(water)X
2074(marks)X
2293(used)X
2463(by)X
2565(the)X
2685(socket)X
2912(routines)X
3192(in)X
3276(deciding)X
3574(when)X
3770(to)X
3854(block)X
576 4804(and)N
721(unblock)X
1008(a)X
1073(process.)X
1383(The)X
1537(reservation)X
1923(of)X
2019(space)X
2227(does)X
2403(not)X
2535(currently)X
2855(result)X
3063(in)X
3155(any)X
3301(action)X
3527(by)X
3637(the)X
3765(memory)X
576 4900(management)N
1006(routines.)X
776 5024(Protocols)N
1105(which)X
1328(provide)X
1600(connection)X
1979(level)X
2162(\257ow)X
2331(control)X
2585(do)X
2692(this)X
2834(based)X
3044(on)X
3151(the)X
3276(amount)X
3543(of)X
3637(space)X
3844(in)X
3934(the)X
576 5120(associated)N
933(socket)X
1165(queues.)X
1454(That)X
1627(is,)X
1726(send)X
1899(windows)X
2214(are)X
2339(calculated)X
2691(based)X
2900(on)X
3006(the)X
3130(amount)X
3396(of)X
3489(free)X
3641(space)X
3846(in)X
3934(the)X
576 5216(socket's)N
859(receive)X
1112(queue,)X
1344(while)X
1542(receive)X
1795(windows)X
2104(are)X
2223(adjusted)X
2510(based)X
2713(on)X
2814(the)X
2933(amount)X
3194(of)X
3282(data)X
3437(awaiting)X
3734(transmis-)X
576 5312(sion)N
731(in)X
815(the)X
935(send)X
1103(queue.)X
1356(Care)X
1529(has)X
1657(been)X
1830(taken)X
2025(to)X
2108(avoid)X
2307(the)X
2426(``silly)X
2638(window)X
2917(syndrome'')X
3308(described)X
3637(in)X
3720([Clark82])X
576 5408(at)N
654(both)X
816(the)X
934(sending)X
1203(and)X
1339(receiving)X
1658(ends.)X

24 p
%%Page: 24 24
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-24)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
3 f
576 672(12.3.)N
776(Queue)X
1018(limiting)X
1 f
776 796(Incoming)N
1109(packets)X
1376(from)X
1558(the)X
1682(network)X
1972(are)X
2098(always)X
2348(received)X
2648(unless)X
2875(memory)X
3169(allocation)X
3512(fails.)X
3717(However,)X
576 892(each)N
751(Level)X
961(1)X
1028(protocol)X
1322(input)X
1513(queue)X
1732(has)X
1866(an)X
1968(upper)X
2177(bound)X
2403(on)X
2509(the)X
2633(queue's)X
2909(length,)X
3155(and)X
3297(any)X
3439(packets)X
3706(exceeding)X
576 988(that)N
726(bound)X
956(are)X
1085(discarded.)X
1463(It)X
1543(is)X
1627(possible)X
1920(for)X
2045(a)X
2112(host)X
2276(to)X
2369(be)X
2476(overwhelmed)X
2944(by)X
3055(excessive)X
3394(network)X
3688(traf\256c)X
3911(\(for)X
576 1084(instance)N
868(a)X
933(host)X
1095(acting)X
1320(as)X
1416(a)X
1481(gateway)X
1778(from)X
1962(a)X
2026(high)X
2196(bandwidth)X
2562(network)X
2853(to)X
2943(a)X
3007(low)X
3155(bandwidth)X
3521(network\).)X
3879(As)X
3996(a)X
576 1180(``defensive'')N
1016(mechanism)X
1405(the)X
1527(queue)X
1743(limits)X
1948(may)X
2110(be)X
2210(adjusted)X
2501(to)X
2587(throttle)X
2842(network)X
3129(traf\256c)X
3345(load)X
3508(on)X
3613(a)X
3674(host.)X
3872(Con-)X
576 1276(sider)N
753(a)X
810(host)X
964(willing)X
1211(to)X
1294(devote)X
1529(some)X
1719(percentage)X
2089(of)X
2177(its)X
2272(machine)X
2564(to)X
2646(handling)X
2946(network)X
3229(traf\256c.)X
3461(If)X
3535(the)X
3653(cost)X
3802(of)X
3889(han-)X
576 1372(dling)N
770(an)X
876(incoming)X
1208(packet)X
1448(can)X
1590(be)X
1696(calculated)X
2052(so)X
2153(that)X
2304(an)X
2411(acceptable)X
2782(``packet)X
3077(handling)X
3388(rate'')X
3594(can)X
3737(be)X
3844(deter-)X
576 1468(mined,)N
830(then)X
1001(input)X
1198(queue)X
1423(lengths)X
1687(may)X
1858(be)X
1967(dynamically)X
2396(adjusted)X
2696(based)X
2912(on)X
3025(a)X
3094(host's)X
3318(network)X
3614(load)X
3785(and)X
3934(the)X
576 1564(number)N
849(of)X
944(packets)X
1213(awaiting)X
1517(processing.)X
1928(Obviously,)X
2309(discarding)X
2672(packets)X
2942(is)X
3024(not)X
3155(a)X
3220(satisfactory)X
3619(solution)X
3905(to)X
3996(a)X
576 1660(problem)N
877(such)X
1058(as)X
1159(this)X
1308(\(simply)X
1586(dropping)X
1909(packets)X
2184(is)X
2271(likely)X
2487(to)X
2583(increase)X
2880(the)X
3011(load)X
3182(on)X
3295(a)X
3364(network\);)X
3709(the)X
3840(queue)X
576 1756(lengths)N
827(were)X
1004(incorporated)X
1430(mainly)X
1672(as)X
1759(a)X
1815(safeguard)X
2148(mechanism.)X
3 f
576 1948(12.4.)N
776(Packet)X
1028(forwarding)X
1 f
776 2072(When)N
991(packets)X
1255(can)X
1390(not)X
1515(be)X
1614(forwarded)X
1968(because)X
2246(of)X
2336(memory)X
2626(limitations,)X
3010(the)X
3132(system)X
3378(attempts)X
3673(to)X
3759(generate)X
576 2168(a)N
640(``source)X
932(quench'')X
1246(message.)X
1586(In)X
1681(addition,)X
1991(any)X
2135(other)X
2328(problems)X
2654(encountered)X
3075(during)X
3312(packet)X
3549(forwarding)X
3933(are)X
576 2264(also)N
725(re\257ected)X
1022(back)X
1194(to)X
1276(the)X
1394(sender)X
1624(in)X
1706(the)X
1824(form)X
2000(of)X
2087(ICMP)X
2303(packets.)X
2605(This)X
2768(helps)X
2958(hosts)X
3143(avoid)X
3342(unneeded)X
3671(retransmis-)X
576 2360(sions.)N
776 2484(Broadcast)N
1122(packets)X
1388(are)X
1512(never)X
1716(forwarded)X
2072(due)X
2213(to)X
2300(possible)X
2587(dire)X
2737(consequences.)X
3244(In)X
3336(an)X
3437(early)X
3623(stage)X
3814(of)X
3907(net-)X
576 2580(work)N
764(development,)X
1221(broadcast)X
1552(packets)X
1816(were)X
1996(forwarded)X
2350(and)X
2488(a)X
2546(``routing)X
2853(loop'')X
3071(resulted)X
3347(in)X
3431(network)X
3716(saturation)X
576 2676(and)N
712(every)X
911(host)X
1064(on)X
1164(the)X
1282(network)X
1565(crashing.)X
3 f
576 2868(13.)N
12 s
724(Out)X
908(of)X
1012(band)X
1243(data)X
1 f
10 s
776 2992(Out)N
928(of)X
1027(band)X
1215(data)X
1381(is)X
1466(a)X
1534(facility)X
1794(peculiar)X
2086(to)X
2181(the)X
2312(stream)X
2559(socket)X
2797(abstraction)X
3182(de\256ned.)X
3491(Little)X
3697(agreement)X
576 3088(appears)N
851(to)X
942(exist)X
1122(as)X
1217(to)X
1307(what)X
1491(its)X
1594(semantics)X
1938(should)X
2179(be.)X
2323(TCP)X
2497(de\256nes)X
2752(the)X
2878(notion)X
3110(of)X
3205(``urgent)X
3492(data'')X
3708(as)X
3803(in-line,)X
576 3184(while)N
774(the)X
892(NBS)X
1067(protocols)X
1386([Burruss81])X
1790(and)X
1927(numerous)X
2264(others)X
2481(provide)X
2747(a)X
2804(fully)X
2976(independent)X
3389(logical)X
3628(transmission)X
576 3280(channel)N
850(along)X
1052(which)X
1272(out)X
1398(of)X
1489(band)X
1668(data)X
1825(is)X
1901(to)X
1986(be)X
2085(sent.)X
2277(In)X
2367(addition,)X
2672(the)X
2793(amount)X
3056(of)X
3146(the)X
3267(data)X
3424(which)X
3643(may)X
3804(be)X
3903(sent)X
576 3376(as)N
663(an)X
759(out)X
881(of)X
968(band)X
1144(message)X
1436(varies)X
1648(from)X
1824(protocol)X
2111(to)X
2193(protocol;)X
2502(everything)X
2865(from)X
3041(1)X
3101(bit)X
3205(to)X
3287(16)X
3387(bytes)X
3576(or)X
3663(more.)X
776 3500(A)N
865(stream)X
1110(socket's)X
1404(notion)X
1639(of)X
1737(out)X
1870(of)X
1968(band)X
2155(data)X
2320(has)X
2458(been)X
2641(de\256ned)X
2908(as)X
3006(the)X
3135(lowest)X
3376(reasonable)X
3752(common)X
576 3596(denominator)N
1017(\(at)X
1138(least)X
1321(reasonable)X
1701(in)X
1799(our)X
1942(minds\);)X
2222(clearly)X
2477(this)X
2628(is)X
2717(subject)X
2980(to)X
3077(debate.)X
3362(Out)X
3517(of)X
3619(band)X
3810(data)X
3979(is)X
576 3692(expected)N
884(to)X
968(be)X
1066(transmitted)X
1448(out)X
1572(of)X
1661(the)X
1781(normal)X
2030(sequencing)X
2413(and)X
2551(\257ow)X
2715(control)X
2964(constraints)X
3333(of)X
3422(the)X
3542(data)X
3698(stream.)X
3974(A)X
576 3788(minimum)N
912(of)X
1005(1)X
1071(byte)X
1235(of)X
1328(out)X
1456(of)X
1549(band)X
1731(data)X
1891(and)X
2033(one)X
2175(outstanding)X
2574(out)X
2701(of)X
2793(band)X
2974(message)X
3271(are)X
3395(expected)X
3706(to)X
3793(be)X
3894(sup-)X
576 3884(ported)N
811(by)X
921(the)X
1049(protocol)X
1346(supporting)X
1718(a)X
1784(stream)X
2028(socket.)X
2304(It)X
2384(is)X
2468(a)X
2535(protocol's)X
2891(prerogative)X
3288(to)X
3381(support)X
3652(larger-sized)X
576 3980(messages,)N
919(or)X
1006(more)X
1191(than)X
1349(one)X
1485(outstanding)X
1878(out)X
2000(of)X
2087(band)X
2263(message)X
2555(at)X
2633(a)X
2689(time.)X
776 4104(Out)N
929(of)X
1029(band)X
1218(data)X
1385(is)X
1471(maintained)X
1860(by)X
1973(the)X
2105(protocol)X
2406(and)X
2556(is)X
2643(usually)X
2908(not)X
3044(stored)X
3274(in)X
3370(the)X
3502(socket's)X
3799(receive)X
576 4200(queue.)N
833(A)X
916(socket-level)X
1329(option,)X
1578(SO_OOBINLINE,)X
2202(is)X
2280(provided)X
2590(to)X
2677(force)X
2867(out-of-band)X
3270(data)X
3428(to)X
3514(be)X
3614(placed)X
3848(in)X
3934(the)X
576 4296(normal)N
831(receive)X
1092(queue)X
1312(when)X
1514(urgent)X
1747(data)X
1909(is)X
1990(received;)X
2313(this)X
2457(sometimes)X
2828(amelioriates)X
3249(problems)X
3576(due)X
3721(to)X
3812(loss)X
3965(of)X
576 4392(data)N
740(when)X
944(multiple)X
1240(out-of-band)X
1649(segments)X
1977(are)X
2106(received)X
2409(before)X
2645(the)X
2773(\256rst)X
2926(has)X
3062(been)X
3243(passed)X
3486(to)X
3577(the)X
3704(user.)X
3907(The)X
576 4488(PRU_SENDOOB)N
1171(and)X
1309(PRU_RCVOOB)X
1860(requests)X
2146(to)X
2231(the)X
2 f
2352(pr_usrreq)X
1 f
2695(routine)X
2945(are)X
3067(used)X
3237(in)X
3322(sending)X
3594(and)X
3733(receiving)X
576 4584(data.)N
3 f
576 4776(14.)N
12 s
724(Trailer)X
1043(protocols)X
1 f
10 s
776 4900(Core)N
956(to)X
1042(core)X
1205(copies)X
1434(can)X
1570(be)X
1670(expensive.)X
2055(Consequently,)X
2539(a)X
2599(great)X
2784(deal)X
2942(of)X
3033(effort)X
3236(was)X
3385(spent)X
3578(in)X
3664(minimizing)X
576 4996(such)N
744(operations.)X
1139(The)X
1285(VAX)X
1480(architecture)X
1881(provides)X
2178(virtual)X
2408(memory)X
2696(hardware)X
3017(organized)X
3355(in)X
3438(page)X
3610(units.)X
3825(To)X
3934(cut)X
576 5092(down)N
779(on)X
884(copy)X
1065(operations,)X
1444(data)X
1604(is)X
1683(kept)X
1847(in)X
1935(page-sized)X
2305(units)X
2486(on)X
2592(page-aligned)X
3033(boundaries)X
3411(whenever)X
3750(possible.)X
576 5188(This)N
740(allows)X
971(data)X
1127(to)X
1211(be)X
1309(moved)X
1549(in)X
1633(memory)X
1922(simply)X
2161(by)X
2263(remapping)X
2628(the)X
2748(page)X
2922(instead)X
3171(of)X
3260(copying.)X
3580(The)X
3726(mbuf)X
3916(and)X
576 5284(network)N
863(interface)X
1169(routines)X
1451(perform)X
1734(page)X
1910(table)X
2090(manipulations)X
2567(where)X
2788(needed,)X
3060(hiding)X
3288(the)X
3410(complexities)X
3843(of)X
3934(the)X
576 5380(VAX)N
770(virtual)X
999(memory)X
1286(hardware)X
1606(from)X
1782(higher)X
2007(level)X
2183(code.)X
776 5504(Data)N
950(enters)X
1164(the)X
1284(system)X
1528(in)X
1612(two)X
1755(ways:)X
1965(from)X
2144(the)X
2265(user,)X
2442(or)X
2532(from)X
2711(the)X
2832(network)X
3118(\(hardware)X
3468(interface\).)X
3840(When)X
576 5600(data)N
739(is)X
821(copied)X
1064(from)X
1248(the)X
1374(user's)X
1594(address)X
1863(space)X
2070(into)X
2222(the)X
2348(system)X
2598(it)X
2670(is)X
2751(deposited)X
3086(in)X
3176(pages)X
3387(\(if)X
3491(suf\256cient)X
3817(data)X
3979(is)X
576 5696(present\).)N
898(This)X
1063(encourages)X
1448(the)X
1569(user)X
1726(to)X
1811(transmit)X
2096(information)X
2497(in)X
2582(messages)X
2908(which)X
3127(are)X
3249(a)X
3308(multiple)X
3597(of)X
3688(the)X
3810(system)X
576 5792(page)N
748(size.)X

25 p
%%Page: 25 25
10 s 10 xH 0 xS 1 f 1 i
576 384(Networking)N
979(Implementation)X
1506(Notes)X
3637(SMM:18-25)X
776 672(Unfortunately,)N
1274(performing)X
1663(a)X
1727(similar)X
1977(operation)X
2308(when)X
2510(taking)X
2738(data)X
2901(from)X
3086(the)X
3213(network)X
3505(is)X
3587(very)X
3759(dif\256cult.)X
576 768(Consider)N
888(the)X
1009(format)X
1246(of)X
1336(an)X
1435(incoming)X
1760(packet.)X
2033(A)X
2113(packet)X
2345(usually)X
2598(contains)X
2887(a)X
2945(local)X
3123(network)X
3408(header)X
3645(followed)X
3952(by)X
576 864(one)N
712(or)X
799(more)X
984(headers)X
1250(used)X
1417(by)X
1517(the)X
1635(high)X
1797(level)X
1973(protocols.)X
2312(Finally,)X
2579(the)X
2698(data,)X
2873(if)X
2943(any,)X
3100(follows)X
3361(these)X
3547(headers.)X
3854(Since)X
576 960(the)N
697(header)X
935(information)X
1336(may)X
1497(be)X
1595(variable)X
1876(length,)X
2118(DMA'ing)X
2456(the)X
2576(eventual)X
2870(data)X
3026(for)X
3142(the)X
3262(user)X
3418(into)X
3564(a)X
3622(page)X
3796(aligned)X
576 1056(area)N
736(of)X
828(memory)X
1120(is)X
1198(impossible)X
1569(without)X
2 f
1838(a)X
1903(priori)X
1 f
2114(knowledge)X
2491(of)X
2584(the)X
2708(format)X
2948(\(e.g.,)X
3137(by)X
3243(supporting)X
3611(only)X
3779(a)X
3841(single)X
576 1152(protocol)N
863(header)X
1098(format\).)X
776 1276(To)N
889(allow)X
1091(variable)X
1374(length)X
1598(header)X
1837(information)X
2239(to)X
2325(be)X
2426(present)X
2683(and)X
2824(still)X
2968(ensure)X
3203(page)X
3380(alignment)X
3725(of)X
3817(data,)X
3996(a)X
576 1372(special)N
820(local)X
997(network)X
1280(encapsulation)X
1741(may)X
1899(be)X
1995(used.)X
2202(This)X
2364(encapsulation,)X
2845(termed)X
3088(a)X
2 f
3144(trailer)X
3368(protocol)X
1 f
3659([Lef\257er84],)X
576 1468(places)N
809(the)X
939(variable)X
1230(length)X
1462(header)X
1709(information)X
2119(after)X
2299(the)X
2429(data.)X
2635(A)X
2725(\256xed)X
2917(size)X
3075(local)X
3264(network)X
3560(header)X
3808(is)X
3894(then)X
576 1564(prepended)N
932(to)X
1015(the)X
1134(resultant)X
1431(packet.)X
1682(The)X
1827(local)X
2003(network)X
2286(header)X
2521(contains)X
2808(the)X
2926(size)X
3071(of)X
3158(the)X
3276(data)X
3430(portion)X
3681(\(in)X
3790(units)X
3965(of)X
576 1660(512)N
718(bytes\),)X
956(and)X
1094(a)X
1152(new)X
2 f
1308(trailer)X
1534(protocol)X
1827(header)X
1 f
2050(,)X
2092(inserted)X
2368(before)X
2597(the)X
2718(variable)X
3000(length)X
3223(information,)X
3644(contains)X
3934(the)X
576 1756(size)N
724(of)X
814(the)X
935(variable)X
1217(length)X
1440(header)X
1678(information.)X
2119(The)X
2267(following)X
2601(trailer)X
2816(protocol)X
3106(header)X
3343(is)X
3418(used)X
3587(to)X
3671(store)X
3849(infor-)X
576 1852(mation)N
818(regarding)X
1146(the)X
1264(variable)X
1543(length)X
1763(protocol)X
2050(header:)X
864 1996(struct)N
1062({)X
1152 2092(short)N
1584(protocol;)X
2304(/*)X
2386(original)X
2655(protocol)X
2942(no.)X
3062(*/)X
1152 2188(short)N
1584(length;)X
2304(/*)X
2386(length)X
2606(of)X
2693(trailer)X
2905(*/)X
864 2284(};)N
776 2456(The)N
926(processing)X
1294(of)X
1386(the)X
1509(trailer)X
1726(protocol)X
2018(is)X
2096(very)X
2264(simple.)X
2542(On)X
2665(output,)X
2914(the)X
3037(local)X
3218(network)X
3506(header)X
3747(indicates)X
576 2552(that)N
726(a)X
792(trailer)X
1014(encapsulation)X
1485(is)X
1568(being)X
1776(used.)X
1993(The)X
2148(header)X
2393(also)X
2552(includes)X
2849(an)X
2955(indication)X
3305(of)X
3401(the)X
3528(number)X
3802(of)X
3898(data)X
576 2648(pages)N
789(present)X
1051(before)X
1287(the)X
1415(trailer)X
1637(protocol)X
1934(header.)X
2219(The)X
2374(trailer)X
2596(protocol)X
2893(header)X
3139(is)X
3223(initialized)X
3574(to)X
3667(contain)X
3934(the)X
576 2744(actual)N
797(protocol)X
1093(identi\256er)X
1411(and)X
1556(the)X
1683(variable)X
1971(length)X
2200(header)X
2444(size,)X
2618(and)X
2763(is)X
2844(appended)X
3180(to)X
3270(the)X
3396(data)X
3558(along)X
3764(with)X
3934(the)X
576 2840(variable)N
855(length)X
1075(header)X
1310(information.)X
776 2964(On)N
901(input,)X
1112(the)X
1237(interface)X
1547(routines)X
1833(identify)X
2110(the)X
2236(trailer)X
2456(encapsulation)X
2925(by)X
3033(the)X
3159(protocol)X
3454(type)X
3620(stored)X
3844(in)X
3934(the)X
576 3060(local)N
759(network)X
1049(header,)X
1311(then)X
1476(calculate)X
1789(the)X
1914(number)X
2186(of)X
2280(pages)X
2490(of)X
2584(data)X
2744(to)X
2832(\256nd)X
2982(the)X
3106(beginning)X
3452(of)X
3545(the)X
3669(trailer.)X
3907(The)X
576 3156(trailing)N
827(information)X
1225(is)X
1298(copied)X
1532(into)X
1676(a)X
1732(separate)X
2016(mbuf)X
2205(and)X
2341(linked)X
2561(to)X
2643(the)X
2761(front)X
2937(of)X
3024(the)X
3142(resultant)X
3438(packet.)X
776 3280(Clearly,)N
1059(trailer)X
1278(protocols)X
1603(require)X
1858(cooperation)X
2265(between)X
2561(source)X
2799(and)X
2943(destination.)X
3362(In)X
3457(addition,)X
3767(they)X
3933(are)X
576 3376(normally)N
892(cost)X
1047(effective)X
1355(only)X
1523(when)X
1723(sizable)X
1972(packets)X
2239(are)X
2364(used.)X
2577(The)X
2728(current)X
2982(scheme)X
3249(works)X
3471(because)X
3752(the)X
3876(local)X
576 3472(network)N
862(encapsulation)X
1326(header)X
1564(is)X
1640(a)X
1699(\256xed)X
1882(size,)X
2050(allowing)X
2353(DMA)X
2563(operations)X
2920(to)X
3006(be)X
3106(performed)X
3465(at)X
3547(a)X
3607(known)X
3849(offset)X
576 3568(from)N
761(the)X
888(\256rst)X
1041(data)X
1204(page)X
1384(being)X
1590(received.)X
1931(Should)X
2185(the)X
2311(local)X
2495(network)X
2786(header)X
3029(be)X
3133(variable)X
3420(length)X
3648(this)X
3791(scheme)X
576 3664(fails.)N
776 3788(Statistics)N
1090(collected)X
1406(indicate)X
1686(that)X
1833(as)X
1927(much)X
2132(as)X
2226(200Kb/s)X
2524(can)X
2663(be)X
2766(gained)X
3007(by)X
3114(using)X
3314(a)X
3377(trailer)X
3596(protocol)X
3890(with)X
576 3884(1Kbyte)N
833(packets.)X
1135(The)X
1281(average)X
1553(size)X
1699(of)X
1787(the)X
1906(variable)X
2185(length)X
2405(header)X
2640(was)X
2785(40)X
2885(bytes)X
3074(\(the)X
3219(size)X
3364(of)X
3451(a)X
3507(minimal)X
3793(TCP/IP)X
576 3980(packet)N
806(header\).)X
1108(If)X
1182(hardware)X
1502(supports)X
1793(larger)X
2001(sized)X
2186(packets,)X
2467(even)X
2639(greater)X
2883(gains)X
3072(may)X
3230(be)X
3326(realized.)X
3 f
12 s
576 4172(Acknowledgements)N
1 f
10 s
776 4296(The)N
926(internal)X
1196(structure)X
1502(of)X
1594(the)X
1717(system)X
1964(is)X
2042(patterned)X
2367(after)X
2541(the)X
2665(Xerox)X
2892(PUP)X
3064(architecture)X
3470([Boggs79],)X
3854(while)X
576 4392(in)N
666(certain)X
913(places)X
1142(the)X
1268(Internet)X
1546(protocol)X
1841(family)X
2078(has)X
2213(had)X
2357(a)X
2421(great)X
2610(deal)X
2772(of)X
2867(in\257uence)X
3189(in)X
3278(the)X
3403(design.)X
3679(The)X
3831(use)X
3965(of)X
576 4488(software)N
874(interrupts)X
1202(for)X
1317(process)X
1579(invocation)X
1938(is)X
2012(based)X
2216(on)X
2317(similar)X
2560(facilities)X
2857(found)X
3066(in)X
3150(the)X
3270(VMS)X
3465(operating)X
3790(system.)X
576 4584(Many)N
788(of)X
880(the)X
1003(ideas)X
1193(related)X
1437(to)X
1524(protocol)X
1816(modularity,)X
2212(memory)X
2504(management,)X
2959(and)X
3100(network)X
3388(interfaces)X
3726(are)X
3849(based)X
576 4680(on)N
688(Rob)X
854(Gurwitz's)X
1208(TCP/IP)X
1480(implementation)X
2015(for)X
2142(the)X
2273(4.1BSD)X
2561(version)X
2830(of)X
2930(UNIX)X
3164(on)X
3277(the)X
3408(VAX)X
3615([Gurwitz81].)X
576 4776(Greg)N
757(Chesson)X
1048(explained)X
1380(his)X
1493(use)X
1620(of)X
1707(trailer)X
1919(encapsulations)X
2411(in)X
2493(Datakit,)X
2769(instigating)X
3126(their)X
3293(use)X
3420(in)X
3502(our)X
3629(system.)X

26 p
%%Page: 26 26
10 s 10 xH 0 xS 1 f 1 i
576 384(SMM:18-26)N
2915(Networking)X
3318(Implementation)X
3845(Notes)X
3 f
12 s
576 672(References)N
1 f
10 s
576 824([Boggs79])N
1376(Boggs,)X
1623(D.)X
1724(R.,)X
1840(J.)X
1914(F.)X
2001(Shoch,)X
2244(E.)X
2336(A.)X
2437(Taft,)X
2614(and)X
2754(R.)X
2851(M.)X
2966(Metcalfe;)X
2 f
3298(PUP:)X
3505(An)X
3618(Internetwork)X
1376 920(Architecture)N
1 f
1777(.)X
1837(Report)X
2075(CSL-79-10.)X
2495(XEROX)X
2791(Palo)X
2953(Alto)X
3115(Research)X
3430(Center,)X
3684(July)X
3837(1979.)X
576 1044([BBN78])N
1376(Bolt)X
1550(Beranek)X
1855(and)X
2008(Newman;)X
2357(Speci\256cation)X
2812(for)X
2944(the)X
3080(Interconnection)X
3622(of)X
3727(Host)X
3916(and)X
1376 1140(IMP.)N
1578(BBN)X
1762(Technical)X
2099(Report)X
2337(1822.)X
2557(May)X
2724(1978.)X
576 1264([Cerf78])N
1376(Cerf,)X
1569(V.)X
1677(G.;)X
1827(The)X
1982(Catenet)X
2257(Model)X
2497(for)X
2622(Internetworking.)X
3210(Internet)X
3491(Working)X
3807(Group,)X
1376 1360(IEN)N
1530(48.)X
1670(July)X
1823(1978.)X
576 1484([Clark82])N
1376(Clark,)X
1602(D.)X
1708(D.;)X
1856(Window)X
2161(and)X
2306(Acknowledgement)X
2941(Strategy)X
3237(in)X
3328(TCP,)X
3523(RFC-813.)X
3889(Net-)X
1376 1580(work)N
1561(Information)X
1964(Center,)X
2218(SRI)X
2362(International.)X
2832(July)X
2985(1982.)X
576 1704([DEC80])N
1376(Digital)X
1624(Equipment)X
2001(Corporation;)X
2 f
2456(DECnet)X
2740(DIGITAL)X
3074(Network)X
3372(Architecture)X
9 f
3800(-)X
2 f
3871(Gen-)X
1376 1800(eral)N
1525(Description)X
1 f
1903(.)X
1963(Order)X
2171(No.)X
2329(AA-K179A-TK.)X
2902(October)X
3181(1980.)X
576 1924([Gurwitz81])N
1376(Gurwitz,)X
1706(R.)X
1826(F.;)X
1979(VAX-UNIX)X
2428(Networking)X
2858(Support)X
3158(Project)X
9 f
3433(-)X
1 f
3525(Implementation)X
1376 2020(Description.)N
1810(Internetwork)X
2245(Working)X
2550(Group,)X
2795(IEN)X
2949(168.)X
3129(January)X
3399(1981.)X
576 2144([ISO81])N
1376(International)X
1818(Organization)X
2269(for)X
2395(Standardization.)X
2 f
2970(ISO)X
3127(Open)X
3334(Systems)X
3621(Interconnec-)X
1376 2240(tion)N
9 f
1520(-)X
2 f
1584(Basic)X
1782(Reference)X
2124(Model)X
1 f
2329(.)X
2389(ISO/TC)X
2662(97/SC)X
2881(16)X
2981(N)X
3059(719.)X
3239(August)X
3490(1981.)X
576 2364([Joy86])N
1376(Joy,)X
1529(W.;)X
1669(Fabry,)X
1899(R.;)X
2017(Lef\257er,)X
2279(S.;)X
2388(McKusick,)X
2765(M.;)X
2901(and)X
3040(Karels,)X
3293(M.;)X
3429(Berkeley)X
3742(Software)X
1376 2460(Architecture)N
1832(Manual,)X
2150(4.4BSD)X
2458(Edition.)X
2 f
2786(UNIX)X
3026(Programmer's)X
3551(Supplementary)X
1376 2556(Documents)N
1 f
1737(,)X
1788(Vol.)X
1959(1)X
2030(\(PSD:5\).)X
2363(Computer)X
2714(Systems)X
3011(Research)X
3338(Group,)X
3595(University)X
3965(of)X
1376 2652(California,)N
1741(Berkeley.)X
2091(May,)X
2278(1986.)X
576 2776([Lef\257er84])N
1376(Lef\257er,)X
1644(S.J.)X
1788(and)X
1933(Karels,)X
2192(M.J.;)X
2385(Trailer)X
2633(Encapsulations,)X
3167(RFC-893.)X
3533(Network)X
3844(Infor-)X
1376 2872(mation)N
1618(Center,)X
1872(SRI)X
2016(International.)X
2486(April)X
2675(1984.)X
576 2996([Postel80])N
1376(Postel,)X
1618(J.)X
1717(User)X
1897(Datagram)X
2242(Protocol,)X
2561(RFC-768.)X
2926(Network)X
3235(Information)X
3646(Center,)X
3908(SRI)X
1376 3092(International.)N
1846(May)X
2013(1980.)X
576 3216([Postel81a])N
1376(Postel,)X
1630(J.,)X
1740(ed.)X
1895(Internet)X
2184(Protocol,)X
2514(RFC-791.)X
2890(Network)X
3211(Information)X
3634(Center,)X
3908(SRI)X
1376 3312(International.)N
1846(September)X
2209(1981.)X
576 3436([Postel81b])N
1376(Postel,)X
1626(J.,)X
1733(ed.)X
1885(Transmission)X
2352(Control)X
2632(Protocol,)X
2959(RFC-793.)X
3332(Network)X
3649(Information)X
1376 3532(Center,)N
1630(SRI)X
1774(International.)X
2244(September)X
2607(1981.)X
576 3656([Postel81c])N
1376(Postel,)X
1628(J.)X
1737(Internet)X
2025(Control)X
2307(Message)X
2626(Protocol,)X
2955(RFC-792.)X
3330(Network)X
3649(Information)X
1376 3752(Center,)N
1630(SRI)X
1774(International.)X
2244(September)X
2607(1981.)X
576 3876([Xerox81])N
1376(Xerox)X
1597(Corporation.)X
2 f
2045(Internet)X
2320(Transport)X
2660(Protocols)X
1 f
2971(.)X
3012(Xerox)X
3234(System)X
3490(Integration)X
3863(Stan-)X
1376 3972(dard)N
1539(028112.)X
1839(December)X
2190(1981.)X
576 4096([Zimmermann80])N
1376(Zimmermann,)X
1865(H.)X
1996(OSI)X
2158(Reference)X
2518(Model)X
9 f
2760(-)X
1 f
2837(The)X
2995(ISO)X
3158(Model)X
3401(of)X
3502(Architecture)X
3938(for)X
1376 4192(Open)N
1584(Systems)X
1884(Interconnection.)X
2 f
2462(IEEE)X
2670(Transactions)X
3121(on)X
3235(Communications)X
1 f
3777(.)X
3850(Com-)X
1376 4288(28\(4\);)N
1592(425-432.)X
1919(April)X
2108(1980.)X

26 p
%%Trailer
xt

xs
